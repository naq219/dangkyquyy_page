function jt(e){"@babel/helpers - typeof";return jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(e)}function Oa(e,t){if(jt(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(jt(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xa(e){var t=Oa(e,"string");return jt(t)==="symbol"?t:String(t)}function qi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,xa(n.key),n)}}function Ct(e,t,r){return t&&qi(e.prototype,t),r&&qi(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ca(e){return Array.isArray(e)?e.slice(0):[e]}function ut(e){return Array.isArray(e)}function Sa(e){return e!=null}function Xr(e,t){var r=0,n=-1;for(var i of e){n=n+1;var o=t(i,n);if(o)r=r+1;else break}return r}function di(e,t){for(var r=t.length,n=0;n<r;++n){var i=t[n];e.push(i)}}function En(e){var t=e.split("-");if(t.length!==2)throw new Error("malformatted revision: "+e);return{height:parseInt(t[0],10),hash:t[1]}}function Da(e){var t=parseInt(e.split("-")[0],10);return t}function On(e,t){var r=t?t._rev:null,n=r?En(r).height:0,i=n+1;return i+"-"+e}var Io=1;function jr(){return{lwt:Io}}function Ur(){return""}function ka(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function Ra(e,t,r){if(t.length!==r.length)return!1;for(var n=0,i=t.length;n<i;){var o=t[n],s=r[n];if(n++,o._rev!==s._rev||o[e]!==s[e])return!1}return!0}function Pa(){return new Promise(e=>setTimeout(e,0))}function Ia(e=0){return new Promise(t=>setTimeout(t,e))}Promise.resolve(!0);var Re=Promise.resolve(!1),Aa=Promise.resolve(null),Nt=Promise.resolve(),Zr=Nt;function Ta(e=void 0){return Zr=Zr.then(()=>typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):Ia(0)),Zr}function Ma(e,t){return e.reduce((r,n)=>r.then(n),Promise.resolve(t))}function Ao(e=10){for(var t="",r="abcdefghijklmnopqrstuvwxyz",n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}function To(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function Ut(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function Mo(e){return!!(e.includes("/")||e.includes("\\"))}function Ht(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!Ht(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var i=Object.keys(e);if(r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=r;n--!==0;){var o=i[n];if(!Ht(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}var Na=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},en=new Set(["__proto__","prototype","constructor"]),$a=new Set("0123456789");function Ka(e){var t=[],r="",n="start",i=!1;for(var o of e)switch(o){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");i&&(r+=o),n="property",i=!i;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(i){i=!1,r+=o;break}if(en.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(i){i=!1,r+=o;break}if(n==="property"){if(en.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!$a.has(o))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),i&&(i=!1,r+="\\"),r+=o}}switch(i&&(r+="\\"),n){case"property":{if(en.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function Ba(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function Pe(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!Na(e)||typeof t!="string")return r===void 0?e:r;var n=Ka(t);if(n.length===0)return r;for(var i=0;i<n.length;i++){var o=n[i];if(Ba(e,o)?e=i===n.length-1?void 0:null:e=e[o],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function No(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(function(t){e.hasOwnProperty(t)&&e[t]!==null&&(typeof e[t]=="object"||typeof e[t]=="function")&&!Object.isFrozen(e[t])&&No(e[t])}),e}function La(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var i=n,o=0;o<r;++o){var s=t[o];if(i=i[s],typeof i>"u")return i}return i}}function ji(e,t){var r=e[t];if(!r)throw new Error("missing value from object "+t);return r}function xn(e){var t={};for(var r in e)if(e.hasOwnProperty(r))if(typeof e[r]=="object"){var n=xn(e[r]);for(var i in n)n.hasOwnProperty(i)&&(t[r+"."+i]=n[i])}else t[r]=e[r];return t}function H(e){return Object.assign({},e)}function Fa(e){return Object.keys(e)[0]}function Pr(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,i)=>typeof n=="string"&&typeof i=="string"?n.localeCompare(i):typeof n=="object"?1:-1).map(n=>Pr(n,t));if(typeof e=="object"&&!Array.isArray(e)){if(e instanceof RegExp)return e;var r={};return Object.keys(e).sort((n,i)=>n.localeCompare(i)).forEach(n=>{r[n]=Pr(e[n],t)}),r}return e}function Cn(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=Cn(e[r]);return t}var n={};for(var i in e)n[i]=Cn(e[i]);return n}var ct=Cn;function vr(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}function qa(e,t){return t instanceof RegExp?t.toString():t}function Wt(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function yt(e,t,r,n){var i=e.get(t);return typeof i>"u"?(i=r(),e.set(t,i)):n&&n(i),i}function M(e){var t=e.split("-"),r="RxDB";return t.forEach(n=>{r+=To(n)}),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+r+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+r+`);
        `)}var tn=0;function ye(){var e=new Date().getTime();e=e+.01,e<=tn&&(e=tn+.01);var t=parseFloat(e.toFixed(2));return tn=t,t}function j(e){if(!e)throw new Error("ensureNotFalsy() is falsy");return e}var $o={bufferSize:1,refCount:!0},ja=/\./g,Ua=/(\/?)(.+)\1([a-z]*)/i;function Ha(e){var t=j(e.toString().match(Ua));return{pattern:t[2],flags:t[3]}}function Qt(e,t){return Qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Qt(e,t)}function Ko(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Qt(e,t)}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Sn(e)}function Wa(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Qa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function gr(e,t,r){return Qa()?gr=Reflect.construct.bind():gr=function(i,o,s){var a=[null];a.push.apply(a,o);var u=Function.bind.apply(i,a),c=new u;return s&&Qt(c,s.prototype),c},gr.apply(null,arguments)}function Ir(e){var t=typeof Map=="function"?new Map:void 0;return Ir=function(n){if(n===null||!Wa(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return gr(n,arguments,Sn(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Qt(i,n)},Ir(e)}var te={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return"RxDB Error-Code "+e+`.
        Error messages are not included in RxDB core to reduce build size.
        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html
        - or search for the error code here: https://github.com/pubkey/rxdb/search?q=`+e+`
        `}};function za(e){var t="";return Object.keys(e).length===0||(t+=`Given parameters: {
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(i=>JSON.stringify(i,Object.getOwnPropertyNames(i))):n=JSON.stringify(e[r],function(i,o){return o===void 0?null:o},2)}catch{}return r+":"+n}).join(`
`),t+="}"),t}function Bo(e,t,r){return"RxError ("+t+`):
`+e+`
`+za(r)}var Va=function(e){Ko(t,e);function t(n,i,o={}){var s,a=Bo(i,n,o);return s=e.call(this,a)||this,s.code=n,s.message=a,s.parameters=o,s.rxdb=!0,s}var r=t.prototype;return r.toString=function(){return this.message},Ct(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}]),t}(Ir(Error)),Ga=function(e){Ko(t,e);function t(n,i,o={}){var s,a=Bo(i,n,o);return s=e.call(this,a)||this,s.code=n,s.message=a,s.parameters=o,s.rxdb=!0,s}var r=t.prototype;return r.toString=function(){return this.message},Ct(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}]),t}(Ir(TypeError));function _(e,t){return new Va(e,te.tunnelErrorMessage(e),t)}function ae(e,t){return new Ga(e,te.tunnelErrorMessage(e),t)}function Ya(e){return e&&e.status===409?e:!1}var Ja={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function Xa(e){return _("COL20",{name:Ja[e.status],document:e.documentId,writeError:e})}var Dn={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function Ee(e,t){Dn[e]&&Dn[e].forEach(r=>r(t))}function Hr(e,t){return Promise.all(Dn[e].map(r=>r(t)))}function L(e){return typeof e=="function"}function Za(e){return L(e==null?void 0:e.lift)}function Ke(e){return function(t){if(Za(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var kn=function(e,t){return kn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},kn(e,t)};function Ze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");kn(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function eu(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(l){try{c(n.next(l))}catch(f){s(f)}}function u(l){try{c(n.throw(l))}catch(f){s(f)}}function c(l){l.done?o(l.value):i(l.value).then(a,u)}c((n=n.apply(e,t||[])).next())})}function Lo(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(r=0)),r;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){r.label=c[1];break}if(c[0]===6&&r.label<o[1]){r.label=o[1],o=c;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(c);break}o[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(l){c=[6,l],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function vt(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function zt(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function Vt(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function lt(e){return this instanceof lt?(this.v=e,this):new lt(e)}function tu(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(h){n[h]&&(i[h]=function(d){return new Promise(function(m,p){o.push([h,d,m,p])>1||a(h,d)})})}function a(h,d){try{u(n[h](d))}catch(m){f(o[0][3],m)}}function u(h){h.value instanceof lt?Promise.resolve(h.value.v).then(c,l):f(o[0][2],h)}function c(h){a("next",h)}function l(h){a("throw",h)}function f(h,d){h(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function ru(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof vt=="function"?vt(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(s){return new Promise(function(a,u){s=e[o](s),i(a,u,s.done,s.value)})}}function i(o,s,a,u){Promise.resolve(u).then(function(c){o({value:c,done:a})},s)}}var Fo=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function qo(e){return L(e==null?void 0:e.then)}function pi(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var rn=pi(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function Rn(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Wr=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=vt(s),u=a.next();!u.done;u=a.next()){var c=u.value;c.remove(this)}}catch(p){t={error:p}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(L(l))try{l()}catch(p){o=p instanceof rn?p.errors:[p]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var h=vt(f),d=h.next();!d.done;d=h.next()){var m=d.value;try{Ui(m)}catch(p){o=o??[],p instanceof rn?o=Vt(Vt([],zt(o)),zt(p.errors)):o.push(p)}}}catch(p){n={error:p}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}if(o)throw new rn(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Ui(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&Rn(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&Rn(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),jo=Wr.EMPTY;function Uo(e){return e instanceof Wr||e&&"closed"in e&&L(e.remove)&&L(e.add)&&L(e.unsubscribe)}function Ui(e){L(e)?e():e.unsubscribe()}var Ho={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Pn={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Pn.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Vt([e,t],zt(r))):setTimeout.apply(void 0,Vt([e,t],zt(r)))},clearTimeout:function(e){var t=Pn.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Wo(e){Pn.setTimeout(function(){throw e})}function Hi(){}function br(e){e()}var mi=function(e){Ze(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Uo(r)&&r.add(n)):n.destination=su,n}return t.create=function(r,n,i){return new gt(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Wr),nu=Function.prototype.bind;function nn(e,t){return nu.call(e,t)}var iu=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){ur(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){ur(n)}else ur(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){ur(r)}},e}(),gt=function(e){Ze(t,e);function t(r,n,i){var o=e.call(this)||this,s;if(L(r)||!r)s={next:r??void 0,error:n??void 0,complete:i??void 0};else{var a;o&&Ho.useDeprecatedNextContext?(a=Object.create(r),a.unsubscribe=function(){return o.unsubscribe()},s={next:r.next&&nn(r.next,a),error:r.error&&nn(r.error,a),complete:r.complete&&nn(r.complete,a)}):s=r}return o.destination=new iu(s),o}return t}(mi);function ur(e){Wo(e)}function ou(e){throw e}var su={closed:!0,next:Hi,error:ou,complete:Hi},yi=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function vi(e){return e}function au(e){return e.length===0?vi:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var ie=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,o=cu(t)?t:new gt(t,r,n);return br(function(){var s=i,a=s.operator,u=s.source;o.add(a?a.call(o,u):u?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Wi(r),new r(function(i,o){var s=new gt({next:function(a){try{t(a)}catch(u){o(u),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[yi]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return au(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Wi(t),new t(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},e.create=function(t){return new e(t)},e}();function Wi(e){var t;return(t=e??Ho.Promise)!==null&&t!==void 0?t:Promise}function uu(e){return e&&L(e.next)&&L(e.error)&&L(e.complete)}function cu(e){return e&&e instanceof mi||uu(e)&&Uo(e)}function Qo(e){return L(e[yi])}function zo(e){return Symbol.asyncIterator&&L(e==null?void 0:e[Symbol.asyncIterator])}function Vo(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function lu(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Go=lu();function Yo(e){return L(e==null?void 0:e[Go])}function Jo(e){return tu(this,arguments,function(){var r,n,i,o;return Lo(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,lt(r.read())];case 3:return n=s.sent(),i=n.value,o=n.done,o?[4,lt(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,lt(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Xo(e){return L(e==null?void 0:e.getReader)}function Be(e){if(e instanceof ie)return e;if(e!=null){if(Qo(e))return fu(e);if(Fo(e))return hu(e);if(qo(e))return du(e);if(zo(e))return Zo(e);if(Yo(e))return pu(e);if(Xo(e))return mu(e)}throw Vo(e)}function fu(e){return new ie(function(t){var r=e[yi]();if(L(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function hu(e){return new ie(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function du(e){return new ie(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Wo)})}function pu(e){return new ie(function(t){var r,n;try{for(var i=vt(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function Zo(e){return new ie(function(t){yu(e,t).catch(function(r){return t.error(r)})})}function mu(e){return Zo(Jo(e))}function yu(e,t){var r,n,i,o;return eu(this,void 0,void 0,function(){var s,a;return Lo(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=ru(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),i={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function bt(e,t,r,n,i){return new vu(e,t,r,n,i)}var vu=function(e){Ze(t,e);function t(r,n,i,o,s,a){var u=e.call(this,r)||this;return u.onFinalize=s,u.shouldUnsubscribe=a,u._next=n?function(c){try{n(c)}catch(l){r.error(l)}}:e.prototype._next,u._error=o?function(c){try{o(c)}catch(l){r.error(l)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=i?function(){try{i()}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(mi),es={now:function(){return(es.delegate||Date).now()},delegate:void 0};function gu(e){return e&&L(e.schedule)}function ts(e){return e[e.length-1]}function gi(e){return gu(ts(e))?e.pop():void 0}function bu(e,t){return typeof ts(e)=="number"?e.pop():t}function Te(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(o),!i)return o}function rs(e,t){return t===void 0&&(t=0),Ke(function(r,n){r.subscribe(bt(n,function(i){return Te(n,e,function(){return n.next(i)},t)},function(){return Te(n,e,function(){return n.complete()},t)},function(i){return Te(n,e,function(){return n.error(i)},t)}))})}function ns(e,t){return t===void 0&&(t=0),Ke(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function wu(e,t){return Be(e).pipe(ns(t),rs(t))}function _u(e,t){return Be(e).pipe(ns(t),rs(t))}function Eu(e,t){return new ie(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function Ou(e,t){return new ie(function(r){var n;return Te(r,t,function(){n=e[Go](),Te(r,t,function(){var i,o,s;try{i=n.next(),o=i.value,s=i.done}catch(a){r.error(a);return}s?r.complete():r.next(o)},0,!0)}),function(){return L(n==null?void 0:n.return)&&n.return()}})}function is(e,t){if(!e)throw new Error("Iterable cannot be null");return new ie(function(r){Te(r,t,function(){var n=e[Symbol.asyncIterator]();Te(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function xu(e,t){return is(Jo(e),t)}function Cu(e,t){if(e!=null){if(Qo(e))return wu(e,t);if(Fo(e))return Eu(e,t);if(qo(e))return _u(e,t);if(zo(e))return is(e,t);if(Yo(e))return Ou(e,t);if(Xo(e))return xu(e,t)}throw Vo(e)}function os(e,t){return t?Cu(e,t):Be(e)}function Ie(e,t){return Ke(function(r,n){var i=0;r.subscribe(bt(n,function(o){n.next(e.call(t,o,i++))}))})}function Su(e,t,r,n,i,o,s,a){var u=[],c=0,l=0,f=!1,h=function(){f&&!u.length&&!c&&t.complete()},d=function(p){return c<n?m(p):u.push(p)},m=function(p){o&&t.next(p),c++;var g=!1;Be(r(p,l++)).subscribe(bt(t,function(y){i==null||i(y),o?d(y):t.next(y)},function(){g=!0},void 0,function(){if(g)try{c--;for(var y=function(){var v=u.shift();s?Te(t,s,function(){return m(v)}):m(v)};u.length&&c<n;)y();h()}catch(v){t.error(v)}}))};return e.subscribe(bt(t,d,function(){f=!0,h()})),function(){a==null||a()}}function er(e,t,r){return r===void 0&&(r=1/0),L(t)?er(function(n,i){return Ie(function(o,s){return t(n,o,i,s)})(Be(e(n,i)))},r):(typeof t=="number"&&(r=t),Ke(function(n,i){return Su(n,i,e,r)}))}function ss(e){return e===void 0&&(e=1/0),er(vi,e)}function Du(){return ss(1)}var ku=pi(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),tr=function(e){Ze(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Qi(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new ku},t.prototype.next=function(r){var n=this;br(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=vt(n.currentObservers),a=s.next();!a.done;a=s.next()){var u=a.value;u.next(r)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;br(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;br(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?jo:(this.currentObservers=null,a.push(r),new Wr(function(){n.currentObservers=null,Rn(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},t.prototype.asObservable=function(){var r=new ie;return r.source=this,r},t.create=function(r,n){return new Qi(r,n)},t}(ie),Qi=function(e){Ze(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:jo},t}(tr);function zi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Du()(os(e,gi(e)))}var Ru=new ie(function(e){return e.complete()});function In(e,t){return t===void 0&&(t=vi),e=e??Pu,Ke(function(r,n){var i,o=!0;r.subscribe(bt(n,function(s){var a=t(s);(o||!e(i,a))&&(o=!1,i=a,n.next(s))}))})}function Pu(e,t){return e===t}function se(e,t){return Ke(function(r,n){var i=0;r.subscribe(bt(n,function(o){return e.call(t,o,i++)&&n.next(o)}))})}var Iu=pi(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}),Au=function(e){Ze(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,o=r._value;if(n)throw i;return this._throwIfClosed(),o},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(tr),Tu=function(e){Ze(t,e);function t(r,n,i){r===void 0&&(r=1/0),n===void 0&&(n=1/0),i===void 0&&(i=es);var o=e.call(this)||this;return o._bufferSize=r,o._windowTime=n,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,r),o._windowTime=Math.max(1,n),o}return t.prototype.next=function(r){var n=this,i=n.isStopped,o=n._buffer,s=n._infiniteTimeWindow,a=n._timestampProvider,u=n._windowTime;i||(o.push(r),!s&&o.push(a.now()+u)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),u=0;u<a.length&&!r.closed;u+=o?1:2)r.next(a[u]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,i=r._timestampProvider,o=r._buffer,s=r._infiniteTimeWindow,a=(s?1:2)*n;if(n<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var u=i.now(),c=0,l=1;l<o.length&&o[l]<=u;l+=2)c=l;c&&o.splice(0,c+1)}},t}(tr);function Mu(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new tr}:t,n=e.resetOnError,i=n===void 0?!0:n,o=e.resetOnComplete,s=o===void 0?!0:o,a=e.resetOnRefCountZero,u=a===void 0?!0:a;return function(c){var l,f,h,d=0,m=!1,p=!1,g=function(){f==null||f.unsubscribe(),f=void 0},y=function(){g(),l=h=void 0,m=p=!1},v=function(){var b=l;y(),b==null||b.unsubscribe()};return Ke(function(b,C){d++,!p&&!m&&g();var E=h=h??r();C.add(function(){d--,d===0&&!p&&!m&&(f=on(v,u))}),E.subscribe(C),!l&&d>0&&(l=new gt({next:function(w){return E.next(w)},error:function(w){p=!0,g(),f=on(y,i,w),E.error(w)},complete:function(){m=!0,g(),f=on(y,s),E.complete()}}),Be(b).subscribe(l))})(c)}}function on(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var i=new gt({next:function(){i.unsubscribe(),e()}});return Be(t.apply(void 0,Vt([],zt(r)))).subscribe(i)}}function as(e,t,r){var n,i,o,s,a=!1;return e&&typeof e=="object"?(n=e.bufferSize,s=n===void 0?1/0:n,i=e.windowTime,t=i===void 0?1/0:i,o=e.refCount,a=o===void 0?!1:o,r=e.scheduler):s=e??1/0,Mu({connector:function(){return new Tu(s,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function us(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=gi(e);return Ke(function(n,i){(r?zi(e,n,r):zi(e,n)).subscribe(i)})}function cs(e){return e.documentData?e.documentData:e.previousDocumentData}function Nu(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:te.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}function wt(e,t){var r=t;r=r.replace(ja,".properties."),r="properties."+r,r=Ut(r);var n=Pe(e,r);return n}function $u(e,t,r){if(typeof t.primaryKey=="string")return r;var n=bi(t,r),i=r[e];if(i&&i!==n)throw _("DOC19",{args:{documentData:r,existingPrimary:i,newPrimary:n},schema:t});return r[e]=n,r}function Le(e){return typeof e=="string"?e:e.key}function bi(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var i=Pe(t,n);if(typeof i>"u")throw _("DOC18",{args:{field:n,documentData:t}});return i}).join(r.separator)}function Ku(e){var t=Pr(e,!0);return t}function ls(e){e=H(e);var t=Le(e.primaryKey);e.properties=H(e.properties),e.additionalProperties=!1,e.hasOwnProperty("keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=Bu,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=fs(e);return di(e.required,r),e.required=e.required.filter(n=>!n.includes(".")).filter((n,i,o)=>o.indexOf(n)===i),e.version=e.version||0,e.indexes&&(e.indexes=e.indexes.map(n=>{var i=ut(n)?n.slice(0):[n];if(!i.includes(t)){var o=i.slice(0);return o.push(t),o}return i})),e}var Bu={type:"object",properties:{lwt:{type:"number",minimum:Io,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function fs(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=Le(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function Lu(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var i=r[n];(!t.hasOwnProperty(i)||typeof t[i]>"u")&&(t[i]=e.defaultValues[i])}return t}var Fu={type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1},qu="_rxdb_internal";async function ju(e,t){var r=await e.findDocumentsById([t],!1),n=r[t];return n||null}function Uu(e,t,r){var n=t.documentData,i=t.previousDocumentData,o={eventId:t.eventId,documentId:t.documentId,collectionName:r?r.name:void 0,startTime:t.startTime,endTime:t.endTime,isLocal:e,operation:t.operation,documentData:te.deepFreezeWhenDevMode(n),previousDocumentData:te.deepFreezeWhenDevMode(i)};return o}function An(e,t,r,n){if(n)throw n.status===409?_("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):n.status===422?_("VD2",{collection:e.name,id:t,writeError:n,data:r}):n}function hs(e){var t=H(e);return t._meta=H(e._meta),t}function ds(e,t,r){Le(r.primaryKey);function n(o){var s=H(o.document);return s._meta=H(s._meta),s._meta.lwt=ye(),s._rev=On(e.token,o.previous),{document:s,previous:o.previous}}var i={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(o,s){var a=o.map(u=>n(u));return e.lockedRun(()=>t.bulkWrite(a,s)).then(u=>{var c=Object.values(u.error).filter(h=>!!(h.status===409&&!h.writeRow.previous&&!h.writeRow.document._deleted&&j(h.documentInDb)._deleted));if(c.length>0){var l={error:H(u.error),success:H(u.success)},f=c.map(h=>(delete l.error[h.documentId],{previous:h.documentInDb,document:Object.assign({},h.writeRow.document,{_rev:On(e.token,h.documentInDb)})}));return e.lockedRun(()=>t.bulkWrite(f,s)).then(h=>(l.error=Object.assign(l.error,h.error),l.success=Object.assign(l.success,h.success),l))}return u})},query(o){return e.lockedRun(()=>t.query(o))},count(o){return e.lockedRun(()=>t.count(o))},findDocumentsById(o,s){return e.lockedRun(()=>t.findDocumentsById(o,s))},getAttachmentData(o,s,a){return e.lockedRun(()=>t.getAttachmentData(o,s,a))},getChangedDocumentsSince(o,s){return e.lockedRun(()=>t.getChangedDocumentsSince(j(o),s))},cleanup(o){return e.lockedRun(()=>t.cleanup(o))},remove(){return e.storageInstances.delete(i),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(i),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()},conflictResultionTasks(){return t.conflictResultionTasks()},resolveConflictResultionTask(o){if(o.output.isEqual)return t.resolveConflictResultionTask(o);var s=Object.assign({},o.output.documentData,{_meta:jr(),_rev:Ur(),_attachments:{}}),a=H(s);return delete a._meta,delete a._rev,delete a._attachments,t.resolveConflictResultionTask({id:o.id,output:{isEqual:!1,documentData:a}})}};return e.storageInstances.add(i),i}var Hu=function(){function e(r,n,i,o){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=r,this.primaryPath=n,this.preWrite=i,this.postWrite=o}var t=e.prototype;return t.addWrite=function(n,i){var o=n[this.primaryPath],s=yt(this.queueByDocId,o,()=>[]),a=new Promise((u,c)=>{var l={lastKnownDocumentState:n,modifier:i,resolve:u,reject:c};j(s).push(l),this.triggerRun()});return a},t.triggerRun=async function(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var n=[],i=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(i.entries()).map(async([s,a])=>{var u=Wu(a.map(f=>f.lastKnownDocumentState)),c=u;for(var l of a)try{c=await l.modifier(ct(c))}catch(f){l.reject(f),l.reject=()=>{},l.resolve=()=>{}}try{await this.preWrite(c,u)}catch(f){a.forEach(h=>h.reject(f));return}n.push({previous:u,document:c})}));var o=n.length>0?await this.storageInstance.bulkWrite(n,"incremental-write"):{error:{},success:{}};return await Promise.all(Array.from(Object.entries(o.success)).map(([s,a])=>{this.postWrite(a);var u=Wt(i,s);u.forEach(c=>c.resolve(a))})),Array.from(Object.entries(o.error)).forEach(([s,a])=>{var u=Wt(i,s),c=Ya(a);if(c){var l=yt(this.queueByDocId,s,()=>[]);u.reverse().forEach(h=>{h.lastKnownDocumentState=j(c.documentInDb),j(l).unshift(h)})}else{var f=Xa(a);u.forEach(h=>h.reject(f))}}),this.isRunning=!1,this.triggerRun()}},e}();function Vi(e){var t=async r=>{var n=ka(r);n._deleted=r._deleted;var i=await e(n),o=Object.assign({},i,{_meta:r._meta,_attachments:r._attachments,_rev:r._rev,_deleted:typeof i._deleted<"u"?i._deleted:r._deleted});return typeof o._deleted>"u"&&(o._deleted=!1),o};return t}function Wu(e){var t=e[0],r=En(t._rev).height;return e.forEach(n=>{var i=En(n._rev).height;i>r&&(t=n,r=i)}),t}var Qr={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(Ie(t=>t._deleted))},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this;return e.collection.$.pipe(se(t=>!t.isLocal),se(t=>t.documentId===this.primary),Ie(t=>cs(t)),us(e.collection._docCache.getLatestDocumentData(this.primary)),In((t,r)=>t._rev===r._rev),Ie(t=>this.collection._docCache.getCachedRxDocument(t)),as($o))},get$(e){return this.$.pipe(Ie(t=>Pe(t,e)),In())},populate(e){var t=wt(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return Aa;if(!t)throw _("DOC5",{path:e});if(!t.ref)throw _("DOC6",{path:e,schemaObj:t});var n=this.collection.database.collections[t.ref];if(!n)throw _("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?n.findByIds(r).exec().then(i=>{var o=i.values();return Array.from(o)}):n.findOne(r).exec()},get(e){if(this._data){var t=this._propertyCache.get(e);if(t)return t;var r=Pe(this._data,e);return typeof r!="object"||Array.isArray(r)?te.deepFreezeWhenDevMode(r):(r=ct(r),ms(this.collection.schema,r,e,this),this._propertyCache.set(e,r),r)}},toJSON(e=!1){if(e)return te.deepFreezeWhenDevMode(this._data);var t=H(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,te.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return ct(this.toJSON(e))},update(e){throw M("update")},incrementalUpdate(e){throw M("update")},updateCRDT(e){throw M("crdt")},putAttachment(){throw M("attachments")},getAttachment(){throw M("attachments")},allAttachments(){throw M("attachments")},get allAttachments$(){throw M("attachments")},async modify(e,t){var r=this._data,n=await Vi(e)(r);return this._saveData(n,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,Vi(e)).then(r=>this.collection._docCache.getCachedRxDocument(r))},patch(e){var t=this._data,r=ct(t);return Object.entries(e).forEach(([n,i])=>{r[n]=i}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},async _saveData(e,t){if(e=H(e),this._data._deleted)throw _("DOC11",{id:this.primary,document:this});await ys(this.collection,e,t);var r=await this.collection.storageInstance.bulkWrite([{previous:t,document:e}],"rx-document-save-data"),n=r.error[this.primary];return An(this.collection,this.primary,e,n),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(ji(r.success,this.primary))},remove(){var e=this.collection;if(this.deleted)return Promise.reject(_("DOC13",{document:this,id:this.primary}));var t=H(this._data),r;return e._runHooks("pre","remove",t,this).then(async()=>{t._deleted=!0;var n=await e.storageInstance.bulkWrite([{previous:this._data,document:t}],"rx-document-remove"),i=n.error[this.primary];return An(e,this.primary,t,i),ji(n.success,this.primary)}).then(n=>(r=n,this.collection._runHooks("post","remove",t,this))).then(()=>this.collection._docCache.getCachedRxDocument(r))},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},destroy(){throw _("DOC14")}};function ps(e=Qr){var t=function(n,i){this.collection=n,this._data=i,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function ms(e,t,r="",n=!1){if(t!==null){var i=wt(e.jsonSchema,r);typeof i>"u"||(i.properties&&(i=i.properties),Object.keys(i).forEach(o=>{var s=Ut(r+"."+o);t.__defineGetter__(o,function(){var a=n||this;if(!(!a.get||typeof a.get!="function")){var u=a.get(s);return u}}),Object.defineProperty(t,o+"$",{get:function(){var a=n||this;return a.get$(s)},enumerable:!1,configurable:!1}),Object.defineProperty(t,o+"_",{get:function(){var a=n||this;return a.populate(s)},enumerable:!1,configurable:!1}),t.__defineSetter__(o,function(a){var u=n||this;return u.set(s,a)})}))}}function Qu(e,t,r){var n=new e(t,r);return Ee("createRxDocument",n),n}function ys(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),e._runHooks("pre","save",t,r)}var zu=function(){function e(r,n){this.jsonSchema=r,this.hashFunction=n,this.indexes=Vu(this.jsonSchema),this.primaryPath=Le(this.jsonSchema.primaryKey),this.finalFields=fs(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(n,i){this.finalFields.forEach(o=>{if(!Ht(n[o],i[o]))throw _("DOC9",{dataBefore:n,dataAfter:i,fieldName:o,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var n={};return ms(this,n,""),vr(this,"getDocumentPrototype",()=>n),n},t.getPrimaryOfDocumentData=function(n){return bi(this.jsonSchema,n)},Ct(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,n])=>n.hasOwnProperty("default")).forEach(([n,i])=>r[n]=i.default),vr(this,"defaultValues",r)}},{key:"hash",get:function(){return vr(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}]),e}();function Vu(e){return(e.indexes||[]).map(t=>ut(t)?t:[t])}function Gu(e){var t=e.version?e.version:0,r=0;return new Array(t).fill(0).map(()=>r++)}function Yu(e,t,r=!0){r&&Ee("preCreateRxSchema",e);var n=ls(e);n=Ku(n);var i=new zu(n,t);return Ee("createRxSchema",i),i}function Ju(e,t){var r=typeof t=="object";return new Promise(function(n,i){var o=new gt({next:function(s){n(s),o.unsubscribe()},error:i,complete:function(){r?n(t.defaultValue):i(new Iu)}});e.subscribe(o)})}function Xu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=gi(e),n=bu(e,1/0),i=e;return i.length?i.length===1?Be(i[0]):ss(n)(os(i,r)):Ru}const rr="UNKNOWN";function wi(e){return e[e.length-1]}function Zu(e){const t=typeof e;return e!==null&&(t==="object"||t==="function")}function Gi(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!Zu(e)||typeof t!="string")return r===void 0?e:r;const n=t.split(".");if(n.length===0)return r;for(let i=0;i<n.length;i++){const o=n[i];if(ec(e,o)?e=i===n.length-1?void 0:null:e=e[o],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function ec(e,t){if(typeof t!="number"&&Array.isArray(e)){const r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}const vs=e=>!!e.queryParams.limit,tc=e=>e.queryParams.limit===1,rc=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),nc=e=>e.changeEvent.operation==="DELETE",ic=e=>e.changeEvent.operation==="INSERT",oc=e=>e.changeEvent.operation==="UPDATE",sc=e=>e.changeEvent.previous===rr,ac=e=>vs(e)&&e.previousResults.length>=e.queryParams.limit,uc=e=>{const t=e.queryParams.sortFields,r=e.changeEvent.previous,n=e.changeEvent.doc;if(!n)return!1;if(!r||r===rr)return!0;for(let i=0;i<t.length;i++){const o=t[i],s=Gi(r,o),a=Gi(n,o);if(s!==a)return!0}return!1},cc=e=>{const t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{const r=e.queryParams.primaryKey,n=e.previousResults;for(let i=0;i<n.length;i++)if(n[i][r]===t)return!0;return!1}},lc=e=>{const t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},fc=e=>{const t=wi(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},hc=e=>{const t=e.changeEvent.previous;if(!t||t===rr)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},dc=e=>{const t=e.changeEvent.previous;if(!t||t===rr)return!1;const r=wi(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},pc=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},mc=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=wi(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},yc=e=>{const t=e.changeEvent.previous;return!t||t===rr?!1:e.queryParams.queryMatcher(t)},vc=e=>{const t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},gc=e=>e.previousResults.length===0,bc={0:ic,1:oc,2:nc,3:vs,4:tc,5:rc,6:gc,7:sc,8:ac,9:lc,10:fc,11:uc,12:cc,13:hc,14:dc,15:pc,16:mc,17:yc,18:vc};function wc(e,t,r,n){var i=e.length,o=i-1,s=0;if(i===0)return e.push(t),0;for(var a;n<=o;)s=n+(o-n>>1),a=e[s],r(a,t)<=0?n=s+1:o=s-1;return r(a,t)<=0&&s++,e.splice(s,0,t),s}const _c=e=>{},_i=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Ei=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Oi=e=>{const t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},xi=e=>{const t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Ec=e=>{Oi(e),Ei(e)},Oc=e=>{xi(e),_i(e)},xc=e=>{Oi(e),_i(e)},Cc=e=>{xi(e),Ei(e)},gs=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);const t=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][t]===e.changeEvent.id){r.splice(n,1);break}},Sc=e=>{const t=e.changeEvent.doc,r=e.queryParams.primaryKey,n=e.previousResults;for(let i=0;i<n.length;i++)if(n[i][r]===e.changeEvent.id){n[i]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},Dc=e=>{const t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},bs=e=>{const t=e.changeEvent.id,r=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,r)}else if(e.previousResults.find(i=>i[e.queryParams.primaryKey]===t))return;wc(e.previousResults,r,e.queryParams.sortComparator,0)},kc=e=>{gs(e),bs(e)},Rc=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},Pc=e=>{throw new Error("Action unknownAction should never be called")},Ic=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],Ac={doNothing:_c,insertFirst:_i,insertLast:Ei,removeFirstItem:Oi,removeLastItem:xi,removeFirstInsertLast:Ec,removeLastInsertFirst:Oc,removeFirstInsertFirst:xc,removeLastInsertLast:Cc,removeExisting:gs,replaceExisting:Sc,alwaysWrong:Dc,insertAtSortPosition:bs,removeExistingAndInsertAtSortPosition:kc,runFullQueryAgain:Rc,unknownAction:Pc},Tc=40;function sn(e){return e.charCodeAt(0)-Tc}function Mc(e){return e?"1":"0"}function Yi(e,t){const r=[];for(let n=0,i=e.length;n<i;n+=t)r.push(e.substring(n,n+t));return r}function Nc(e){const t=new Map,n=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,i=e.substring(2,n),o=Yi(i,2);for(let p=0;p<o.length;p++){const g=o[p],y=g.charAt(0),v=sn(g.charAt(1));t.set(y,v)}const s=e.substring(n,e.length-3),a=Yi(s,4);for(let p=0;p<a.length;p++){const g=a[p],y=g.charAt(0),v=g.charAt(1),b=g.charAt(2),C=sn(g.charAt(3));if(!t.has(v))throw new Error("missing node with id "+v);if(!t.has(b))throw new Error("missing node with id "+b);const E=t.get(v),w=t.get(b),O={l:C,0:E,1:w};t.set(y,O)}const u=e.slice(-3),c=u.charAt(0),l=u.charAt(1),f=sn(u.charAt(2)),h=t.get(c),d=t.get(l);return{l:f,0:h,1:d}}function $c(e,t,r){let n=e,i=e.l;for(;;){const o=t[i](r),s=Mc(o);if(n=n[s],typeof n=="number"||typeof n=="string")return n;i=n.l}}const Kc="14a2b0c/d1e,f+g5h.i4j*k-l)m(n6ohk1pdf1qef1rin-sjn-ton-ugn-vmn-whn-xkn-yln-zdf5{ef5|wx5}df7~dz7ef7¡bk7¢e{7£g|7¤ry7¥dp7¦gk7§eq7¨gt7©ac7ªmv7«gu7¬nm7­iy7®nw7¯¤s8°«¦8±¬k8²ªm8³®v8´«n8µ¬n8¶vm8·xv8¸mn8¹­j8º®m8»xm8¼­¹3½}~3¾©°3¿¢3À¡£3Ám±3Â®º3Ãmº3Ä©´3Åb®3Æmµ3Çm»3Èx»3Ékn3Êm¸3Ë¼j6ÌÂm6ÍÆÃ6ÎÈm6Ïnm6ÐÊÇ6ÑÌÎ,ÒÍÐ,ÓÅÉ,Ô²¶,Õ³·,Ö®n,×º»,Ømf9ÙËÁ9Úym9ÛmÏ9ÜÑÒ9Ýz{2Þpq2ß½¿2à¾À2á¥§2â°¨2ãÄÓ2ä´Ö2åÝn0æÞn0çØÛ0èÙÜ0éßn0êàã0ë²Ô0ì¯Õ0íán0îâä0ï¹×0ðçv/ñåæ/òçë/óèì/ôéí/õêî/öÚy/÷òm(øóï(ùöy(ú÷ø:ûôõ:ümù:ýðñ4þúû4ÿþý*Āüm*ÿĀ.";let an;function Bc(){return an||(an=Nc(Kc)),an}const Lc=e=>$c(Bc(),bc,e);function Fc(e){const t=Lc(e);return Ic[t]}function qc(e,t,r,n,i){const o=Ac[e];return o({queryParams:t,changeEvent:r,previousResults:n,keyDocumentMap:i}),n}var st=String.fromCharCode(65535),at=Number.MIN_VALUE;function jc(e,t){var r=Le(e.primaryKey),n=t.selector,i=e.indexes?e.indexes.slice(0):[];t.index?i=[t.index]:i.push([r]);var o=t.sort.map(l=>Object.keys(l)[0]),s=o.join(","),a=!!t.sort.find(l=>Object.values(l)[0]==="desc"),u=-1,c;return i.forEach(l=>{var f=!0,h=!0,d=l.map(g=>{var y=n[g],v=y?Object.keys(y):[],b={};if(!y||!v.length){var C=h?at:st;b={startKey:C,endKey:f?st:at,inclusiveStart:!0,inclusiveEnd:!0}}else v.forEach(E=>{if(Ci.has(E)){var w=y[E],O=Wc(E,w);b=Object.assign(b,O)}});return typeof b.startKey>"u"&&(b.startKey=at),typeof b.endKey>"u"&&(b.endKey=st),typeof b.inclusiveStart>"u"&&(b.inclusiveStart=!0),typeof b.inclusiveEnd>"u"&&(b.inclusiveEnd=!0),h&&!b.inclusiveStart&&(h=!1),f&&!b.inclusiveEnd&&(f=!1),b}),m={index:l,startKeys:d.map(g=>g.startKey),endKeys:d.map(g=>g.endKey),inclusiveEnd:f,inclusiveStart:h,sortFieldsSameAsIndexFields:!a&&s===l.join(","),selectorSatisfiedByIndex:Ji(l,t.selector)},p=Qc(e,t,m);(p>0&&p>u||t.index)&&(u=p,c=m)}),c||(c={index:[r],startKeys:[at],endKeys:[st],inclusiveEnd:!0,inclusiveStart:!0,sortFieldsSameAsIndexFields:!a&&s===r,selectorSatisfiedByIndex:Ji([r],t.selector)}),c}var Ci=new Set(["$eq","$gt","$gte","$lt","$lte"]),Uc=new Set(["$eq","$gt","$gte"]),Hc=new Set(["$eq","$lt","$lte"]);function Ji(e,t){var r=Object.entries(t),n=r.find(([u,c])=>{if(!e.includes(u))return!0;var l=Object.entries(c).find(([f,h])=>!Ci.has(f));return l});if(n)return!1;var i,o=e.find(u=>{var c=t[u];if(!c)return!1;var l=Object.keys(c).find(f=>Uc.has(f));return i&&l?!0:(l!=="$eq"&&(i=l),!1)});if(o)return!1;var s,a=e.find(u=>{var c=t[u];if(!c)return!1;var l=Object.keys(c).find(f=>Hc.has(f));return s&&l?!0:(l!=="$eq"&&(s=l),!1)});return!a}function Wc(e,t){switch(e){case"$eq":return{startKey:t,endKey:t};case"$lte":return{endKey:t};case"$gte":return{startKey:t};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function Qc(e,t,r){var n=0,i=l=>{l>0&&(n=n+l)},o=10,s=Xr(r.startKeys,l=>l!==at&&l!==st);i(s*o);var a=Xr(r.startKeys,l=>l!==st&&l!==at);i(a*o);var u=Xr(r.startKeys,(l,f)=>l===r.endKeys[f]);i(u*o*1.5);var c=r.sortFieldsSameAsIndexFields?5:0;return i(c),n}const zc=2147483647,Vc=-2147483648,Gc=Number.MAX_SAFE_INTEGER,Yc=Number.MIN_SAFE_INTEGER,ze=Symbol("missing"),Jc=Object.getPrototypeOf({}),Xc="[object Object]",Zc=/^\[object ([a-zA-Z0-9]+)\]$/,zr=e=>{const t=ft(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},ws=new Set(["null","undefined","boolean","number","string","date","regexp"]),el={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},ce=(e,t)=>{e===ze&&(e=void 0),t===ze&&(t=void 0);const[r,n]=[e,t].map(i=>el[Oe(i).toLowerCase()]);return r!==n?r-n:r===1||r===2||r===6?e<t?-1:e>t?1:0:Ve(e,t)?0:e<t?-1:e>t?1:0};function ne(e,t){if(!e)throw new Error(t)}const Tn=e=>{const t=new Map,r=i=>{if(t.has(i))throw new Error("cycle detected during clone operation.");t.set(i,!0)},n=i=>{if(i instanceof Date)return new Date(i);if(Y(i)){r(i);const o=new Array(i.length),s=i.length;for(let a=0;a<s;a++)o[a]=n(i[a]);return o}if(q(i)){r(i);const o={};for(const s in i)o[s]=n(i[s]);return o}return i};return n(e)},Oe=e=>Zc.exec(Object.prototype.toString.call(e))[1],un=e=>typeof e=="boolean",xe=e=>typeof e=="string",ke=e=>!isNaN(e)&&typeof e=="number",Y=Array.isArray,q=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Jc||t===null)&&Xc===Object.prototype.toString.call(e)},Vr=e=>e===Object(e),Xi=e=>e instanceof Date,wr=e=>e instanceof RegExp,tl=e=>typeof e=="function",z=e=>e==null,_t=(e,t)=>e.includes(t),_s=(e,t)=>!_t(e,t),rl=(e,t=!0)=>!!e||t&&e==="",St=e=>z(e)||xe(e)&&!e||e instanceof Array&&e.length===0||q(e)&&Object.keys(e).length===0,Zi=e=>e===ze,nr=e=>e instanceof Array?e:[e],be=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),nl=(e,t)=>q(e)&&q(t)||Y(e)&&Y(t);function Ar(e,t,r){if(r=r||{flatten:!1},Zi(e)||z(e))return t;if(Zi(t)||z(t))return e;if(!nl(e,t)){if(r.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(r.skipValidation=!0,Y(e)){const n=e,i=t;if(r.flatten){let o=0,s=0;for(;o<n.length&&s<i.length;)n[o]=Ar(n[o++],i[s++],r);for(;s<i.length;)n.push(t[s++])}else Ge(n,i)}else for(const n in t)e[n]=Ar(e[n],t[n],r);return e}function eo(e,t=zr){const r=new Map;return e.forEach((n,i)=>{const o=xs(n,t);r.has(o)?r.get(o).some(s=>Ve(e[s],n))||r.get(o).push(i):r.set(o,[i])}),r}function Es(e,t=zr){if(e.some(a=>a.length==0))return[];if(e.length===1)return Array.from(e);const r=il(e.map((a,u)=>[u,a.length]),a=>a[1]),n=e[r[0][0]],i=eo(n,t),o=new Map,s=new Array;return i.forEach((a,u)=>{const c=a.map(d=>n[d]),l=c.map(d=>0),f=c.map(d=>[r[0][0],0]);let h=!1;for(let d=1;d<e.length;d++){const[m,p]=r[d],g=e[m];if(o.has(d)||o.set(d,eo(g)),o.get(d).has(u)){const y=o.get(d).get(u).map(v=>g[v]);h=c.map((v,b)=>y.some((C,E)=>{const w=l[b];return Ve(v,C)&&(l[b]++,m<f[b][0]&&(f[b]=[m,o.get(d).get(u)[E]])),w<l[b]})).some(Boolean)}if(!h)return}h&&Ge(s,l.map((d,m)=>d===e.length-1?[c[m],f[m]]:ze).filter(d=>d!==ze))}),s.sort((a,u)=>{const[c,[l,f]]=a,[h,[d,m]]=u,p=ce(l,d);return p!==0?p:ce(f,m)}).map(a=>a[0])}function Os(e,t=0){const r=new Array;function n(i,o){for(let s=0,a=i.length;s<a;s++)Y(i[s])&&(o>0||o<0)?n(i[s],Math.max(-1,o-1)):r.push(i[s])}return n(e,t),r}function Ve(e,t){const r=[e],n=[t];for(;r.length>0;){if(e=r.pop(),t=n.pop(),e===t)continue;const i=Oe(e).toLowerCase();if(i!==Oe(t).toLowerCase()||i==="function")return!1;if(i==="array"){const o=e,s=t;if(o.length!==s.length)return!1;if(o.length===s.length&&o.length===0)continue;Ge(r,o),Ge(n,s)}else if(i==="object"){const o=Object.keys(e),s=Object.keys(t);if(o.length!==s.length)return!1;for(let a=0,u=o.length;a<u;a++){const c=o[a];if(!be(t,c))return!1;r.push(e[c]),n.push(t[c])}}else if(ft(e)!==ft(t))return!1}return r.length===0}function ft(e){const t=Oe(e).toLowerCase();switch(t){case"boolean":case"number":case"regexp":return e.toString();case"string":return JSON.stringify(e);case"date":return e.toISOString();case"null":case"undefined":return t;case"array":return"["+e.map(ft).join(",")+"]"}const r=t==="object"?"":`${Oe(e)}`,n=Object.keys(e);return n.sort(),`${r}{`+n.map(i=>`${ft(i)}:${ft(e[i])}`).join(",")+"}"}function xs(e,t){return t=t||zr,z(e)?null:t(e).toString()}function il(e,t,r=ce){if(St(e))return e;const n=new Array,i=new Array;for(let o=0;o<e.length;o++){const s=e[o],a=t(s,o);z(a)?i.push(s):n.push([a,s])}return n.sort((o,s)=>r(o[0],s[0])),Ge(i,n.map(o=>o[1]))}function ol(e,t,r=zr){if(e.length<1)return new Map;const n=new Map,i=new Map;for(let o=0;o<e.length;o++){const s=e[o],a=t(s,o),u=xs(a,r);if(u===null)i.has(null)?i.get(null).push(s):i.set(null,[s]);else{const c=n.has(u)?n.get(u).find(l=>Ve(l,a)):null;z(c)?(i.set(a,[s]),n.has(u)?n.get(u).push(a):n.set(u,[a])):i.get(c).push(s)}}return i}const cn=5e4;function Ge(e,...t){return e instanceof Array?t.reduce((r,n)=>{let i=Math.ceil(n.length/cn),o=0;for(;i-- >0;)Array.prototype.push.apply(r,n.slice(o,o+cn)),o+=cn;return r},e):t.filter(Vr).reduce((r,n)=>(Object.assign(r,n),r),e)}function Mn(e,t){return Vr(e)?e[t]:void 0}function sl(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Si(e,t,r){let n=0;function i(s,a){let u=s;for(let c=0;c<a.length;c++){const l=a[c];if(/^\d+$/.exec(l)===null&&u instanceof Array){if(c===0&&n>0)break;n+=1;const h=a.slice(c);u=u.reduce((d,m)=>{const p=i(m,h);return p!==void 0&&d.push(p),d},[]);break}else u=Mn(u,l);if(u===void 0)break}return u}const o=ws.has(Oe(e).toLowerCase())?e:i(e,t.split("."));return o instanceof Array&&(r!=null&&r.unwrapArray)?sl(o,n):o}function _r(e,t,r){const n=t.split("."),i=n[0],o=n.slice(1).join("."),s=/^\d+$/.exec(i)!==null,a=n.length>1;let u,c;if(e instanceof Array)if(s)u=Mn(e,Number(i)),a&&(u=_r(u,o,r)),u=[u];else{u=[];for(const l of e)c=_r(l,t,r),r!=null&&r.preserveMissing?(c===void 0&&(c=ze),u.push(c)):c!==void 0&&u.push(c)}else{if(c=Mn(e,i),a&&(c=_r(c,o,r)),c===void 0)return;u=r!=null&&r.preserveKeys?Object.assign({},e):{},u[i]=c}return u}function Nn(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===ze?e.splice(t,1):Nn(e[t]);else if(q(e))for(const t in e)be(e,t)&&Nn(e[t])}const to=/^\d+$/;function Tr(e,t,r,n){const i=t.split("."),o=i[0],s=i.slice(1).join(".");if(i.length===1)(q(e)||Y(e)&&to.test(o))&&r(e,o);else{n!=null&&n.buildGraph&&z(e[o])&&(e[o]={});const a=e[o];if(!a)return;const u=!!(i.length>1&&to.test(i[1]));a instanceof Array&&(n!=null&&n.descendArray)&&!u?a.forEach(c=>Tr(c,s,r,n)):Tr(a,s,r,n)}}function al(e,t,r){Tr(e,t,(n,i)=>{n[i]=r},{buildGraph:!0})}function ro(e,t,r){Tr(e,t,(n,i)=>{if(n instanceof Array){if(/^\d+$/.test(i))n.splice(parseInt(i),1);else if(r&&r.descendArray)for(const o of n)q(o)&&delete o[i]}else q(n)&&delete n[i]},r)}const ul=/^\$[a-zA-Z0-9_]+$/;function Dt(e){return ul.test(e)}function Cs(e){if(ws.has(Oe(e).toLowerCase()))return wr(e)?{$regex:e}:{$eq:e};if(Vr(e)){if(!Object.keys(e).some(Dt))return{$eq:e};if(be(e,"$regex")){const r=Object.assign({},e);return r.$regex=new RegExp(e.$regex,e.$options),delete r.$options,r}}return e}var Ae;(function(e){e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF"})(Ae||(Ae={}));class Ue{constructor(t,r,n,i=Date.now()){this._opts=t,this._root=r,this._local=n,this.timestamp=i,this.update(r,n)}static init(t,r,n){return t instanceof Ue?new Ue(t._opts,z(t.root)?r:t.root,Object.assign({},t.local,n)):new Ue(t,r,n)}update(t,r){var n;return this._root=t,this._local=r&&Object.assign({},r,{variables:Object.assign({},(n=this._local)===null||n===void 0?void 0:n.variables,r==null?void 0:r.variables)}),this}getOptions(){return Object.freeze(Object.assign(Object.assign({},this._opts),{context:Ye.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var t;return(t=this._opts)===null||t===void 0?void 0:t.collation}get processingMode(){var t;return((t=this._opts)===null||t===void 0?void 0:t.processingMode)||Ae.CLONE_OFF}get useStrictMode(){var t;return(t=this._opts)===null||t===void 0?void 0:t.useStrictMode}get scriptEnabled(){var t;return(t=this._opts)===null||t===void 0?void 0:t.scriptEnabled}get useGlobalContext(){var t;return(t=this._opts)===null||t===void 0?void 0:t.useGlobalContext}get hashFunction(){var t;return(t=this._opts)===null||t===void 0?void 0:t.hashFunction}get collectionResolver(){var t;return(t=this._opts)===null||t===void 0?void 0:t.collectionResolver}get jsonSchemaValidator(){var t;return(t=this._opts)===null||t===void 0?void 0:t.jsonSchemaValidator}get variables(){var t;return(t=this._opts)===null||t===void 0?void 0:t.variables}get context(){var t;return(t=this._opts)===null||t===void 0?void 0:t.context}}function Ss(e){return e instanceof Ue?e.getOptions():Object.freeze(Object.assign(Object.assign({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:Ae.CLONE_OFF},e),{context:e!=null&&e.context?Ye.from(e==null?void 0:e.context):Ye.init({})}))}var $;(function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window"})($||($={}));class Ye{constructor(t){this.operators=Tn(t)}static init(t){return new Ye(Ar({[$.ACCUMULATOR]:{},[$.EXPRESSION]:{},[$.PIPELINE]:{},[$.PROJECTION]:{},[$.QUERY]:{},[$.WINDOW]:{}},t,{skipValidation:!0}))}static from(t){return new Ye(t.operators)}addOperators(t,r){for(const[n,i]of Object.entries(r))this.getOperator(t,n)||(this.operators[t][n]=i);return this}addAccumulatorOps(t){return this.addOperators($.ACCUMULATOR,t)}addExpressionOps(t){return this.addOperators($.EXPRESSION,t)}addQueryOps(t){return this.addOperators($.QUERY,t)}addPipelineOps(t){return this.addOperators($.PIPELINE,t)}addProjectionOps(t){return this.addOperators($.PROJECTION,t)}addWindowOps(t){return this.addOperators($.WINDOW,t)}getOperator(t,r){return t in this.operators&&this.operators[t][r]||null}}const Ds=Ye.init({});function no(e,t){for(const[r,n]of Object.entries(t)){ne(tl(n)&&Dt(r),`'${r}' is not a valid operator`);const i=He(e,r,null);ne(!i||n===i,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}Ds.addOperators(e,t)}function He(e,t,r){const{context:n,useGlobalContext:i}=r||{},o=n?n.getOperator(e,t):null;return!o&&i?Ds.getOperator(e,t):o}const io={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},$n={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(e,t,r){if(!be(t,"$cond"))return e;let n;for(const[i,o]of Object.entries(e))if(Vr(o)){if(o instanceof Array){const s=[];for(let a of o)q(a)&&(a=oo(a,t,r.update(a))),z(a)||s.push(a);n=s}else n=oo(o,t,r.update(o));z(n)?delete e[i]:e[i]=n}return e}};function fe(e,t,r,n){var i;const o=Ue.init(n,e);if(r=r||"",Dt(r)){const s=He($.EXPRESSION,r,n);if(s)return s(e,t,o);const a=He($.ACCUMULATOR,r,n);if(a)return e instanceof Array||(e=fe(e,t,null,o),t=null),ne(e instanceof Array,`'${r}' target must be an array.`),a(e,t,o.update(null,o.local));throw new Error(`operator '${r}' is not registered`)}if(xe(t)&&t.length>0&&t[0]==="$"){if(be($n,t))return t;let s=o.root;const a=t.split(".");if(be(io,a[0]))s=io[a[0]](e,null,o),t=t.slice(a[0].length+1);else if(a[0].slice(0,2)==="$$"){s=Object.assign({},o.variables,{this:e},(i=o.local)===null||i===void 0?void 0:i.variables);const u=a[0].slice(2);ne(be(s,u),`Use of undefined variable: ${u}`),t=t.slice(2)}else t=t.slice(1);return t===""?s:Si(s,t)}if(Y(t))return t.map(s=>fe(e,s,null,o));if(q(t)){const s={};for(const[a,u]of Object.entries(t))if(s[a]=fe(e,u,a,o),[$.EXPRESSION,$.ACCUMULATOR].some(c=>!!He(c,a,n)))return ne(Object.keys(t).length===1,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),s[a];return s}return t}function oo(e,t,r){const n=fe(e,t,null,r);return be($n,n)?$n[n](e,t,r):n}function Et(e){return e instanceof so?e:new so(e)}function cl(...e){let t=0;return Et(()=>{for(;t<e.length;){const r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function ll(e){return!!e&&typeof e=="object"&&(e==null?void 0:e.next)instanceof Function}function fl(e,t){const r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}const Kn=new Error;var he;(function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"})(he||(he={}));function hl(e,t,r){let n=!1,i=-1,o=0;return function(s){try{e:for(;!n;){let a=e();i++;let u=-1;const c=t.length;let l=!1;for(;++u<c;){const f=t[u];switch(f.action){case he.MAP:a=f.func(a,i);break;case he.FILTER:if(!f.func(a,i))continue e;break;case he.TAKE:--f.count,f.count||(l=!0);break;case he.DROP:--f.count,f.count||fl(t,u);continue e;default:break e}}if(n=l,s)r[o++]=a;else return{value:a,done:!1}}}catch(a){if(a!==Kn)throw a}return n=!0,{done:n}}}class so{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),ll(t)){const n=t;r=()=>{const i=n.next();if(i.done)throw Kn;return i.value}}else if(t instanceof Array){const n=t,i=n.length;let o=0;r=()=>{if(o<i)return n[o++];throw Kn}}else if(!(t instanceof Function))throw new Error(`Source is of type '${typeof t}'. Must be Array, Function, or Generator`);this.getNext=hl(r,this.iteratees,this.yieldedValues)}push(t,r){return typeof r=="function"?this.iteratees.push({action:t,func:r}):typeof r=="number"&&this.iteratees.push({action:t,count:r}),this}next(){return this.getNext()}map(t){return this.push(he.MAP,t)}filter(t){return this.push(he.FILTER,t)}take(t){return t>0?this.push(he.TAKE,t):this}drop(t){return t>0?this.push(he.DROP,t):this}transform(t){const r=this;let n;return Et(()=>(n||(n=Et(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(t){for(;;){const r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}}class dl{constructor(t,r){this.pipeline=t,this.options=Ss(r)}stream(t){let r=Et(t);const n=this.options.processingMode;(n==Ae.CLONE_ALL||n==Ae.CLONE_INPUT)&&r.map(Tn);const i=new Array;if(!St(this.pipeline))for(const o of this.pipeline){const s=Object.keys(o),a=s[0],u=He($.PIPELINE,a,this.options);ne(s.length===1&&!!u,`invalid pipeline operator ${a}`),i.push(a),r=u(r,o[a],this.options)}return(n==Ae.CLONE_OUTPUT||n==Ae.CLONE_ALL&&Es([["$group","$unwind"],i]).length)&&r.map(Tn),r}run(t){return this.stream(t).value()}}class pl{constructor(t,r,n,i){this.source=t,this.predicate=r,this.projection=n,this.options=i,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result?this.result:(q(this.projection)&&this.operators.push({$project:this.projection}),this.result=Et(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new dl(this.operators,this.options).stream(this.result)),this.result)}fetchAll(){const t=Et([...this.buffer]);return this.buffer=[],cl(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.operators.push({$skip:t}),this}limit(t){return this.operators.push({$limit:t}),this}sort(t){return this.operators.push({$sort:t}),this}collation(t){return this.options=Object.assign(Object.assign({},this.options),{collation:t}),this}next(){if(this.buffer.length>0)return this.buffer.pop();const t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.buffer.length>0)return!0;const t=this.fetch().next();return t.done?!1:(this.buffer.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}class ir{constructor(t,r){this.condition=t,this.options=Ss(r),this.compiled=[],this.compile()}compile(){ne(q(this.condition),"query criteria must be an object");const t={};for(const[r,n]of Object.entries(this.condition)){if(r==="$where")Object.assign(t,{field:r,expr:n});else if(_t(["$and","$or","$nor","$expr","$jsonSchema"],r))this.processOperator(r,r,n);else{ne(!Dt(r),`unknown top level operator: ${r}`);for(const[i,o]of Object.entries(Cs(n)))this.processOperator(r,i,o)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){const i=He($.QUERY,r,this.options);if(!i)throw new Error(`unknown operator ${r}`);const o=i(t,n,this.options);this.compiled.push(o)}test(t){for(let r=0,n=this.compiled.length;r<n;r++)if(!this.compiled[r](t))return!1;return!0}find(t,r){return new pl(t,n=>this.test(n),r||{},this.options)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}}function X(e){const t=(r,n,i)=>{const o={unwrapArray:!0},s=Math.max(1,r.split(".").length-1);return a=>{const u=Si(a,r,o);return e(u,n,Object.assign(Object.assign({},i),{depth:s}))}};return t.op="query",t}function ks(e,t,r){if(Ve(e,t)||z(e)&&z(t))return!0;if(e instanceof Array){const n=Ve.bind(null,t);return e.some(n)||Os(e,r==null?void 0:r.depth).some(n)}return!1}function ml(e,t,r){return!ks(e,t,r)}function Rs(e,t,r){return z(e)?t.some(n=>n===null):Es([nr(e),t],r==null?void 0:r.hashFunction).length>0}function yl(e,t,r){return!Rs(e,t,r)}function vl(e,t,r){return Gr(e,t,(n,i)=>ce(n,i)<0)}function gl(e,t,r){return Gr(e,t,(n,i)=>ce(n,i)<=0)}function bl(e,t,r){return Gr(e,t,(n,i)=>ce(n,i)>0)}function wl(e,t,r){return Gr(e,t,(n,i)=>ce(n,i)>=0)}function _l(e,t,r){return nr(e).some(n=>t.length===2&&n%t[0]===t[1])}function El(e,t,r){const n=nr(e),i=o=>xe(o)&&rl(t.exec(o),r==null?void 0:r.useStrictMode);return n.some(i)||Os(n,1).some(i)}function Ol(e,t,r){return(t===!1||t===0)&&e===void 0||(t===!0||t===1)&&e!==void 0}function xl(e,t,r){if(!Y(e)||!Y(t)||!e.length||!t.length)return!1;let n=!0;for(const i of t){if(!n)break;q(i)&&_t(Object.keys(i),"$elemMatch")?n=Ps(e,i.$elemMatch,r):i instanceof RegExp?n=e.some(o=>typeof o=="string"&&i.test(o)):n=e.some(o=>Ve(i,o))}return n}function Cl(e,t,r){return Array.isArray(e)&&e.length===t}function Sl(e){return Dt(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Ps(e,t,r){if(Y(e)&&!St(e)){let n=s=>s,i=t;Object.keys(t).every(Sl)&&(i={temp:t},n=s=>({temp:s}));const o=new ir(i,r);for(let s=0,a=e.length;s<a;s++)if(o.test(n(e[s])))return!0}return!1}const ao=e=>e===null,uo=e=>ke(e)&&e>=Vc&&e<=zc&&e.toString().indexOf(".")===-1,co=e=>ke(e)&&e>=Yc&&e<=Gc&&e.toString().indexOf(".")===-1,Dl={array:Y,bool:un,boolean:un,date:Xi,decimal:ke,double:ke,int:uo,long:co,number:ke,null:ao,object:q,regex:wr,regexp:wr,string:xe,undefined:z,function:e=>{throw new Error("unsupported type key `function`.")},1:ke,2:xe,3:q,4:Y,6:z,8:un,9:Xi,10:ao,11:wr,16:uo,18:co,19:ke};function lo(e,t,r){const n=Dl[t];return n?n(e):!1}function kl(e,t,r){return Array.isArray(t)?t.findIndex(n=>lo(e,n))>=0:lo(e,t)}function Gr(e,t,r){return nr(e).some(n=>Oe(n)===Oe(t)&&r(n,t))}const fo=(e,t)=>{const r={};return e.split("").forEach((n,i)=>r[n]=t*(i+1)),r};Object.assign(Object.assign(Object.assign({},fo("ABCDEFGHIKLM",1)),fo("NOPQRSTUVWXY",-1)),{Z:0});const ho={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function re(e,t=ho){const r=Object.assign({},ho,t),n=new Set(Object.keys(r));return(i,o,s)=>{const a=fe(i,o,null,s);if(n.has(`${a}`)){const u=r[`${a}`];if(u instanceof Error)throw new Error(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return u}return e(a)}}re(Math.acos,{Infinity:1/0,0:new Error});re(Math.acosh,{Infinity:1/0,0:new Error});re(Math.asin);re(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});re(Math.atan);re(Math.atanh,{1:1/0,"-1":-1/0});re(Math.cos);re(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const Rl=Math.PI/180;re(e=>e*Rl,{Infinity:1/0,"-Infinity":1/0});const Pl=180/Math.PI;re(e=>e*Pl,{Infinity:1/0,"-Infinity":-1/0});re(Math.sin);re(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});re(Math.tan);const Il=(e,t,r)=>{if(St(t)||!q(t))return e;let n=ce;const i=r.collation;return q(i)&&xe(i.locale)&&(n=Tl(i)),e.transform(o=>{const s=Object.keys(t);for(const a of s.reverse()){const u=ol(o,l=>Si(l,a),r.hashFunction),c=Array.from(u.keys()).sort(n);t[a]===-1&&c.reverse(),o=[],c.reduce((l,f)=>Ge(l,u.get(f)),o)}return o})},Al={1:"base",2:"accent",3:"variant"};function Tl(e){const t={sensitivity:Al[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));const r=new Intl.Collator(e.locale,t);return(n,i)=>{if(!xe(n)||!xe(i))return ce(n,i);const o=r.compare(n,i);return o<0?-1:o>0?1:0}}const Ml=(e,t,r)=>{if(St(t))return e;let n=Object.keys(t),i=!1;Is(t,r);const o=r.idKey;if(_t(n,o)){const a=t[o];(a===0||a===!1)&&(n=n.filter(_s.bind(null,[o])),i=n.length==0)}else n.push(o);const s=Ue.init(r);return e.map(a=>Bn(a,t,s.update(a),n,i))};function Bn(e,t,r,n,i){let o={},s=!1,a=!1;const u=[];i&&u.push(r.idKey);for(const c of n){let l;const f=t[c];if(c!==r.idKey&&_t([0,!1],f)&&(a=!0),c===r.idKey&&St(f))l=e[c];else if(xe(f))l=fe(e,f,c,r);else if(!_t([1,!0],f))if(f instanceof Array)l=f.map(d=>{const m=fe(e,d,null,r);return z(m)?null:m});else if(q(f)){const d=f,m=Object.keys(f),p=m.length==1?m[0]:"",g=He($.PROJECTION,p,r);if(g)p==="$slice"?nr(d[p]).every(ke)?(l=g(e,d[p],c,r),s=!0):l=fe(e,d,c,r):l=g(e,d[p],c,r);else if(Dt(p))l=fe(e,d[p],p,r);else if(be(e,c)){Is(d,r);let y=e[c];y instanceof Array?l=y.map(v=>Bn(v,d,r,m,!1)):(y=q(y)?y:e,l=Bn(y,d,r,m,!1))}else l=fe(e,f,null,r)}else{u.push(c);continue}const h=_r(e,c,{preserveMissing:!0});h!==void 0&&Ar(o,h,{flatten:!0}),_s([0,1,!1,!0],f)&&(l===void 0?ro(o,c,{descendArray:!0}):al(o,c,l))}if(Nn(o),(s||a||i)&&(o=Ge({},e,o),u.length>0))for(const c of u)ro(o,c,{descendArray:!0});return o}function Is(e,t){const r=[!1,!1];for(const[n,i]of Object.entries(e)){if(n===(t==null?void 0:t.idKey))return;i===0||i===!1?r[0]=!0:(i===1||i===!0)&&(r[1]=!0),ne(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Nl=(e,t,r)=>{ne(Y(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(i=>new ir(i,r));return i=>n.every(o=>o.test(i))},As=(e,t,r)=>{ne(Y(t),"Invalid expression. $or expects value to be an Array");const n=t.map(i=>new ir(i,r));return i=>n.some(o=>o.test(i))},$l=(e,t,r)=>{ne(Y(t),"Invalid expression. $nor expects value to be an array.");const n=As("$or",t,r);return i=>!n(i)},Kl=(e,t,r)=>{const n={};n[e]=Cs(t);const i=new ir(n,r);return o=>!i.test(o)},Bl=X(ks),Ll=X(bl),Fl=X(wl),ql=X(Rs),jl=X(vl),Ul=X(gl),Hl=X(ml),Wl=X(yl),Ql=X(_l),zl=X(El);X(xl);const Vl=X(Ps),Gl=X(Cl),Yl=X(Ol),Jl=X(kl);var po=!1;function Xl(e){return po||(no($.PIPELINE,{$sort:Il,$project:Ml}),no($.QUERY,{$and:Nl,$eq:Bl,$elemMatch:Vl,$exists:Yl,$gt:Ll,$gte:Fl,$in:ql,$lt:jl,$lte:Ul,$ne:Hl,$nin:Wl,$mod:Ql,$nor:$l,$not:Kl,$or:As,$regex:zl,$size:Gl,$type:Jl}),po=!0),new ir(e)}function Ln(e,t){var r=Le(e.primaryKey);t=H(t),t.selector&&(t.selector=Fn(t.selector));var n=ct(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([c,l])=>{(typeof l!="object"||l===null)&&(n.selector[c]={$eq:l})})):n.selector={},n.index){var i=Ca(n.index);i.includes(r)||i.push(r),n.index=i}if(n.sort){var u=n.sort.find(c=>Fa(c)===r);u||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(c=>({[c]:"asc"}));else{if(e.indexes){var o=new Set;Object.entries(n.selector).forEach(([c,l])=>{var f=!1;typeof l=="object"&&l!==null?f=!!Object.keys(l).find(h=>Ci.has(h)):f=!0,f&&o.add(c)});var s=-1,a;e.indexes.forEach(c=>{var l=ut(c)?c:[c],f=l.findIndex(h=>!o.has(h));f>0&&f>s&&(s=f,a=l)}),a&&(n.sort=a.map(c=>({[c]:"asc"})))}n.sort||(n.sort=[{[r]:"asc"}])}return n}function Fn(e){if(typeof e!="object"||e===null)return e;var t=Object.keys(e),r={};return t.forEach(n=>{var i=e[n];if(n==="$regex"&&i instanceof RegExp){var o=Ha(i);r.$regex=o.pattern,r.$options=o.flags}else Array.isArray(i)?r[n]=i.map(s=>Fn(s)):r[n]=Fn(i)}),r}function Zl(e,t){if(!t.sort)throw _("SNH",{query:t});var r=[];t.sort.forEach(i=>{var o=Object.keys(i)[0],s=Object.values(i)[0];r.push({key:o,direction:s,getValueFn:La(o)})});var n=(i,o)=>{for(var s=0;s<r.length;++s){var a=r[s],u=a.getValueFn(i),c=a.getValueFn(o);if(u!==c){var l=a.direction==="asc"?ce(u,c):ce(c,u);return l}}};return n}function Ts(e,t){if(!t.sort)throw _("SNH",{query:t});var r=Xl(t.selector),n=i=>{if(i._deleted)return!1;var o=r.find([i]),s=o.next();return!!s};return n}function ef(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(r=>Object.keys(r)[0])}var tf=new WeakMap;function rf(e){return yt(tf,e,()=>{var t=e.collection,r=Ln(t.storageInstance.schema,ct(e.mangoQuery)),n=t.schema.primaryPath,i=Zl(t.schema.jsonSchema,r),o=(c,l)=>{var f={docA:c,docB:l,rxQuery:e};return i(f.docA,f.docB)},s=Ts(t.schema.jsonSchema,r),a=c=>{var l={doc:c,rxQuery:e};return s(l.doc)},u={primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:ef(n,r),sortComparator:o,queryMatcher:a};return u})}function nf(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=rf(e),n=j(e._result).docsData.slice(0),i=j(e._result).docsDataMap,o=!1,s=t.map(u=>Nu(u)).filter(Sa),a=s.find(u=>{var c={queryParams:r,changeEvent:u,previousResults:n,keyDocumentMap:i},l=Fc(c);if(l==="runFullQueryAgain")return!0;if(l!=="doNothing")return o=!0,qc(l,r,u,n,i),!1});return a?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:o,newResults:n}}var of=function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(n){var i=n.toString();return yt(this._map,i,()=>n)},e}();function sf(){return new of}function mo(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function af(e){return e.refCount$.observers.length}var uf=100,cf=30*1e3,lf=(e,t)=>(r,n)=>{if(!(n._map.size<e)){var i=ye()-t,o=[],s=Array.from(n._map.values());for(var a of s)if(!(af(a)>0)){if(a._lastEnsureEqual===0&&a._creationTime<i){mo(n,a);continue}o.push(a)}var u=o.length-e;if(!(u<=0)){var c=o.sort((f,h)=>f._lastEnsureEqual-h._lastEnsureEqual),l=c.slice(0,u);l.forEach(f=>mo(n,f))}}},Ms=lf(uf,cf),ln=new WeakSet;function ff(e){ln.has(e)||(ln.add(e),Pa().then(()=>Ta(200)).then(()=>{e.destroyed||e.cacheReplacementPolicy(e,e._queryCache),ln.delete(e)}))}var hf=0,df=function(){return++hf},pf=function(){function e(r,n,i,o={}){this.id=df(),this._execOverDatabaseCount=0,this._creationTime=ye(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new Au(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=Re,this.op=r,this.mangoQuery=n,this.collection=i,this.other=o,n||(this.mangoQuery=Er()),this.isFindOneByIdQuery=gf(this.collection.schema.primaryPath,n)}var t=e.prototype;return t._setResultData=function(n){if(typeof n=="number"){this._result={docsData:[],docsMap:new Map,docsDataMap:new Map,count:n,docs:[],time:ye()};return}else n instanceof Map&&(n=Array.from(n.values()));var i=new Map,o=new Map,s=n.map(u=>this.collection._docCache.getCachedRxDocument(u)),a=s.map(u=>(i.set(u.primary,u._data),o.set(u.primary,u),u._data));this._result={docsData:a,docsMap:o,docsDataMap:i,count:a.length,docs:s,time:ye()}},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=ye(),this.op==="count"){var n=this.getPreparedQuery(),i=await this.collection.storageInstance.count(n);if(i.mode==="slow"&&!this.collection.database.allowSlowCount)throw _("QU14",{collection:this.collection,queryObj:this.mangoQuery});return i.count}if(this.op==="findByIds"){var o=j(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,s=new Map,a=[];if(o.forEach(l=>{var f=this.collection._docCache.getLatestDocumentDataIfExists(l);if(f){if(!f._deleted){var h=this.collection._docCache.getCachedRxDocument(f);s.set(l,h)}}else a.push(l)}),a.length>0){var u=await this.collection.storageInstance.findDocumentsById(a,!1);Object.values(u).forEach(l=>{var f=this.collection._docCache.getCachedRxDocument(l);s.set(f.primary,f)})}return s}var c=vf(this);return c.then(l=>(this._lastExecEnd=ye(),l))},t.exec=function(n){if(n&&this.op!=="findOne")throw _("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return yo(this).then(()=>Ju(this.$)).then(i=>{if(!i&&n)throw _("QU10",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return i})},t.toString=function(){var n=Pr({op:this.op,query:this.mangoQuery,other:this.other},!0),i=JSON.stringify(n,qa);return this.toString=()=>i,i},t.getPreparedQuery=function(){var n={rxQuery:this,mangoQuery:Ln(this.collection.schema.jsonSchema,this.mangoQuery)};Ee("prePrepareQuery",n);var i=this.collection.database.storage.statics.prepareQuery(this.collection.schema.jsonSchema,n.mangoQuery);return this.getPreparedQuery=()=>i,i},t.doesDocumentDataMatch=function(n){return n._deleted?!1:this.queryMatcher(n)},t.remove=function(){return this.exec().then(n=>Array.isArray(n)?Promise.all(n.map(i=>i.remove())):n.remove())},t.update=function(n){throw M("update")},t.where=function(n){throw M("query-builder")},t.sort=function(n){throw M("query-builder")},t.skip=function(n){throw M("query-builder")},t.limit=function(n){throw M("query-builder")},Ct(e,[{key:"$",get:function(){if(!this._$){var r=this.collection.$.pipe(se(n=>!n.isLocal),us(null),er(()=>yo(this)),Ie(()=>this._result),as($o),In((n,i)=>!!(n&&n.time===j(i).time)),se(n=>!!n),Ie(n=>{var i=j(n);return this.op==="count"?i.count:this.op==="findOne"?i.docs.length===0?null:i.docs[0]:this.op==="findByIds"?i.docsMap:i.docs.slice(0)}));this._$=Xu(r,this.refCount$.pipe(se(()=>!1)))}return this._$}},{key:"queryMatcher",get:function(){var r=this.collection.schema.jsonSchema,n=Ln(this.collection.schema.jsonSchema,this.mangoQuery);return vr(this,"queryMatcher",Ts(r,n))}},{key:"asRxQuery",get:function(){return this}}]),e}();function Er(){return{selector:{}}}function mf(e){return e.collection._queryCache.getByQuery(e)}function It(e,t,r,n){Ee("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:n});var i=new pf(e,t,r,n);return i=mf(i),ff(r),i}function Ns(e){var t=e.asRxQuery.collection._changeEventBuffer.counter;return e._latestChangeEvent>=t}function yo(e){return e.collection.database.destroyed||Ns(e)?Re:(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>yf(e)),e._ensureEqualQueue)}function yf(e){if(e._lastEnsureEqual=ye(),e.collection.database.destroyed||Ns(e))return Re;var t=!1,r=!1;if(e._latestChangeEvent===-1&&(r=!0),!r){var n=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(n===null)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.counter;var i=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(n);if(e.op==="count"){var o=j(e._result).count,s=o;i.forEach(c=>{var l=c.previousDocumentData&&e.doesDocumentDataMatch(c.previousDocumentData),f=e.doesDocumentDataMatch(c.documentData);!l&&f&&s++,l&&!f&&s--}),s!==o&&(t=!0,e._setResultData(s))}else{var a=nf(e,i);a.runFullQueryAgain?r=!0:a.changed&&(t=!0,e._setResultData(a.newResults))}}}if(r){var u=e.collection._changeEventBuffer.counter;return e._execOverDatabase().then(c=>(e._latestChangeEvent=u,typeof c=="number"?((!e._result||c!==e._result.count)&&(t=!0,e._setResultData(c)),t):((!e._result||!Ra(e.collection.schema.primaryPath,c,e._result.docsData))&&(t=!0,e._setResultData(c)),t)))}return Promise.resolve(t)}async function vf(e){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var n=e.isFindOneByIdQuery;if(n=n.filter(l=>{var f=e.collection._docCache.getLatestDocumentDataIfExists(l);return f?(f._deleted||t.push(f),!1):!0}),n.length>0){var i=await r.storageInstance.findDocumentsById(n,!1);Object.values(i).forEach(l=>{t.push(l)})}}else{var o=e.isFindOneByIdQuery,s=e.collection._docCache.getLatestDocumentDataIfExists(o);if(!s){var a=await r.storageInstance.findDocumentsById([o],!1);a.hasOwnProperty(o)&&(s=a[o])}s&&!s._deleted&&t.push(s)}else{var u=e.getPreparedQuery(),c=await r.storageInstance.query(u);t=c.documents}return t}function gf(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var r=t.selector[e];if(typeof r=="string")return r;if(Object.keys(r).length===1&&typeof r.$eq=="string"||Object.keys(r).length===1&&Array.isArray(r.$eq)&&!r.$eq.find(n=>typeof n!="string"))return r.$eq}return!1}var $t="collection",Di="storage-token",bf="RxInternalDocument",ki=ls({version:0,title:bf,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[$t,Di,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function qn(e,t){return bi(ki,{key:e,context:t})}async function $s(e,t){var r=e.prepareQuery(t.schema,{selector:{context:$t},sort:[{id:"asc"}],skip:0}),n=await t.query(r),i=n.documents;return i}var Ks="storageToken",cr=qn(Ks,Di);async function wf(e){var t=Ao(10),r=e.password?e.hashFunction(JSON.stringify(e.password)):void 0,n={id:cr,context:Di,key:Ks,data:{token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:jr(),_rev:Ur(),_attachments:{}},i=await e.internalStore.bulkWrite([{document:n}],"internal-add-storage-token");if(i.success[cr])return i.success[cr];var o=j(i.error[cr]);if(o.isError&&o.status===409){var s=o;if(r&&r!==s.documentInDb.data.passwordHash)throw _("DB1",{passwordHash:r,existingPasswordHash:s.documentInDb.data.passwordHash});var a=s.documentInDb;return j(a)}throw o}function vo(e,t){return e+"-"+t.version}function fn(e,t){return t=H(t),t=Lu(e,t),t=$u(e.primaryPath,e.jsonSchema,t),t._meta=jr(),t.hasOwnProperty("_deleted")||(t._deleted=!1),t.hasOwnProperty("_attachments")||(t._attachments={}),t.hasOwnProperty("_rev")||(t._rev=Ur()),t}async function _f(e,t){t.multiInstance=e.multiInstance;var r=await e.storage.createStorageInstance(t);return r}async function Bs(e,t,r,n,i,o){var s=await $s(e.statics,t),a=s.filter(f=>f.data.name===i),u=[];a.forEach(f=>{u.push({collectionName:f.data.name,schema:f.data.schema,isCollection:!0}),f.data.connectedStorages.forEach(h=>u.push({collectionName:h.collectionName,isCollection:!1,schema:h.schema}))});var c=new Set;if(u=u.filter(f=>{var h=f.collectionName+"||"+f.schema.version;return c.has(h)?!1:(c.add(h),!0)}),await Promise.all(u.map(async f=>{var h=await e.createStorageInstance({collectionName:f.collectionName,databaseInstanceToken:r,databaseName:n,multiInstance:!1,options:{},schema:f.schema,devMode:te.isDevMode()});await h.remove(),f.isCollection&&await Hr("postRemoveRxCollection",{storage:e,databaseName:n,collectionName:i})})),o){var l=a.map(f=>{var h=hs(f);return h._deleted=!0,h._meta.lwt=ye(),h._rev=On(r,f),{previous:f,document:h}});await t.bulkWrite(l,"rx-database-remove-collection-all")}}var Ef=function(){function e(r,n,i){this.cacheItemByDocId=new Map,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(o=>{var s=o.docId,a=this.cacheItemByDocId.get(s);a&&(a.documentByRevisionHeight.delete(o.revisionHeight),a.documentByRevisionHeight.size===0&&this.cacheItemByDocId.delete(s))}):void 0,this.primaryPath=r,this.changes$=n,this.documentCreator=i,n.subscribe(o=>{var s=o.documentId,a=this.cacheItemByDocId.get(s);if(a){var u=cs(o);a.latestDoc=u}})}var t=e.prototype;return t.getCachedRxDocument=function(n){var i=n[this.primaryPath],o=Da(n._rev),s=yt(this.cacheItemByDocId,i,()=>Of(n)),a=s.documentByRevisionHeight.get(o),u=a?a.deref():void 0;return u||(n=te.deepFreezeWhenDevMode(n),u=this.documentCreator(n),s.documentByRevisionHeight.set(o,Cf(u)),this.registry&&this.registry.register(u,{docId:i,revisionHeight:o})),u},t.getLatestDocumentData=function(n){var i=Wt(this.cacheItemByDocId,n);return i.latestDoc},t.getLatestDocumentDataIfExists=function(n){var i=this.cacheItemByDocId.get(n);if(i)return i.latestDoc},e}();function Of(e){return{documentByRevisionHeight:new Map,latestDoc:e}}var xf=typeof WeakRef=="function";function Cf(e){return xf?new WeakRef(e):{deref(){return e}}}var Sf=function(){function e(r){this.subs=[],this.limit=100,this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.collection=r,this.subs.push(this.collection.$.pipe(se(n=>!n.isLocal)).subscribe(n=>this._handleChangeEvent(n)))}var t=e.prototype;return t._handleChangeEvent=function(n){for(this.counter++,this.buffer.push(n),this.eventCounterMap.set(n,this.counter);this.buffer.length>this.limit;)this.buffer.shift()},t.getArrayIndexByPointer=function(n){var i=this.buffer[0],o=this.eventCounterMap.get(i);if(n<o)return null;var s=n-o;return s},t.getFrom=function(n){var i=[],o=this.getArrayIndexByPointer(n);if(o===null)return null;for(;;){var s=this.buffer[o];if(o++,s)i.push(s);else return i}},t.runFrom=function(n,i){var o=this.getFrom(n);if(o===null)throw new Error("out of bounds");o.forEach(s=>i(s))},t.reduceByLastOfDoc=function(n){return n.slice(0)},t.destroy=function(){this.subs.forEach(n=>n.unsubscribe())},e}();function Df(e){return new Sf(e)}var kf=new WeakMap;function Rf(e){var t=e.schema.getDocumentPrototype(),r=Af(e),n=Qr,i={};return[t,r,n].forEach(o=>{var s=Object.getOwnPropertyNames(o);s.forEach(a=>{var u=Object.getOwnPropertyDescriptor(o,a),c=!0;(a.startsWith("_")||a.endsWith("_")||a.startsWith("$")||a.endsWith("$"))&&(c=!1),typeof u.value=="function"?Object.defineProperty(i,a,{get(){return u.value.bind(this)},enumerable:c,configurable:!1}):(u.enumerable=c,u.configurable=!1,u.writable&&(u.writable=!1),Object.defineProperty(i,a,u))})}),i}function Pf(e){return yt(kf,e,()=>ps(Rf(e)))}function If(e,t){var r=Qu(Pf(e),e,te.deepFreezeWhenDevMode(t));return e._runHooksSync("post","create",t,r),Ee("postCreateRxDocument",r),r}function Af(e){var t={};return Object.entries(e.methods).forEach(([r,n])=>{t[r]=n}),t}var Ls=function(e,t){return Ht(e.newDocumentState,e.realMasterState)?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})},Fs=["pre","post"],qs=["insert","save","remove","create"],go=!1,js=function(){function e(r,n,i,o,s={},a={},u={},c={},l={},f=Ms,h={},d=Ls){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=sf(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.database=r,this.name=n,this.schema=i,this.internalStorageInstance=o,this.instanceCreationOptions=s,this.migrationStrategies=a,this.methods=u,this.attachments=c,this.options=l,this.cacheReplacementPolicy=f,this.statics=h,this.conflictHandler=d,Tf(this.asRxCollection)}var t=e.prototype;return t.prepare=async function(){this.storageInstance=ds(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new Hu(this.storageInstance,this.schema.primaryPath,(s,a)=>ys(this,s,a),s=>this._runHooks("post","save",s));var n=this.database.eventBulks$.pipe(se(s=>s.collectionName===this.name));this.$=n.pipe(er(s=>s.events)),this.checkpoint$=n.pipe(Ie(s=>s.checkpoint)),this._changeEventBuffer=Df(this.asRxCollection),this._docCache=new Ef(this.schema.primaryPath,this.$.pipe(se(s=>!s.isLocal)),s=>If(this.asRxCollection,s));var i=await this.database.storageToken,o=this.storageInstance.changeStream().subscribe(s=>{var a={id:s.id,internal:!1,collectionName:this.name,storageToken:i,events:s.events.map(u=>Uu(!1,u,this)),databaseToken:this.database.token,checkpoint:s.checkpoint,context:s.context};this.database.$emit(a)});return this._subs.push(o),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe(s=>{this.conflictHandler(s.input,s.context).then(a=>{this.storageInstance.resolveConflictResultionTask({id:s.id,output:a})})})),Nt},t.migrationNeeded=function(){throw M("migration")},t.getDataMigrator=function(){throw M("migration")},t.migrate=function(n=10){return this.getDataMigrator().migrate(n)},t.migratePromise=function(n=10){return this.getDataMigrator().migratePromise(n)},t.insert=async function(n){var i=await this.bulkInsert([n]),o=i.error[0];An(this,n[this.schema.primaryPath],n,o);var s=j(i.success[0]);return s},t.bulkInsert=async function(n){if(n.length===0)return{success:[],error:[]};var i=this.schema.primaryPath,o=n.map(f=>{var h=fn(this.schema,f);return h}),s=this.hasHooks("pre","insert")?await Promise.all(o.map(f=>this._runHooks("pre","insert",f).then(()=>f))):o,a=new Map,u=s.map(f=>{a.set(f[i],f);var h={document:f};return h}),c=await this.storageInstance.bulkWrite(u,"rx-collection-bulk-insert"),l=Object.values(c.success).map(f=>this._docCache.getCachedRxDocument(f));return this.hasHooks("post","insert")&&await Promise.all(l.map(f=>this._runHooks("post","insert",a.get(f.primary),f))),{success:l,error:Object.values(c.error)}},t.bulkRemove=async function(n){if(n.length===0)return{success:[],error:[]};var i=await this.findByIds(n).exec(),o=[],s=new Map;Array.from(i.values()).forEach(f=>{var h=f.toMutableJSON(!0);o.push(h),s.set(f.primary,h)}),await Promise.all(o.map(f=>{var h=f[this.schema.primaryPath];return this._runHooks("pre","remove",f,i.get(h))}));var a=o.map(f=>{var h=H(f);return h._deleted=!0,{previous:f,document:h}}),u=await this.storageInstance.bulkWrite(a,"rx-collection-bulk-remove"),c=Object.keys(u.success);await Promise.all(c.map(f=>this._runHooks("post","remove",s.get(f),i.get(f))));var l=c.map(f=>Wt(i,f));return{success:l,error:Object.values(u.error)}},t.bulkUpsert=async function(n){var i=[],o=new Map;n.forEach(c=>{var l=fn(this.schema,c),f=l[this.schema.primaryPath];if(!f)throw _("COL3",{primaryPath:this.schema.primaryPath,data:l,schema:this.schema.jsonSchema});o.set(f,l),i.push(l)});var s=await this.bulkInsert(i),a=s.success.slice(0),u=await Promise.all(s.error.map(async c=>{if(c.status!==409)throw _("VD2",{collection:this.name,writeError:c});var l=c.documentId,f=Wt(o,l),h=j(c.documentInDb),d=this._docCache.getCachedRxDocument(h),m=await d.incrementalModify(()=>f);return m}));return di(a,u),a},t.upsert=function(n){return this.bulkUpsert([n]).then(i=>i[0])},t.incrementalUpsert=function(n){var i=fn(this.schema,n),o=i[this.schema.primaryPath];if(!o)throw _("COL4",{data:n});var s=this._incrementalUpsertQueues.get(o);return s||(s=Nt),s=s.then(()=>Nf(this,o,i)).then(a=>a.inserted?a.doc:Mf(a.doc,i)),this._incrementalUpsertQueues.set(o,s),s},t.find=function(n){if(typeof n=="string")throw _("COL5",{queryObj:n});n||(n=Er());var i=It("find",n,this);return i},t.findOne=function(n){var i;if(typeof n=="string")i=It("findOne",{selector:{[this.schema.primaryPath]:n},limit:1},this);else{if(n||(n=Er()),n.limit)throw _("QU6");n.limit=1,i=It("findOne",n,this)}if(typeof n=="number"||Array.isArray(n))throw ae("COL6",{queryObj:n});return i},t.count=function(n){n||(n=Er());var i=It("count",n,this);return i},t.findByIds=function(n){var i={selector:{[this.schema.primaryPath]:{$in:n.slice(0)}}},o=It("findByIds",i,this);return o},t.exportJSON=function(){throw M("json-dump")},t.importJSON=function(n){throw M("json-dump")},t.insertCRDT=function(n){throw M("crdt")},t.addHook=function(n,i,o,s=!1){if(typeof o!="function")throw ae("COL7",{key:i,when:n});if(!Fs.includes(n))throw ae("COL8",{key:i,when:n});if(!qs.includes(i))throw _("COL9",{key:i});if(n==="post"&&i==="create"&&s===!0)throw _("COL10",{when:n,key:i,parallel:s});var a=o.bind(this),u=s?"parallel":"series";this.hooks[i]=this.hooks[i]||{},this.hooks[i][n]=this.hooks[i][n]||{series:[],parallel:[]},this.hooks[i][n][u].push(a)},t.getHooks=function(n,i){return!this.hooks[i]||!this.hooks[i][n]?{series:[],parallel:[]}:this.hooks[i][n]},t.hasHooks=function(n,i){var o=this.getHooks(n,i);return o?o.series.length>0||o.parallel.length>0:!1},t._runHooks=function(n,i,o,s){var a=this.getHooks(n,i);if(!a)return Nt;var u=a.series.map(c=>()=>c(o,s));return Ma(u).then(()=>Promise.all(a.parallel.map(c=>c(o,s))))},t._runHooksSync=function(n,i,o,s){var a=this.getHooks(n,i);a&&a.series.forEach(u=>u(o,s))},t.promiseWait=function(n){var i=new Promise(o=>{var s=setTimeout(()=>{this.timeouts.delete(s),o()},n);this.timeouts.add(s)});return i},t.destroy=function(){return this.destroyed?Re:(this.destroyed=!0,Array.from(this.timeouts).forEach(n=>clearTimeout(n)),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(n=>n()))).then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(n=>n.unsubscribe()),delete this.database.collections[this.name],Hr("postDestroyRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.destroy(),await Bs(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.hashFunction)},Ct(e,[{key:"insert$",get:function(){return this.$.pipe(se(r=>r.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(se(r=>r.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(se(r=>r.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}]),e}();function Tf(e){if(!go){go=!0;var t=Object.getPrototypeOf(e);qs.forEach(r=>{Fs.map(n=>{var i=n+To(r);t[i]=function(o,s){return this.addHook(n,r,o,s)}})})}}function Mf(e,t){return e.incrementalModify(r=>t)}function Nf(e,t,r){var n=e._docCache.getLatestDocumentDataIfExists(t);return n?Promise.resolve({doc:e._docCache.getCachedRxDocument(n),inserted:!1}):e.findOne(t).exec().then(i=>i?{doc:i,inserted:!1}:e.insert(r).then(o=>({doc:o,inserted:!0})))}function $f({database:e,name:t,schema:r,instanceCreationOptions:n={},migrationStrategies:i={},autoMigrate:o=!0,statics:s={},methods:a={},attachments:u={},options:c={},localDocuments:l=!1,cacheReplacementPolicy:f=Ms,conflictHandler:h=Ls}){var d={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:n,multiInstance:e.multiInstance,password:e.password,devMode:te.isDevMode()};return Ee("preCreateRxStorageInstance",d),_f(e,d).then(m=>{var p=new js(e,t,r,m,n,i,a,u,c,f,s,h);return p.prepare().then(()=>{Object.entries(s).forEach(([y,v])=>{Object.defineProperty(p,y,{get:()=>v.bind(p)})});var g=Nt;return o&&p.schema.version!==0&&(g=p.migratePromise()),g}).then(()=>(Ee("createRxCollection",{collection:p,creator:{name:t,schema:r,storageInstance:m,instanceCreationOptions:n,migrationStrategies:i,methods:a,attachments:u,options:c,cacheReplacementPolicy:f,localDocuments:l,statics:s}}),p)).catch(g=>m.close().then(()=>Promise.reject(g)))})}var Us=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};Us.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,jn(this)},wrapCall:function(t){var r=this;this.lock();var n;try{n=t()}catch(i){throw this.unlock(),i}return!n.then||typeof n.then!="function"?(this.unlock(),n):n.then(function(i){return r.unlock(),i}).catch(function(i){throw r.unlock(),i})},requestIdlePromise:function(t){var r=this;t=t||{};var n,i=new Promise(function(a){return n=a}),o=function(){hn(r,i),n()};if(i._manRes=o,t.timeout){var s=setTimeout(function(){i._manRes()},t.timeout);i._timeoutObj=s}return this._iC.add(i),jn(this),i},cancelIdlePromise:function(t){hn(this,t)},requestIdleCallback:function(t,r){var n=this._lHN++,i=this.requestIdlePromise(r);return this._hPM.set(n,i),this._pHM.set(i,n),i.then(function(){return t()}),n},cancelIdleCallback:function(t){var r=this._hPM.get(t);this.cancelIdlePromise(r)},clear:function(){var t=this;this._iC.forEach(function(r){return hn(t,r)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function Kf(e){if(e._iC.size!==0){var t=e._iC.values(),r=t.next().value;r._manRes(),setTimeout(function(){return jn(e)},0)}}function hn(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var r=e._pHM.get(t);e._hPM.delete(r),e._pHM.delete(t)}e._iC.delete(t)}}function jn(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}Kf(e),e._tryIR=!1},0)},0))}var Bf=function(){function e(t){this.ttl=t,this.map=new Map,this._to=!1}return e.prototype.has=function(t){return this.map.has(t)},e.prototype.add=function(t){var r=this;this.map.set(t,Hs()),this._to||(this._to=!0,setTimeout(function(){r._to=!1,Lf(r)},0))},e.prototype.clear=function(){this.map.clear()},e}();function Lf(e){for(var t=Hs()-e.ttl,r=e.map[Symbol.iterator]();;){var n=r.next().value;if(!n)return;var i=n[0],o=n[1];if(o<t)e.map.delete(i);else return}}function Hs(){return new Date().getTime()}var Ff=new Set,qf=function(){function e(r,n,i,o,s,a,u=!1,c={},l,f,h,d){this.idleQueue=new Us,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.eventBulks$=new tr,this.observable$=this.eventBulks$.pipe(er(m=>m.events)),this.storageToken=Re,this.storageTokenDocument=Re,this.emittedEventBulkIds=new Bf(60*1e3),this.name=r,this.token=n,this.storage=i,this.instanceCreationOptions=o,this.password=s,this.multiInstance=a,this.eventReduce=u,this.options=c,this.internalStore=l,this.hashFunction=f,this.cleanupPolicy=h,this.allowSlowCount=d,this.name!=="pseudoInstance"&&(this.internalStore=ds(this.asRxDatabase,l,ki),this.storageTokenDocument=wf(this.asRxDatabase).catch(m=>this.startupErrors.push(m)),this.storageToken=this.storageTokenDocument.then(m=>m.data.token).catch(m=>this.startupErrors.push(m)))}var t=e.prototype;return t.$emit=function(n){this.emittedEventBulkIds.has(n.id)||(this.emittedEventBulkIds.add(n.id),this.eventBulks$.next(n))},t.removeCollectionDoc=async function(n,i){var o=await ju(this.internalStore,qn(vo(n,i),$t));if(!o)throw _("SNH",{name:n,schema:i});var s=hs(o);s._deleted=!0,await this.internalStore.bulkWrite([{document:s,previous:o}],"rx-database-remove-collection")},t.addCollections=async function(n){var i={},o={},s=[],a={};Object.entries(n).forEach(([l,f])=>{var h=l,d=f.schema;i[h]=d;var m=Yu(d,this.hashFunction);if(o[h]=m,this.collections[l])throw _("DB3",{name:l});var p=vo(l,d),g={id:qn(p,$t),key:p,context:$t,data:{name:h,schemaHash:m.hash,schema:m.jsonSchema,version:m.version,connectedStorages:[]},_deleted:!1,_meta:jr(),_rev:Ur(),_attachments:{}};s.push({document:g});var y=Object.assign({},f,{name:h,schema:m,database:this}),v=H(f);v.database=this,v.name=l,Ee("preCreateRxCollection",v),y.conflictHandler=v.conflictHandler,a[h]=y});var u=await this.internalStore.bulkWrite(s,"rx-database-add-collection");await Hf(this),Object.entries(u.error).forEach(([l,f])=>{if(f.status!==409)throw _("DB12",{database:this.name,writeError:f});var h=j(f.documentInDb),d=h.data.name,m=o[d];if(h.data.schemaHash!==m.hash)throw _("DB6",{database:this.name,collection:d,previousSchemaHash:h.data.schemaHash,schemaHash:m.hash,previousSchema:h.data.schema,schema:j(i[d])})});var c={};return await Promise.all(Object.keys(n).map(async l=>{var f=a[l],h=await $f(f);c[l]=h,this.collections[l]=h,this[l]||Object.defineProperty(this,l,{get:()=>this.collections[l]})})),c},t.lockedRun=function(n){return this.idleQueue.wrapCall(n)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(n){throw M("json-dump")},t.importJSON=function(n){throw M("json-dump")},t.backup=function(n){throw M("backup")},t.leaderElector=function(){throw M("leader-election")},t.isLeader=function(){throw M("leader-election")},t.waitForLeadership=function(){throw M("leader-election")},t.migrationStates=function(){throw M("migration")},t.destroy=async function(){return this.destroyed||(this.destroyed=!0,await Hr("preDestroyRxDatabase",this),this.eventBulks$.complete(),this._subs.map(n=>n.unsubscribe()),this.name==="pseudoInstance")?Re:this.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(n=>n()))).then(()=>Promise.all(Object.keys(this.collections).map(n=>this.collections[n]).map(n=>n.destroy()))).then(()=>this.internalStore.close()).then(()=>Ff.delete(this.name)).then(()=>!0)},t.remove=function(){return this.destroy().then(()=>Uf(this.name,this.storage))},Ct(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}]),e}();async function jf(e,t,r,n,i,o){var s=await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:qu,schema:ki,options:n,multiInstance:i,password:o,devMode:te.isDevMode()});return s}async function Uf(e,t){var r=Ao(10),n=await jf(r,t,e,{},!1),i=await $s(t.statics,n),o=new Set;i.forEach(a=>o.add(a.data.name));var s=Array.from(o);return await Promise.all(s.map(a=>Bs(t,n,r,e,a))),await Hr("postRemoveRxDatabase",{databaseName:e,storage:t}),await n.remove(),s}async function Hf(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}var Wf={prepareQuery(e,t){if(!t.sort)throw _("SNH",{query:t});var r=jc(e,t);return{query:t,queryPlan:r}},checkpointSchema:Fu};const A=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,B=Object.keys,Q=Array.isArray;function J(e,t){return typeof t!="object"||B(t).forEach(function(r){e[r]=t[r]}),e}typeof Promise>"u"||A.Promise||(A.Promise=Promise);const Ot=Object.getPrototypeOf,Qf={}.hasOwnProperty;function oe(e,t){return Qf.call(e,t)}function xt(e,t){typeof t=="function"&&(t=t(Ot(e))),(typeof Reflect>"u"?B:Reflect.ownKeys)(t).forEach(r=>{we(e,r,t[r])})}const Ws=Object.defineProperty;function we(e,t,r,n){Ws(e,t,J(r&&oe(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function ht(e){return{from:function(t){return e.prototype=Object.create(t.prototype),we(e.prototype,"constructor",e),{extend:xt.bind(null,e.prototype)}}}}const zf=Object.getOwnPropertyDescriptor;function Ri(e,t){let r;return zf(e,t)||(r=Ot(e))&&Ri(r,t)}const Vf=[].slice;function Mr(e,t,r){return Vf.call(e,t,r)}function Qs(e,t){return t(e)}function Tt(e){if(!e)throw new Error("Assertion Failed")}function zs(e){A.setImmediate?setImmediate(e):setTimeout(e,0)}function Vs(e,t){return e.reduce((r,n,i)=>{var o=t(n,i);return o&&(r[o[0]]=o[1]),r},{})}function _e(e,t){if(oe(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var r=[],n=0,i=t.length;n<i;++n){var o=_e(e,t[n]);r.push(o)}return r}var s=t.indexOf(".");if(s!==-1){var a=e[t.substr(0,s)];return a===void 0?void 0:_e(a,t.substr(s+1))}}function ue(e,t,r){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Tt(typeof r!="string"&&"length"in r);for(var n=0,i=t.length;n<i;++n)ue(e,t[n],r[n])}else{var o=t.indexOf(".");if(o!==-1){var s=t.substr(0,o),a=t.substr(o+1);if(a==="")r===void 0?Q(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=r;else{var u=e[s];u&&oe(e,s)||(u=e[s]={}),ue(u,a,r)}}else r===void 0?Q(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Gs(e){var t={};for(var r in e)oe(e,r)&&(t[r]=e[r]);return t}const Gf=[].concat;function Ys(e){return Gf.apply([],e)}const Js="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ys([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>A[e]),Yf=Js.map(e=>A[e]);Vs(Js,e=>[e,!0]);let De=null;function or(e){De=typeof WeakMap<"u"&&new WeakMap;const t=Un(e);return De=null,t}function Un(e){if(!e||typeof e!="object")return e;let t=De&&De.get(e);if(t)return t;if(Q(e)){t=[],De&&De.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(Un(e[r]))}else if(Yf.indexOf(e.constructor)>=0)t=e;else{const o=Ot(e);for(var i in t=o===Object.prototype?{}:Object.create(o),De&&De.set(e,t),e)oe(e,i)&&(t[i]=Un(e[i]))}return t}const{toString:Jf}={};function Hn(e){return Jf.call(e).slice(8,-1)}const Wn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Xf=typeof Wn=="symbol"?function(e){var t;return e!=null&&(t=e[Wn])&&t.apply(e)}:function(){return null},ot={};function ve(e){var t,r,n,i;if(arguments.length===1){if(Q(e))return e.slice();if(this===ot&&typeof e=="string")return[e];if(i=Xf(e)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(e==null)return[e];if(typeof(t=e.length)=="number"){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const Pi=typeof Symbol<"u"?e=>e[Symbol.toStringTag]==="AsyncFunction":()=>!1;var de=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Xs(e,t){de=e,Zs=t}var Zs=()=>!0;const Zf=!new Error("").stack;function et(){if(Zf)try{throw et.arguments,new Error}catch(e){return e}return new Error}function Qn(e,t){var r=e.stack;return r?(t=t||0,r.indexOf(e.name)===0&&(t+=(e.name+e.message).split(`
`).length),r.split(`
`).slice(t).filter(Zs).map(n=>`
`+n).join("")):""}var ea=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ii=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ea),eh={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function dt(e,t){this._e=et(),this.name=e,this.message=t}function ta(e,t){return e+". Errors: "+Object.keys(t).map(r=>t[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function Nr(e,t,r,n){this._e=et(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=ta(e,t)}function Kt(e,t){this._e=et(),this.name="BulkError",this.failures=Object.keys(t).map(r=>t[r]),this.failuresByPos=t,this.message=ta(e,t)}ht(dt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Qn(this._e,2))}},toString:function(){return this.name+": "+this.message}}),ht(Nr).from(dt),ht(Kt).from(dt);var Ai=Ii.reduce((e,t)=>(e[t]=t+"Error",e),{});const th=dt;var k=Ii.reduce((e,t)=>{var r=t+"Error";function n(i,o){this._e=et(),this.name=r,i?typeof i=="string"?(this.message=`${i}${o?`
 `+o:""}`,this.inner=o||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=eh[t]||r,this.inner=null)}return ht(n).from(th),e[t]=n,e},{});k.Syntax=SyntaxError,k.Type=TypeError,k.Range=RangeError;var bo=ea.reduce((e,t)=>(e[t+"Error"]=k[t],e),{}),Or=Ii.reduce((e,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=k[t]),e),{});function P(){}function Gt(e){return e}function rh(e,t){return e==null||e===Gt?t:function(r){return t(e(r))}}function Je(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function nh(e,t){return e===P?t:function(){var r=e.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Je(n,this.onsuccess):n),i&&(this.onerror=this.onerror?Je(i,this.onerror):i),o!==void 0?o:r}}function ih(e,t){return e===P?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Je(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Je(n,this.onerror):n)}}function oh(e,t){return e===P?t:function(r){var n=e.apply(this,arguments);J(r,n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Je(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Je(o,this.onerror):o),n===void 0?s===void 0?void 0:s:J(n,s)}}function sh(e,t){return e===P?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function Ti(e,t){return e===P?t:function(){var r=e.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then(function(){return t.apply(n,o)})}return t.apply(this,arguments)}}Or.ModifyError=Nr,Or.DexieError=dt,Or.BulkError=Kt;var Yt={};const[zn,$r,Vn]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Ot(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Ot(t),e]})(),ra=$r&&$r.then,xr=zn&&zn.constructor,Mi=!!Vn;var Gn=!1,ah=Vn?()=>{Vn.then(lr)}:A.setImmediate?setImmediate.bind(null,lr):A.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{lr(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(lr,0)},Bt=function(e,t){Mt.push([e,t]),Kr&&(ah(),Kr=!1)},Yn=!0,Kr=!0,We=[],Cr=[],Jn=null,Xn=Gt,pt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:_o,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{_o(e[0],e[1])}catch{}})}},D=pt,Mt=[],Qe=0,Sr=[];function x(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=P,this._lib=!1;var t=this._PSD=D;if(de&&(this._stackHolder=et(),this._prev=null,this._numPrev=0),typeof e!="function"){if(e!==Yt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ei(this,this._value))}this._state=null,this._value=null,++t.ref,ia(this,e)}const Zn={get:function(){var e=D,t=Br;function r(n,i){var o=!e.global&&(e!==D||t!==Br);const s=o&&!Ce();var a=new x((u,c)=>{Ni(this,new na(Lr(n,e,o,s),Lr(i,e,o,s),u,c,e))});return de&&aa(a,this),a}return r.prototype=Yt,r},set:function(e){we(this,"then",e&&e.prototype===Yt?Zn:{get:function(){return e},set:Zn.set})}};function na(e,t,r,n,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=n,this.psd=i}function ia(e,t){try{t(r=>{if(e._state===null){if(r===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&sr();r&&typeof r.then=="function"?ia(e,(i,o)=>{r instanceof x?r._then(i,o):r.then(i,o)}):(e._state=!0,e._value=r,oa(e)),n&&ar()}},ei.bind(null,e))}catch(r){ei(e,r)}}function ei(e,t){if(Cr.push(t),e._state===null){var r=e._lib&&sr();t=Xn(t),e._state=!1,e._value=t,de&&t!==null&&typeof t=="object"&&!t._promise&&function(n,i,o){try{n.apply(null,o)}catch(s){i&&i(s)}}(()=>{var n=Ri(t,"stack");t._promise=e,we(t,"stack",{get:()=>Gn?n&&(n.get?n.get.apply(t):n.value):e.stack})}),function(n){We.some(i=>i._value===n._value)||We.push(n)}(e),oa(e),r&&ar()}}function oa(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Ni(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),Qe===0&&(++Qe,Bt(()=>{--Qe==0&&$i()},[]))}function Ni(e,t){if(e._state!==null){var r=e._state?t.onFulfilled:t.onRejected;if(r===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Qe,Bt(uh,[r,e,t])}else e._listeners.push(t)}function uh(e,t,r){try{Jn=t;var n,i=t._value;t._state?n=e(i):(Cr.length&&(Cr=[]),n=e(i),Cr.indexOf(i)===-1&&function(o){for(var s=We.length;s;)if(We[--s]._value===o._value)return void We.splice(s,1)}(t)),r.resolve(n)}catch(o){r.reject(o)}finally{Jn=null,--Qe==0&&$i(),--r.psd.ref||r.psd.finalize()}}function sa(e,t,r){if(t.length===r)return t;var n="";if(e._state===!1){var i,o,s=e._value;s!=null?(i=s.name||"Error",o=s.message||s,n=Qn(s,0)):(i=s,o=""),t.push(i+(o?": "+o:"")+n)}return de&&((n=Qn(e._stackHolder,2))&&t.indexOf(n)===-1&&t.push(n),e._prev&&sa(e._prev,t,r)),t}function aa(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function lr(){sr()&&ar()}function sr(){var e=Yn;return Yn=!1,Kr=!1,e}function ar(){var e,t,r;do for(;Mt.length>0;)for(e=Mt,Mt=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}while(Mt.length>0);Yn=!0,Kr=!0}function $i(){var e=We;We=[],e.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var t=Sr.slice(0),r=t.length;r;)t[--r]()}function fr(e){return new x(Yt,!1,e)}function T(e,t){var r=D;return function(){var n=sr(),i=D;try{return Ne(r,!0),e.apply(this,arguments)}catch(o){t&&t(o)}finally{Ne(i,!1),n&&ar()}}}xt(x.prototype,{then:Zn,_then:function(e,t){Ni(this,new na(null,null,e,t,D))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],r=arguments[1];return typeof t=="function"?this.then(null,n=>n instanceof t?r(n):fr(n)):this.then(null,n=>n&&n.name===t?r(n):fr(n))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),fr(t)))},stack:{get:function(){if(this._stack)return this._stack;try{Gn=!0;var e=sa(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Gn=!1}}},timeout:function(e,t){return e<1/0?new x((r,n)=>{var i=setTimeout(()=>n(new k.Timeout(t)),e);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&we(x.prototype,Symbol.toStringTag,"Dexie.Promise"),pt.env=ua(),xt(x,{all:function(){var e=ve.apply(null,arguments).map(hr);return new x(function(t,r){e.length===0&&t([]);var n=e.length;e.forEach((i,o)=>x.resolve(i).then(s=>{e[o]=s,--n||t(e)},r))})},resolve:e=>{if(e instanceof x)return e;if(e&&typeof e.then=="function")return new x((r,n)=>{e.then(r,n)});var t=new x(Yt,!0,e);return aa(t,Jn),t},reject:fr,race:function(){var e=ve.apply(null,arguments).map(hr);return new x((t,r)=>{e.map(n=>x.resolve(n).then(t,r))})},PSD:{get:()=>D,set:e=>D=e},totalEchoes:{get:()=>Br},newPSD:Me,usePSD:Rt,scheduler:{get:()=>Bt,set:e=>{Bt=e}},rejectionMapper:{get:()=>Xn,set:e=>{Xn=e}},follow:(e,t)=>new x((r,n)=>Me((i,o)=>{var s=D;s.unhandleds=[],s.onunhandled=o,s.finalize=Je(function(){(function(a){function u(){a(),Sr.splice(Sr.indexOf(u),1)}Sr.push(u),++Qe,Bt(()=>{--Qe==0&&$i()},[])})(()=>{this.unhandleds.length===0?i():o(this.unhandleds[0])})},s.finalize),e()},t,r,n))}),xr&&(xr.allSettled&&we(x,"allSettled",function(){const e=ve.apply(null,arguments).map(hr);return new x(t=>{e.length===0&&t([]);let r=e.length;const n=new Array(r);e.forEach((i,o)=>x.resolve(i).then(s=>n[o]={status:"fulfilled",value:s},s=>n[o]={status:"rejected",reason:s}).then(()=>--r||t(n)))})}),xr.any&&typeof AggregateError<"u"&&we(x,"any",function(){const e=ve.apply(null,arguments).map(hr);return new x((t,r)=>{e.length===0&&r(new AggregateError([]));let n=e.length;const i=new Array(n);e.forEach((o,s)=>x.resolve(o).then(a=>t(a),a=>{i[s]=a,--n||r(new AggregateError(i))}))})}));const W={awaits:0,echoes:0,id:0};var ch=0,Dr=[],dn=0,Br=0,lh=0;function Me(e,t,r,n){var i=D,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++lh;var s=pt.env;o.env=Mi?{Promise:x,PromiseProp:{value:x,configurable:!0,writable:!0},all:x.all,race:x.race,allSettled:x.allSettled,any:x.any,resolve:x.resolve,reject:x.reject,nthen:wo(s.nthen,o),gthen:wo(s.gthen,o)}:{},t&&J(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Rt(o,e,r,n);return o.ref===0&&o.finalize(),a}function kt(){return W.id||(W.id=++ch),++W.awaits,W.echoes+=100,W.id}function Ce(){return!!W.awaits&&(--W.awaits==0&&(W.id=0),W.echoes=100*W.awaits,!0)}function hr(e){return W.echoes&&e&&e.constructor===xr?(kt(),e.then(t=>(Ce(),t),t=>(Ce(),F(t)))):e}function fh(e){++Br,W.echoes&&--W.echoes!=0||(W.echoes=W.id=0),Dr.push(D),Ne(e,!0)}function hh(){var e=Dr[Dr.length-1];Dr.pop(),Ne(e,!1)}function Ne(e,t){var r=D;if((t?!W.echoes||dn++&&e===D:!dn||--dn&&e===D)||ca(t?fh.bind(null,e):hh),e!==D&&(D=e,r===pt&&(pt.env=ua()),Mi)){var n=pt.env.Promise,i=e.env;$r.then=i.nthen,n.prototype.then=i.gthen,(r.global||e.global)&&(Object.defineProperty(A,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function ua(){var e=A.Promise;return Mi?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(A,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:$r.then,gthen:e.prototype.then}:{}}function Rt(e,t,r,n,i){var o=D;try{return Ne(e,!0),t(r,n,i)}finally{Ne(o,!1)}}function ca(e){ra.call(zn,e)}function Lr(e,t,r,n){return typeof e!="function"?e:function(){var i=D;r&&kt(),Ne(t,!0);try{return e.apply(this,arguments)}finally{Ne(i,!1),n&&ca(Ce)}}}function wo(e,t){return function(r,n){return e.call(this,Lr(r,t),Lr(n,t))}}(""+ra).indexOf("[native code]")===-1&&(kt=Ce=P);function _o(e,t){var r;try{r=t.onuncatched(e)}catch{}if(r!==!1)try{var n,i={promise:t,reason:e};if(A.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),J(n,i)):A.CustomEvent&&J(n=new CustomEvent("unhandledrejection",{detail:i}),i),n&&A.dispatchEvent&&(dispatchEvent(n),!A.PromiseRejectionEvent&&A.onunhandledrejection))try{A.onunhandledrejection(n)}catch{}de&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var F=x.reject;function ti(e,t,r,n){if(e.idbdb&&(e._state.openComplete||D.letThrough||e._vip)){var i=e._createTransaction(t,r,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===Ai.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>ti(e,t,r,n))):F(o)}return i._promise(t,(o,s)=>Me(()=>(D.trans=i,n(o,s,i)))).then(o=>i._completion.then(()=>o))}if(e._state.openComplete)return F(new k.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return F(new k.DatabaseClosed);e.open().catch(P)}return e._state.dbReadyPromise.then(()=>ti(e,t,r,n))}const je=String.fromCharCode(65535),pe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Lt=[],Yr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),dh=Yr,ph=Yr,la=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function Xe(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const fa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function dr(e){return typeof e!="string"||/\./.test(e)?t=>t:t=>(t[e]===void 0&&e in t&&delete(t=or(t))[e],t)}function mh(){throw k.Type()}class yh{_trans(t,r,n){const i=this._tx||D.trans,o=this.name;function s(u,c,l){if(!l.schema[o])throw new k.NotFound("Table "+o+" not part of transaction");return r(l.idbtrans,l)}const a=sr();try{return i&&i.db===this.db?i===D.trans?i._promise(t,s,n):Me(()=>i._promise(t,s,n),{trans:i,transless:D.transless||D}):ti(this.db,t,[this.name],s)}finally{a&&ar()}}get(t,r){return t&&t.constructor===Object?this.where(t).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:t}).then(i=>this.hook.reading.fire(i))).then(r)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(Q(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const r=B(t);if(r.length===1)return this.where(r[0]).equals(t[r[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&r.every(l=>c.keyPath.indexOf(l)>=0)&&c.keyPath.every(l=>r.indexOf(l)>=0))[0];if(n&&this.db._maxKey!==je)return this.where(n.name).equals(n.keyPath.map(c=>t[c]));!n&&de&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:i}=this.schema,o=this.db._deps.indexedDB;function s(c,l){try{return o.cmp(c,l)===0}catch{return!1}}const[a,u]=r.reduce(([c,l],f)=>{const h=i[f],d=t[f];return[c||h,c||!h?Xe(l,h&&h.multi?m=>{const p=_e(m,f);return Q(p)&&p.some(g=>s(d,g))}:m=>s(d,_e(m,f))):l]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(u):n?this.filter(u):this.where(r).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,Q(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){const{db:r,name:n}=this;this.schema.mappedClass=t,t.prototype instanceof mh&&(t=class extends t{get db(){return r}table(){return n}});const i=new Set;for(let s=t.prototype;s;s=Ot(s))Object.getOwnPropertyNames(s).forEach(a=>i.add(a));const o=s=>{if(!s)return s;const a=Object.create(t.prototype);for(let u in s)if(!i.has(u))try{a[u]=s[u]}catch{}return a};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),t}defineClass(){return this.mapToClass(function(t){J(this,t)})}add(t,r){const{auto:n,keyPath:i}=this.schema.primKey;let o=t;return i&&n&&(o=dr(i)(t)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:r!=null?[r]:null,values:[o]})).then(s=>s.numFailures?x.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{ue(t,i,s)}catch{}return s})}update(t,r){if(typeof t!="object"||Q(t))return this.where(":id").equals(t).modify(r);{const n=_e(t,this.schema.primKey.keyPath);if(n===void 0)return F(new k.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?B(r).forEach(i=>{ue(t,i,r[i])}):r(t,{value:t,primKey:n})}catch{}return this.where(":id").equals(n).modify(r)}}put(t,r){const{auto:n,keyPath:i}=this.schema.primKey;let o=t;return i&&n&&(o=dr(i)(t)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[o],keys:r!=null?[r]:null})).then(s=>s.numFailures?x.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{ue(t,i,s)}catch{}return s})}delete(t){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[t]})).then(r=>r.numFailures?x.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:fa})).then(t=>t.numFailures?x.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",r=>this.core.getMany({keys:t,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,r,n){const i=Array.isArray(r)?r:void 0,o=(n=n||(i?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new k.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new k.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let l=u&&a?t.map(dr(u)):t;return this.core.mutate({trans:s,type:"add",keys:i,values:l,wantResults:o}).then(({numFailures:f,results:h,lastResult:d,failures:m})=>{if(f===0)return o?h:d;throw new Kt(`${this.name}.bulkAdd(): ${f} of ${c} operations failed`,m)})})}bulkPut(t,r,n){const i=Array.isArray(r)?r:void 0,o=(n=n||(i?void 0:r))?n.allKeys:void 0;return this._trans("readwrite",s=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&i)throw new k.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new k.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let l=u&&a?t.map(dr(u)):t;return this.core.mutate({trans:s,type:"put",keys:i,values:l,wantResults:o}).then(({numFailures:f,results:h,lastResult:d,failures:m})=>{if(f===0)return o?h:d;throw new Kt(`${this.name}.bulkPut(): ${f} of ${c} operations failed`,m)})})}bulkDelete(t){const r=t.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:t})).then(({numFailures:n,lastResult:i,failures:o})=>{if(n===0)return i;throw new Kt(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,o)})}}function Ft(e){var t={},r=function(a,u){if(u){for(var c=arguments.length,l=new Array(c-1);--c;)l[c-1]=arguments[c];return t[a].subscribe.apply(null,l),e}if(typeof a=="string")return t[a]};r.addEventType=o;for(var n=1,i=arguments.length;n<i;++n)o(arguments[n]);return r;function o(a,u,c){if(typeof a=="object")return s(a);u||(u=sh),c||(c=P);var l={subscribers:[],fire:c,subscribe:function(f){l.subscribers.indexOf(f)===-1&&(l.subscribers.push(f),l.fire=u(l.fire,f))},unsubscribe:function(f){l.subscribers=l.subscribers.filter(function(h){return h!==f}),l.fire=l.subscribers.reduce(u,c)}};return t[a]=r[a]=l,l}function s(a){B(a).forEach(function(u){var c=a[u];if(Q(c))o(u,a[u][0],a[u][1]);else{if(c!=="asap")throw new k.InvalidArgument("Invalid event config");var l=o(u,Gt,function(){for(var f=arguments.length,h=new Array(f);f--;)h[f]=arguments[f];l.subscribers.forEach(function(d){zs(function(){d.apply(null,h)})})})}})}}function At(e,t){return ht(t).from({prototype:e}),t}function nt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function pn(e,t){e.filter=Xe(e.filter,t)}function mn(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>Xe(n(),t()):t,e.justLimit=r&&!n}function kr(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new k.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Eo(e,t,r){const n=kr(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:n,range:e.range}})}function pr(e,t,r,n){const i=e.replayFilter?Xe(e.filter,e.replayFilter()):e.filter;if(e.or){const o={},s=(a,u,c)=>{if(!i||i(u,c,h=>u.stop(h),h=>u.fail(h))){var l=u.primaryKey,f=""+l;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(l)),oe(o,f)||(o[f]=!0,t(a,u,c))}};return Promise.all([e.or._iterate(s,r),Oo(Eo(e,n,r),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Oo(Eo(e,n,r),Xe(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Oo(e,t,r,n){var i=T(n?(o,s,a)=>r(n(o),s,a):r);return e.then(o=>{if(o)return o.start(()=>{var s=()=>o.continue();t&&!t(o,a=>s=a,a=>{o.stop(a),s=P},a=>{o.fail(a),s=P})||i(o.value,o,a=>s=a),s()})})}function G(e,t){try{const r=xo(e),n=xo(t);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(i,o){const s=i.length,a=o.length,u=s<a?s:a;for(let c=0;c<u;++c)if(i[c]!==o[c])return i[c]<o[c]?-1:1;return s===a?0:s<a?-1:1}(Co(e),Co(t));case"Array":return function(i,o){const s=i.length,a=o.length,u=s<a?s:a;for(let c=0;c<u;++c){const l=G(i[c],o[c]);if(l!==0)return l}return s===a?0:s<a?-1:1}(e,t)}}catch{}return NaN}function xo(e){const t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";const r=Hn(e);return r==="ArrayBuffer"?"binary":r}function Co(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class vh{_read(t,r){var n=this._ctx;return n.error?n.table._trans(null,F.bind(null,n.error)):n.table._trans("readonly",t).then(r)}_write(t){var r=this._ctx;return r.error?r.table._trans(null,F.bind(null,r.error)):r.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var r=this._ctx;r.algorithm=Xe(r.algorithm,t)}_iterate(t,r){return pr(this._ctx,t,r,this._ctx.table.core)}clone(t){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&J(n,t),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(t){var r=this._ctx;return this._read(n=>pr(r,t,n,r.table.core))}count(t){return this._read(r=>{const n=this._ctx,i=n.table.core;if(nt(n,!0))return i.count({trans:r,query:{index:kr(n,i.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var o=0;return pr(n,()=>(++o,!1),r,i).then(()=>o)}).then(t)}sortBy(t,r){const n=t.split(".").reverse(),i=n[0],o=n.length-1;function s(c,l){return l?s(c[n[l]],l-1):c[i]}var a=this._ctx.dir==="next"?1:-1;function u(c,l){var f=s(c,o),h=s(l,o);return f<h?-a:f>h?a:0}return this.toArray(function(c){return c.sort(u)}).then(r)}toArray(t){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&nt(n,!0)&&n.limit>0){const{valueMapper:i}=n,o=kr(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then(({result:s})=>i?s.map(i):s)}{const i=[];return pr(n,o=>i.push(o),r,n.table.core).then(()=>i)}},t)}offset(t){var r=this._ctx;return t<=0||(r.offset+=t,nt(r)?mn(r,()=>{var n=t;return(i,o)=>n===0||(n===1?(--n,!1):(o(()=>{i.advance(n),n=0}),!1))}):mn(r,()=>{var n=t;return()=>--n<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),mn(this._ctx,()=>{var r=t;return function(n,i,o){return--r<=0&&i(o),r>=0}},!0),this}until(t,r){return pn(this._ctx,function(n,i,o){return!t(n.value)||(i(o),r)}),this}first(t){return this.limit(1).toArray(function(r){return r[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var r,n;return pn(this._ctx,function(i){return t(i.value)}),r=this._ctx,n=t,r.isMatch=Xe(r.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){t(i.primaryKey,i)})}keys(t){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(t)}primaryKeys(t){var r=this._ctx;if(r.dir==="next"&&nt(r,!0)&&r.limit>0)return this._read(i=>{var o=kr(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(({result:i})=>i).then(t);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(r){return r[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,r=t.index&&t.table.schema.idxByName[t.index];if(!r||!r.multi)return this;var n={};return pn(this._ctx,function(i){var o=i.primaryKey.toString(),s=oe(n,o);return n[o]=!0,!s}),this}modify(t){var r=this._ctx;return this._write(n=>{var i;if(typeof t=="function")i=t;else{var o=B(t),s=o.length;i=function(p){for(var g=!1,y=0;y<s;++y){var v=o[y],b=t[v];_e(p,v)!==b&&(ue(p,v,b),g=!0)}return g}}const a=r.table.core,{outbound:u,extractKey:c}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,f=[];let h=0;const d=[],m=(p,g)=>{const{failures:y,numFailures:v}=g;h+=p-v;for(let b of B(y))f.push(y[b])};return this.clone().primaryKeys().then(p=>{const g=y=>{const v=Math.min(l,p.length-y);return a.getMany({trans:n,keys:p.slice(y,y+v),cache:"immutable"}).then(b=>{const C=[],E=[],w=u?[]:null,O=[];for(let S=0;S<v;++S){const I=b[S],N={value:or(I),primKey:p[y+S]};i.call(N,N.value,N)!==!1&&(N.value==null?O.push(p[y+S]):u||G(c(I),c(N.value))===0?(E.push(N.value),u&&w.push(p[y+S])):(O.push(p[y+S]),C.push(N.value)))}const R=nt(r)&&r.limit===1/0&&(typeof t!="function"||t===yn)&&{index:r.index,range:r.range};return Promise.resolve(C.length>0&&a.mutate({trans:n,type:"add",values:C}).then(S=>{for(let I in S.failures)O.splice(parseInt(I),1);m(C.length,S)})).then(()=>(E.length>0||R&&typeof t=="object")&&a.mutate({trans:n,type:"put",keys:w,values:E,criteria:R,changeSpec:typeof t!="function"&&t}).then(S=>m(E.length,S))).then(()=>(O.length>0||R&&t===yn)&&a.mutate({trans:n,type:"delete",keys:O,criteria:R}).then(S=>m(O.length,S))).then(()=>p.length>y+v&&g(y+l))})};return g(0).then(()=>{if(f.length>0)throw new Nr("Error modifying one or more objects",f,h,d);return p.length})})})}delete(){var t=this._ctx,r=t.range;return nt(t)&&(t.isPrimKey&&!ph||r.type===3)?this._write(n=>{const{primaryKey:i}=t.table.core.schema,o=r;return t.table.core.count({trans:n,query:{index:i,range:o}}).then(s=>t.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(({failures:a,lastResult:u,results:c,numFailures:l})=>{if(l)throw new Nr("Could not delete some values",Object.keys(a).map(f=>a[f]),s-l);return s-l}))}):this.modify(yn)}}const yn=(e,t)=>t.value=null;function gh(e,t){return e<t?-1:e===t?0:1}function bh(e,t){return e>t?-1:e===t?0:1}function ee(e,t,r){var n=e instanceof da?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function it(e){return new e.Collection(e,()=>ha("")).limit(0)}function wh(e,t,r,n,i,o){for(var s=Math.min(e.length,n.length),a=-1,u=0;u<s;++u){var c=t[u];if(c!==n[u])return i(e[u],r[u])<0?e.substr(0,u)+r[u]+r.substr(u+1):i(e[u],n[u])<0?e.substr(0,u)+n[u]+r.substr(u+1):a>=0?e.substr(0,a)+t[a]+r.substr(a+1):null;i(e[u],c)<0&&(a=u)}return s<n.length&&o==="next"?e+r.substr(e.length):s<e.length&&o==="prev"?e.substr(0,r.length):a<0?null:e.substr(0,a)+n[a]+r.substr(a+1)}function mr(e,t,r,n){var i,o,s,a,u,c,l,f=r.length;if(!r.every(p=>typeof p=="string"))return ee(e,"String expected.");function h(p){i=function(y){return y==="next"?v=>v.toUpperCase():v=>v.toLowerCase()}(p),o=function(y){return y==="next"?v=>v.toLowerCase():v=>v.toUpperCase()}(p),s=p==="next"?gh:bh;var g=r.map(function(y){return{lower:o(y),upper:i(y)}}).sort(function(y,v){return s(y.lower,v.lower)});a=g.map(function(y){return y.upper}),u=g.map(function(y){return y.lower}),c=p,l=p==="next"?"":n}h("next");var d=new e.Collection(e,()=>Se(a[0],u[f-1]+n));d._ondirectionchange=function(p){h(p)};var m=0;return d._addAlgorithm(function(p,g,y){var v=p.key;if(typeof v!="string")return!1;var b=o(v);if(t(b,u,m))return!0;for(var C=null,E=m;E<f;++E){var w=wh(v,b,a[E],u[E],s,c);w===null&&C===null?m=E+1:(C===null||s(C,w)>0)&&(C=w)}return g(C!==null?function(){p.continue(C+l)}:y),!1}),d}function Se(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function ha(e){return{type:1,lower:e,upper:e}}class da{get Collection(){return this._ctx.table.db.Collection}between(t,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(t,r)>0||this._cmp(t,r)===0&&(n||i)&&(!n||!i)?it(this):new this.Collection(this,()=>Se(t,r,!n,!i))}catch{return ee(this,pe)}}equals(t){return t==null?ee(this,pe):new this.Collection(this,()=>ha(t))}above(t){return t==null?ee(this,pe):new this.Collection(this,()=>Se(t,void 0,!0))}aboveOrEqual(t){return t==null?ee(this,pe):new this.Collection(this,()=>Se(t,void 0,!1))}below(t){return t==null?ee(this,pe):new this.Collection(this,()=>Se(void 0,t,!1,!0))}belowOrEqual(t){return t==null?ee(this,pe):new this.Collection(this,()=>Se(void 0,t))}startsWith(t){return typeof t!="string"?ee(this,"String expected."):this.between(t,t+je,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):mr(this,(r,n)=>r.indexOf(n[0])===0,[t],je)}equalsIgnoreCase(t){return mr(this,(r,n)=>r===n[0],[t],"")}anyOfIgnoreCase(){var t=ve.apply(ot,arguments);return t.length===0?it(this):mr(this,(r,n)=>n.indexOf(r)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=ve.apply(ot,arguments);return t.length===0?it(this):mr(this,(r,n)=>n.some(i=>r.indexOf(i)===0),t,je)}anyOf(){const t=ve.apply(ot,arguments);let r=this._cmp;try{t.sort(r)}catch{return ee(this,pe)}if(t.length===0)return it(this);const n=new this.Collection(this,()=>Se(t[0],t[t.length-1]));n._ondirectionchange=o=>{r=o==="next"?this._ascending:this._descending,t.sort(r)};let i=0;return n._addAlgorithm((o,s,a)=>{const u=o.key;for(;r(u,t[i])>0;)if(++i,i===t.length)return s(a),!1;return r(u,t[i])===0||(s(()=>{o.continue(t[i])}),!1)}),n}notEqual(t){return this.inAnyRange([[-(1/0),t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=ve.apply(ot,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return ee(this,pe)}const r=t.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[-(1/0),i]],null);return r.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,r){const n=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(t.length===0)return it(this);if(!t.every(v=>v[0]!==void 0&&v[1]!==void 0&&i(v[0],v[1])<=0))return ee(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",k.InvalidArgument);const u=!r||r.includeLowers!==!1,c=r&&r.includeUppers===!0;let l,f=i;function h(v,b){return f(v[0],b[0])}try{l=t.reduce(function(v,b){let C=0,E=v.length;for(;C<E;++C){const w=v[C];if(n(b[0],w[1])<0&&n(b[1],w[0])>0){w[0]=s(w[0],b[0]),w[1]=a(w[1],b[1]);break}}return C===E&&v.push(b),v},[]),l.sort(h)}catch{return ee(this,pe)}let d=0;const m=c?v=>i(v,l[d][1])>0:v=>i(v,l[d][1])>=0,p=u?v=>o(v,l[d][0])>0:v=>o(v,l[d][0])>=0;let g=m;const y=new this.Collection(this,()=>Se(l[0][0],l[l.length-1][1],!u,!c));return y._ondirectionchange=v=>{v==="next"?(g=m,f=i):(g=p,f=o),l.sort(h)},y._addAlgorithm((v,b,C)=>{for(var E=v.key;g(E);)if(++d,d===l.length)return b(C),!1;return!!function(w){return!m(w)&&!p(w)}(E)||(this._cmp(E,l[d][1])===0||this._cmp(E,l[d][0])===0||b(()=>{f===i?v.continue(l[d][0]):v.continue(l[d][1])}),!1)}),y}startsWithAnyOf(){const t=ve.apply(ot,arguments);return t.every(r=>typeof r=="string")?t.length===0?it(this):this.inAnyRange(t.map(r=>[r,r+je])):ee(this,"startsWithAnyOf() only works with strings")}}function le(e){return T(function(t){return Jt(t),e(t.target.error),!1})}function Jt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const $e=Ft(null,"storagemutated");class _h{_lock(){return Tt(!D.global),++this._reculock,this._reculock!==1||D.global||(D.lockOwnerFor=this),this}_unlock(){if(Tt(!D.global),--this._reculock==0)for(D.global||(D.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Rt(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&D.lockOwnerFor!==this}create(t){if(!this.mode)return this;const r=this.db.idbdb,n=this.db._state.dbOpenError;if(Tt(!this.idbtrans),!t&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new k.DatabaseClosed(n);case"MissingAPIError":throw new k.MissingAPI(n.message,n);default:throw new k.OpenFailed(n)}if(!this.active)throw new k.TransactionInactive;return Tt(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=T(i=>{Jt(i),this._reject(t.error)}),t.onabort=T(i=>{Jt(i),this.active&&this._reject(new k.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=T(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&$e.storagemutated.fire(t.mutatedParts)}),this}_promise(t,r,n){if(t==="readwrite"&&this.mode!=="readwrite")return F(new k.ReadOnly("Transaction is readonly"));if(!this.active)return F(new k.TransactionInactive);if(this._locked())return new x((o,s)=>{this._blockedFuncs.push([()=>{this._promise(t,r,n).then(o,s)},D])});if(n)return Me(()=>{var o=new x((s,a)=>{this._lock();const u=r(s,a,this);u&&u.then&&u.then(s,a)});return o.finally(()=>this._unlock()),o._lib=!0,o});var i=new x((o,s)=>{var a=r(o,s,this);a&&a.then&&a.then(o,s)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var r=this._root();const n=x.resolve(t);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function s(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var o=r._waitingFor;return new x((s,a)=>{n.then(u=>r._waitingQueue.push(T(s.bind(null,u))),u=>r._waitingQueue.push(T(a.bind(null,u)))).finally(()=>{r._waitingFor===o&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new k.Abort))}table(t){const r=this._memoizedTables||(this._memoizedTables={});if(oe(r,t))return r[t];const n=this.schema[t];if(!n)throw new k.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,n,this);return i.core=this.db.core.table(t),r[t]=i,i}}function ri(e,t,r,n,i,o,s){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:o,src:(r&&!s?"&":"")+(n?"*":"")+(i?"++":"")+pa(t)}}function pa(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ma(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Vs(r,n=>[n.name,n])}}let Xt=e=>{try{return e.only([[]]),Xt=()=>[[]],[[]]}catch{return Xt=()=>je,je}};function ni(e){return e==null?()=>{}:typeof e=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>_e(r,t)}(e):t=>_e(t,e)}function So(e){return[].slice.call(e)}let Eh=0;function qt(e){return e==null?":id":typeof e=="string"?e:`[${e.join("+")}]`}function Oh(e,t,r){function n(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:l,lowerOpen:f,upperOpen:h}=u;return c===void 0?l===void 0?null:t.upperBound(l,!!h):l===void 0?t.lowerBound(c,!!f):t.bound(c,l,!!f,!!h)}const{schema:i,hasGetAll:o}=function(u,c){const l=So(u.objectStoreNames);return{schema:{name:u.name,tables:l.map(f=>c.objectStore(f)).map(f=>{const{keyPath:h,autoIncrement:d}=f,m=Q(h),p=h==null,g={},y={name:f.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:m,keyPath:h,autoIncrement:d,unique:!0,extractKey:ni(h)},indexes:So(f.indexNames).map(v=>f.index(v)).map(v=>{const{name:b,unique:C,multiEntry:E,keyPath:w}=v,O={name:b,compound:Q(w),keyPath:w,unique:C,multiEntry:E,extractKey:ni(w)};return g[qt(w)]=O,O}),getIndexByKeyPath:v=>g[qt(v)]};return g[":id"]=y.primaryKey,h!=null&&(g[qt(h)]=y.primaryKey),y})},hasGetAll:l.length>0&&"getAll"in c.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),s=i.tables.map(u=>function(c){const l=c.name;return{name:l,schema:c,mutate:function({trans:f,type:h,keys:d,values:m,range:p}){return new Promise((g,y)=>{g=T(g);const v=f.objectStore(l),b=v.keyPath==null,C=h==="put"||h==="add";if(!C&&h!=="delete"&&h!=="deleteRange")throw new Error("Invalid operation type: "+h);const{length:E}=d||m||{length:1};if(d&&m&&d.length!==m.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let w;const O=[],R=[];let S=0;const I=V=>{++S,Jt(V)};if(h==="deleteRange"){if(p.type===4)return g({numFailures:S,failures:R,results:[],lastResult:void 0});p.type===3?O.push(w=v.clear()):O.push(w=v.delete(n(p)))}else{const[V,U]=C?b?[m,d]:[m,null]:[d,null];if(C)for(let K=0;K<E;++K)O.push(w=U&&U[K]!==void 0?v[h](V[K],U[K]):v[h](V[K])),w.onerror=I;else for(let K=0;K<E;++K)O.push(w=v[h](V[K])),w.onerror=I}const N=V=>{const U=V.target.result;O.forEach((K,tt)=>K.error!=null&&(R[tt]=K.error)),g({numFailures:S,failures:R,results:h==="delete"?d:O.map(K=>K.result),lastResult:U})};w.onerror=V=>{I(V),N(V)},w.onsuccess=N})},getMany:({trans:f,keys:h})=>new Promise((d,m)=>{d=T(d);const p=f.objectStore(l),g=h.length,y=new Array(g);let v,b=0,C=0;const E=O=>{const R=O.target;y[R._pos]=R.result,++C===b&&d(y)},w=le(m);for(let O=0;O<g;++O)h[O]!=null&&(v=p.get(h[O]),v._pos=O,v.onsuccess=E,v.onerror=w,++b);b===0&&d(y)}),get:({trans:f,key:h})=>new Promise((d,m)=>{d=T(d);const p=f.objectStore(l).get(h);p.onsuccess=g=>d(g.target.result),p.onerror=le(m)}),query:function(f){return h=>new Promise((d,m)=>{d=T(d);const{trans:p,values:g,limit:y,query:v}=h,b=y===1/0?void 0:y,{index:C,range:E}=v,w=p.objectStore(l),O=C.isPrimaryKey?w:w.index(C.name),R=n(E);if(y===0)return d({result:[]});if(f){const S=g?O.getAll(R,b):O.getAllKeys(R,b);S.onsuccess=I=>d({result:I.target.result}),S.onerror=le(m)}else{let S=0;const I=g||!("openKeyCursor"in O)?O.openCursor(R):O.openKeyCursor(R),N=[];I.onsuccess=V=>{const U=I.result;return U?(N.push(g?U.value:U.primaryKey),++S===y?d({result:N}):void U.continue()):d({result:N})},I.onerror=le(m)}})}(o),openCursor:function({trans:f,values:h,query:d,reverse:m,unique:p}){return new Promise((g,y)=>{g=T(g);const{index:v,range:b}=d,C=f.objectStore(l),E=v.isPrimaryKey?C:C.index(v.name),w=m?p?"prevunique":"prev":p?"nextunique":"next",O=h||!("openKeyCursor"in E)?E.openCursor(n(b),w):E.openKeyCursor(n(b),w);O.onerror=le(y),O.onsuccess=T(R=>{const S=O.result;if(!S)return void g(null);S.___id=++Eh,S.done=!1;const I=S.continue.bind(S);let N=S.continuePrimaryKey;N&&(N=N.bind(S));const V=S.advance.bind(S),U=()=>{throw new Error("Cursor not stopped")};S.trans=f,S.stop=S.continue=S.continuePrimaryKey=S.advance=()=>{throw new Error("Cursor not started")},S.fail=T(y),S.next=function(){let K=1;return this.start(()=>K--?this.continue():this.stop()).then(()=>this)},S.start=K=>{const tt=new Promise((Z,Fe)=>{Z=T(Z),O.onerror=le(Fe),S.fail=Fe,S.stop=Pt=>{S.stop=S.continue=S.continuePrimaryKey=S.advance=U,Z(Pt)}}),rt=()=>{if(O.result)try{K()}catch(Z){S.fail(Z)}else S.done=!0,S.start=()=>{throw new Error("Cursor behind last entry")},S.stop()};return O.onsuccess=T(Z=>{O.onsuccess=rt,rt()}),S.continue=I,S.continuePrimaryKey=N,S.advance=V,rt(),tt},g(S)},y)})},count({query:f,trans:h}){const{index:d,range:m}=f;return new Promise((p,g)=>{const y=h.objectStore(l),v=d.isPrimaryKey?y:y.index(d.name),b=n(m),C=b?v.count(b):v.count();C.onsuccess=T(E=>p(E.target.result)),C.onerror=le(g)})}}}(u)),a={};return s.forEach(u=>a[u.name]=u),{stack:"dbcore",transaction:e.transaction.bind(e),table(u){if(!a[u])throw new Error(`Table '${u}' not found`);return a[u]},MIN_KEY:-1/0,MAX_KEY:Xt(t),schema:i}}function ii({_novip:e},t){const r=t.db,n=function(i,o,{IDBKeyRange:s,indexedDB:a},u){return{dbcore:function(l,f){return f.reduce((h,{create:d})=>({...h,...d(h)}),l)}(Oh(o,s,u),i.dbcore)}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach(i=>{const o=i.name;e.core.schema.tables.some(s=>s.name===o)&&(i.core=e.core.table(o),e[o]instanceof e.Table&&(e[o].core=i.core))})}function Fr({_novip:e},t,r,n){r.forEach(i=>{const o=n[i];t.forEach(s=>{const a=Ri(s,i);(!a||"value"in a&&a.value===void 0)&&(s===e.Transaction.prototype||s instanceof e.Transaction?we(s,i,{get(){return this.table(i)},set(u){Ws(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new e.Table(i,o))})})}function oi({_novip:e},t){t.forEach(r=>{for(let n in r)r[n]instanceof e.Table&&delete r[n]})}function xh(e,t){return e._cfg.version-t._cfg.version}function Ch(e,t,r,n){const i=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,i);o.create(r),o._completion.catch(n);const s=o._reject.bind(o),a=D.transless||D;Me(()=>{D.trans=o,D.transless=a,t===0?(B(i).forEach(u=>{vn(r,u,i[u].primKey,i[u].indexes)}),ii(e,r),x.follow(()=>e.on.populate.fire(o)).catch(s)):function({_novip:u},c,l,f){const h=[],d=u._versions;let m=u._dbSchema=ai(u,u.idbdb,f),p=!1;function g(){return h.length?x.resolve(h.shift()(l.idbtrans)).then(g):x.resolve()}return d.filter(y=>y._cfg.version>=c).forEach(y=>{h.push(()=>{const v=m,b=y._cfg.dbschema;ui(u,v,f),ui(u,b,f),m=u._dbSchema=b;const C=ya(v,b);C.add.forEach(w=>{vn(f,w[0],w[1].primKey,w[1].indexes)}),C.change.forEach(w=>{if(w.recreate)throw new k.Upgrade("Not yet support for changing primary key");{const O=f.objectStore(w.name);w.add.forEach(R=>si(O,R)),w.change.forEach(R=>{O.deleteIndex(R.name),si(O,R)}),w.del.forEach(R=>O.deleteIndex(R))}});const E=y._cfg.contentUpgrade;if(E&&y._cfg.version>c){ii(u,f),l._memoizedTables={},p=!0;let w=Gs(b);C.del.forEach(I=>{w[I]=v[I]}),oi(u,[u.Transaction.prototype]),Fr(u,[u.Transaction.prototype],B(w),w),l.schema=w;const O=Pi(E);let R;O&&kt();const S=x.follow(()=>{if(R=E(l),R&&O){var I=Ce.bind(null,null);R.then(I,I)}});return R&&typeof R.then=="function"?x.resolve(R):S.then(()=>R)}}),h.push(v=>{(!p||!dh)&&function(b,C){[].slice.call(C.db.objectStoreNames).forEach(E=>b[E]==null&&C.db.deleteObjectStore(E))}(y._cfg.dbschema,v),oi(u,[u.Transaction.prototype]),Fr(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),l.schema=u._dbSchema})}),g().then(()=>{var y,v;v=f,B(y=m).forEach(b=>{v.db.objectStoreNames.contains(b)||vn(v,b,y[b].primKey,y[b].indexes)})})}(e,t,o,r).catch(s)})}function ya(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const i=e[n],o=t[n];if(i){const s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Yr)s.recreate=!0,r.change.push(s);else{const a=i.idxByName,u=o.idxByName;let c;for(c in a)u[c]||s.del.push(c);for(c in u){const l=a[c],f=u[c];l?l.src!==f.src&&s.change.push(f):s.add.push(f)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}else r.add.push([n,o])}return r}function vn(e,t,r,n){const i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(o=>si(i,o)),i}function si(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function ai(e,t,r){const n={};return Mr(t.objectStoreNames,0).forEach(i=>{const o=r.objectStore(i);let s=o.keyPath;const a=ri(pa(s),s||"",!1,!1,!!o.autoIncrement,s&&typeof s!="string",!0),u=[];for(let l=0;l<o.indexNames.length;++l){const f=o.index(o.indexNames[l]);s=f.keyPath;var c=ri(f.name,s,!!f.unique,!!f.multiEntry,!1,s&&typeof s!="string",!1);u.push(c)}n[i]=ma(i,a,u)}),n}function ui({_novip:e},t,r){const n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){const o=n[i],s=r.objectStore(o);e._hasGetAll="getAll"in s;for(let a=0;a<s.indexNames.length;++a){const u=s.indexNames[a],c=s.index(u).keyPath,l=typeof c=="string"?c:"["+Mr(c).join("+")+"]";if(t[o]){const f=t[o].idxByName[l];f&&(f.name=u,delete t[o].idxByName[l],t[o].idxByName[u]=f)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&A.WorkerGlobalScope&&A instanceof A.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class Sh{_parseStoresSpec(t,r){B(t).forEach(n=>{if(t[n]!==null){var i=t[n].split(",").map((s,a)=>{const u=(s=s.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return ri(u,c||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),Q(c),a===0)}),o=i.shift();if(o.multi)throw new k.Schema("Primary key cannot be multi-valued");i.forEach(s=>{if(s.auto)throw new k.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new k.Schema("Index must have a name and cannot be an empty string")}),r[n]=ma(n,o,i)}})}stores(t){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?J(this._cfg.storesSource,t):t;const n=r._versions,i={};let o={};return n.forEach(s=>{J(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),r._dbSchema=o,oi(r,[r._allTables,r,r.Transaction.prototype]),Fr(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],B(o),o),r._storeNames=B(o),this}upgrade(t){return this._cfg.contentUpgrade=Ti(this._cfg.contentUpgrade||P,t),this}}function Ki(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new mt("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Bi(e){return e&&typeof e.databases=="function"}function ci(e){return Me(function(){return D.letThrough=!0,e()})}function Dh(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)}):Promise.resolve()}function kh(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?F(t.dbOpenError):e);de&&(t.openCanceller._stackHolder=et()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function i(){if(t.openCanceller!==n)throw new k.DatabaseClosed("db.open() was cancelled")}let o=t.dbReadyResolve,s=null,a=!1;return x.race([n,(typeof navigator>"u"?x.resolve():Dh()).then(()=>new x((u,c)=>{if(i(),!r)throw new k.MissingAPI;const l=e.name,f=t.autoSchema?r.open(l):r.open(l,Math.round(10*e.verno));if(!f)throw new k.MissingAPI;f.onerror=le(c),f.onblocked=T(e._fireOnBlocked),f.onupgradeneeded=T(h=>{if(s=f.transaction,t.autoSchema&&!e._options.allowEmptyDB){f.onerror=Jt,s.abort(),f.result.close();const m=r.deleteDatabase(l);m.onsuccess=m.onerror=T(()=>{c(new k.NoSuchDatabase(`Database ${l} doesnt exist`))})}else{s.onerror=le(c);var d=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;a=d<1,e._novip.idbdb=f.result,Ch(e,d/10,s,c)}},c),f.onsuccess=T(()=>{s=null;const h=e._novip.idbdb=f.result,d=Mr(h.objectStoreNames);if(d.length>0)try{const p=h.transaction((m=d).length===1?m[0]:m,"readonly");t.autoSchema?function({_novip:g},y,v){g.verno=y.version/10;const b=g._dbSchema=ai(0,y,v);g._storeNames=Mr(y.objectStoreNames,0),Fr(g,[g._allTables],B(b),b)}(e,h,p):(ui(e,e._dbSchema,p),function(g,y){const v=ya(ai(0,g.idbdb,y),g._dbSchema);return!(v.add.length||v.change.some(b=>b.add.length||b.change.length))}(e,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ii(e,p)}catch{}var m;Lt.push(e),h.onversionchange=T(p=>{t.vcFired=!0,e.on("versionchange").fire(p)}),h.onclose=T(p=>{e.on("close").fire(p)}),a&&function({indexedDB:p,IDBKeyRange:g},y){!Bi(p)&&y!=="__dbnames"&&Ki(p,g).put({name:y}).catch(P)}(e._deps,l),u()},c)}))]).then(()=>(i(),t.onReadyBeingFired=[],x.resolve(ci(()=>e.on.ready.fire(e.vip))).then(function u(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce(Ti,P);return t.onReadyBeingFired=[],x.resolve(ci(()=>c(e.vip))).then(u)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(u=>{t.dbOpenError=u;try{s&&s.abort()}catch{}return n===t.openCanceller&&e._close(),F(u)}).finally(()=>{t.openComplete=!0,o()})}function li(e){var t=o=>e.next(o),r=i(t),n=i(o=>e.throw(o));function i(o){return s=>{var a=o(s),u=a.value;return a.done?u:u&&typeof u.then=="function"?u.then(r,n):Q(u)?Promise.all(u).then(r,n):r(u)}}return i(t)()}function Rh(e,t,r){var n=arguments.length;if(n<2)throw new k.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var o=Ys(i);return[e,o,r]}function va(e,t,r,n,i){return x.resolve().then(()=>{const o=D.transless||D,s=e._createTransaction(t,r,e._dbSchema,n),a={trans:s,transless:o};if(n)s.idbtrans=n.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(f){return f.name===Ai.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then(()=>va(e,t,r,null,i))):F(f)}const u=Pi(i);let c;u&&kt();const l=x.follow(()=>{if(c=i.call(s,s),c)if(u){var f=Ce.bind(null,null);c.then(f,f)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=li(c))},a);return(c&&typeof c.then=="function"?x.resolve(c).then(f=>s.active?f:F(new k.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):l.then(()=>c)).then(f=>(n&&s._resolve(),s._completion.then(()=>f))).catch(f=>(s._reject(f),F(f)))})}function yr(e,t,r){const n=Q(e)?e.slice():[e];for(let i=0;i<r;++i)n.push(t);return n}const Ph={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,i={},o=[];function s(l,f,h){const d=qt(l),m=i[d]=i[d]||[],p=l==null?0:typeof l=="string"?1:l.length,g=f>0,y={...h,isVirtual:g,keyTail:f,keyLength:p,extractKey:ni(l),unique:!g&&h.unique};return m.push(y),y.isPrimaryKey||o.push(y),p>1&&s(p===2?l[0]:l.slice(0,p-1),f+1,h),m.sort((v,b)=>v.keyTail-b.keyTail),y}const a=s(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(const l of n.indexes)s(l.keyPath,0,l);function u(l){const f=l.query.index;return f.isVirtual?{...l,query:{index:f,range:(h=l.query.range,d=f.keyTail,{type:h.type===1?2:h.type,lower:yr(h.lower,h.lowerOpen?e.MAX_KEY:e.MIN_KEY,d),lowerOpen:!0,upper:yr(h.upper,h.upperOpen?e.MIN_KEY:e.MAX_KEY,d),upperOpen:!0})}}:l;var h,d}return{...r,schema:{...n,primaryKey:a,indexes:o,getIndexByKeyPath:function(l){const f=i[qt(l)];return f&&f[0]}},count:l=>r.count(u(l)),query:l=>r.query(u(l)),openCursor(l){const{keyTail:f,isVirtual:h,keyLength:d}=l.query.index;return h?r.openCursor(u(l)).then(m=>m&&function(p){return Object.create(p,{continue:{value:function(y){y!=null?p.continue(yr(y,l.reverse?e.MAX_KEY:e.MIN_KEY,f)):l.unique?p.continue(p.key.slice(0,d).concat(l.reverse?e.MIN_KEY:e.MAX_KEY,f)):p.continue()}},continuePrimaryKey:{value(y,v){p.continuePrimaryKey(yr(y,e.MAX_KEY,f),v)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const y=p.key;return d===1?y[0]:y.slice(0,d)}},value:{get:()=>p.value}})}(m)):r.openCursor(l)}}}}}};function Li(e,t,r,n){return r=r||{},n=n||"",B(e).forEach(i=>{if(oe(t,i)){var o=e[i],s=t[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){const a=Hn(o);a!==Hn(s)?r[n+i]=t[i]:a==="Object"?Li(o,s,r,n+i+"."):o!==s&&(r[n+i]=t[i])}else o!==s&&(r[n+i]=t[i])}else r[n+i]=void 0}),B(t).forEach(i=>{oe(e,i)||(r[n+i]=t[i])}),r}const Ih={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema;return{...r,mutate(o){const s=D.trans,{deleting:a,creating:u,updating:c}=s.table(t).hook;switch(o.type){case"add":if(u.fire===P)break;return s._promise("readwrite",()=>l(o),!0);case"put":if(u.fire===P&&c.fire===P)break;return s._promise("readwrite",()=>l(o),!0);case"delete":if(a.fire===P)break;return s._promise("readwrite",()=>l(o),!0);case"deleteRange":if(a.fire===P)break;return s._promise("readwrite",()=>function(h){return f(h.trans,h.range,1e4)}(o),!0)}return r.mutate(o);function l(h){const d=D.trans,m=h.keys||function(p,g){return g.type==="delete"?g.keys:g.keys||g.values.map(p.extractKey)}(n,h);if(!m)throw new Error("Keys missing");return(h=h.type==="add"||h.type==="put"?{...h,keys:m}:{...h}).type!=="delete"&&(h.values=[...h.values]),h.keys&&(h.keys=[...h.keys]),function(p,g,y){return g.type==="add"?Promise.resolve([]):p.getMany({trans:g.trans,keys:y,cache:"immutable"})}(r,h,m).then(p=>{const g=m.map((y,v)=>{const b=p[v],C={onerror:null,onsuccess:null};if(h.type==="delete")a.fire.call(C,y,b,d);else if(h.type==="add"||b===void 0){const E=u.fire.call(C,y,h.values[v],d);y==null&&E!=null&&(y=E,h.keys[v]=y,n.outbound||ue(h.values[v],n.keyPath,y))}else{const E=Li(b,h.values[v]),w=c.fire.call(C,E,y,b,d);if(w){const O=h.values[v];Object.keys(w).forEach(R=>{oe(O,R)?O[R]=w[R]:ue(O,R,w[R])})}}return C});return r.mutate(h).then(({failures:y,results:v,numFailures:b,lastResult:C})=>{for(let E=0;E<m.length;++E){const w=v?v[E]:m[E],O=g[E];w==null?O.onerror&&O.onerror(y[E]):O.onsuccess&&O.onsuccess(h.type==="put"&&p[E]?h.values[E]:w)}return{failures:y,results:v,numFailures:b,lastResult:C}}).catch(y=>(g.forEach(v=>v.onerror&&v.onerror(y)),Promise.reject(y)))})}function f(h,d,m){return r.query({trans:h,values:!1,query:{index:n,range:d},limit:m}).then(({result:p})=>l({type:"delete",keys:p,trans:h}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):p.length<m?{failures:[],numFailures:0,lastResult:void 0}:f(h,{...d,lower:p[p.length-1],lowerOpen:!0},m)))}}}}})};function ga(e,t,r){try{if(!t||t.keys.length<e.length)return null;const n=[];for(let i=0,o=0;i<t.keys.length&&o<e.length;++i)G(t.keys[i],e[o])===0&&(n.push(r?or(t.values[i]):t.values[i]),++o);return n.length===e.length?n:null}catch{return null}}const Ah={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);const i=ga(n.keys,n.trans._cache,n.cache==="clone");return i?x.resolve(i):r.getMany(n).then(o=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?or(o):o},o))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function Fi(e){return!("from"in e)}const me=function(e,t){if(!this){const r=new me;return e&&"d"in e&&J(r,e),r}J(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Zt(e,t,r){const n=G(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Fi(e))return J(e,{from:t,to:r,d:1});const i=e.l,o=e.r;if(G(r,e.from)<0)return i?Zt(i,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Do(e);if(G(t,e.to)>0)return o?Zt(o,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Do(e);G(t,e.from)<0&&(e.from=t,e.l=null,e.d=o?o.d+1:1),G(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const s=!e.r;i&&!e.l&&qr(e,i),o&&s&&qr(e,o)}function qr(e,t){Fi(t)||function r(n,{from:i,to:o,l:s,r:a}){Zt(n,i,o),s&&r(n,s),a&&r(n,a)}(e,t)}function Th(e,t){const r=fi(t);let n=r.next();if(n.done)return!1;let i=n.value;const o=fi(e);let s=o.next(i.from),a=s.value;for(;!n.done&&!s.done;){if(G(a.from,i.to)<=0&&G(a.to,i.from)>=0)return!0;G(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function fi(e){let t=Fi(e)?null:{s:0,n:e};return{next(r){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&G(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||G(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Do(e){var t,r;const n=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((r=e.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const o=i==="r"?"l":"r",s={...e},a=e[i];e.from=a.from,e.to=a.to,e[i]=a[i],s[i]=a[o],e[o]=s,s.d=ko(s)}e.d=ko(e)}function ko({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}xt(me.prototype,{add(e){return qr(this,e),this},addKey(e){return Zt(this,e,e),this},addKeys(e){return e.forEach(t=>Zt(this,t,t)),this},[Wn](){return fi(this)}});const Mh={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new me(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const i=e.table(n),{schema:o}=i,{primaryKey:s}=o,{extractKey:a,outbound:u}=s,c={...i,mutate:h=>{const d=h.trans,m=d.mutatedParts||(d.mutatedParts={}),p=w=>{const O=`idb://${t}/${n}/${w}`;return m[O]||(m[O]=new me)},g=p(""),y=p(":dels"),{type:v}=h;let[b,C]=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[];const E=h.trans._cache;return i.mutate(h).then(w=>{if(Q(b)){v!=="delete"&&(b=w.results),g.addKeys(b);const O=ga(b,E);O||v==="add"||y.addKeys(b),(O||C)&&function(R,S,I,N){function V(U){const K=R(U.name||"");function tt(Z){return Z!=null?U.extractKey(Z):null}const rt=Z=>U.multiEntry&&Q(Z)?Z.forEach(Fe=>K.addKey(Fe)):K.addKey(Z);(I||N).forEach((Z,Fe)=>{const Pt=I&&tt(I[Fe]),Jr=N&&tt(N[Fe]);G(Pt,Jr)!==0&&(Pt!=null&&rt(Pt),Jr!=null&&rt(Jr))})}S.indexes.forEach(V)}(p,o,O,C)}else if(b){const O={from:b.lower,to:b.upper};y.add(O),g.add(O)}else g.add(r),y.add(r),o.indexes.forEach(O=>p(O.name).add(r));return w})}},l=({query:{index:h,range:d}})=>{var m,p;return[h,new me((m=d.lower)!==null&&m!==void 0?m:e.MIN_KEY,(p=d.upper)!==null&&p!==void 0?p:e.MAX_KEY)]},f={get:h=>[s,new me(h.key)],getMany:h=>[s,new me().addKeys(h.keys)],count:l,query:l,openCursor:l};return B(f).forEach(h=>{c[h]=function(d){const{subscr:m}=D;if(m){const p=C=>{const E=`idb://${t}/${n}/${C}`;return m[E]||(m[E]=new me)},g=p(""),y=p(":dels"),[v,b]=f[h](d);if(p(v.name||"").add(b),!v.isPrimaryKey){if(h!=="count"){const C=h==="query"&&u&&d.values&&i.query({...d,values:!1});return i[h].apply(this,arguments).then(E=>{if(h==="query"){if(u&&d.values)return C.then(({result:O})=>(g.addKeys(O),E));const w=d.values?E.result.map(a):E.result;d.values?g.addKeys(w):y.addKeys(w)}else if(h==="openCursor"){const w=E,O=d.values;return w&&Object.create(w,{key:{get:()=>(y.addKey(w.primaryKey),w.key)},primaryKey:{get(){const R=w.primaryKey;return y.addKey(R),R}},value:{get:()=>(O&&g.addKey(w.primaryKey),w.value)}})}return E})}y.add(r)}}return i[h].apply(this,arguments)}}),c}}}};class mt{constructor(t,r){this._middlewares={},this.verno=0;const n=mt.dependencies;this._options=r={addons:mt.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:P,dbReadyPromise:null,cancelOpen:P,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;o.dbReadyPromise=new x(a=>{o.dbReadyResolve=a}),o.openCanceller=new x((a,u)=>{o.cancelOpen=u}),this._state=o,this.name=t,this.on=Ft(this,"populate","blocked","versionchange","close",{ready:[Ti,P]}),this.on.ready.subscribe=Qs(this.on.ready.subscribe,a=>(u,c)=>{mt.vip(()=>{const l=this._state;if(l.openComplete)l.dbOpenError||x.resolve().then(u),c&&a(u);else if(l.onReadyBeingFired)l.onReadyBeingFired.push(u),c&&a(u);else{a(u);const f=this;c||a(function h(){f.on.ready.unsubscribe(u),f.on.ready.unsubscribe(h)})}})}),this.Collection=(s=this,At(vh.prototype,function(a,u){this.db=s;let c=fa,l=null;if(u)try{c=u()}catch(m){l=m}const f=a._ctx,h=f.table,d=h.hook.reading.fire;this._ctx={table:h,index:f.index,isPrimKey:!f.index||h.schema.primKey.keyPath&&f.index===h.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:l,or:f.or,valueMapper:d!==Gt?d:null}})),this.Table=function(a){return At(yh.prototype,function(u,c,l){this.db=a,this._tx=l,this.name=u,this.schema=c,this.hook=a._allTables[u]?a._allTables[u].hook:Ft(null,{creating:[nh,P],reading:[rh,Gt],updating:[oh,P],deleting:[ih,P]})})}(this),this.Transaction=function(a){return At(_h.prototype,function(u,c,l,f,h){this.db=a,this.mode=u,this.storeNames=c,this.schema=l,this.chromeTransactionDurability=f,this.idbtrans=null,this.on=Ft(this,"complete","error","abort"),this.parent=h||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new x((d,m)=>{this._resolve=d,this._reject=m}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},d=>{var m=this.active;return this.active=!1,this.on.error.fire(d),this.parent?this.parent._reject(d):m&&this.idbtrans&&this.idbtrans.abort(),F(d)})})}(this),this.Version=function(a){return At(Sh.prototype,function(u){this.db=a,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return At(da.prototype,function(u,c,l){this.db=a,this._ctx={table:u,index:c===":id"?null:c,or:l};const f=a._deps.indexedDB;if(!f)throw new k.MissingAPI;this._cmp=this._ascending=f.cmp.bind(f),this._descending=(h,d)=>f.cmp(d,h),this._max=(h,d)=>f.cmp(h,d)>0?h:d,this._min=(h,d)=>f.cmp(h,d)<0?h:d,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=Xt(r.IDBKeyRange),this._createTransaction=(a,u,c,l)=>new this.Transaction(a,u,c,this._options.chromeTransactionDurability,l),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Lt.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(a))},this.use(Ph),this.use(Ih),this.use(Mh),this.use(Ah),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(t){if(isNaN(t)||t<.1)throw new k.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new k.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const r=this._versions;var n=r.filter(i=>i._cfg.version===t)[0];return n||(n=new this.Version(t),r.push(n),r.sort(xh),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(t){return this.idbdb&&(this._state.openComplete||D.letThrough||this._vip)?t():new x((r,n)=>{if(this._state.openComplete)return n(new k.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new k.DatabaseClosed);this.open().catch(P)}this._state.dbReadyPromise.then(r,n)}).then(t)}use({stack:t,create:r,level:n,name:i}){i&&this.unuse({stack:t,name:i});const o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:r,level:n??10,name:i}),o.sort((s,a)=>s.level-a.level),this}unuse({stack:t,name:r,create:n}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>n?i.create!==n:!!r&&i.name!==r)),this}open(){return kh(this)}_close(){const t=this._state,r=Lt.indexOf(this);if(r>=0&&Lt.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new x(n=>{t.dbReadyResolve=n}),t.openCanceller=new x((n,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new k.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,r=this._state;return new x((n,i)=>{const o=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=T(()=>{(function({indexedDB:a,IDBKeyRange:u},c){!Bi(a)&&c!=="__dbnames"&&Ki(a,u).delete(c).catch(P)})(this._deps,this.name),n()}),s.onerror=le(i),s.onblocked=this._fireOnBlocked};if(t)throw new k.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return B(this._allTables).map(t=>this._allTables[t])}transaction(){const t=Rh.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,r,n){let i=D.trans;i&&i.db===this&&t.indexOf("!")===-1||(i=null);const o=t.indexOf("?")!==-1;let s,a;t=t.replace("!","").replace("?","");try{if(a=r.map(c=>{var l=c instanceof this.Table?c.name:c;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),t=="r"||t==="readonly")s="readonly";else{if(t!="rw"&&t!="readwrite")throw new k.InvalidArgument("Invalid transaction mode: "+t);s="readwrite"}if(i){if(i.mode==="readonly"&&s==="readwrite"){if(!o)throw new k.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(c=>{if(i&&i.storeNames.indexOf(c)===-1){if(!o)throw new k.SubTransaction("Table "+c+" not included in parent transaction.");i=null}}),o&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(l,f)=>{f(c)}):F(c)}const u=va.bind(null,this,s,a,i,n);return i?i._promise(s,u,"lock"):D.trans?Rt(D.transless,()=>this._whenReady(u)):this._whenReady(u)}table(t){if(!oe(this._allTables,t))throw new k.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Nh=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class $h{constructor(t){this._subscribe=t}subscribe(t,r,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:r,complete:n})}[Nh](){return this}}function ba(e,t){return B(t).forEach(r=>{qr(e[r]||(e[r]=new me),t[r])}),e}function Kh(e){return new $h(t=>{const r=Pi(e);let n=!1,i={},o={};const s={get closed(){return n},unsubscribe:()=>{n=!0,$e.storagemutated.unsubscribe(l)}};t.start&&t.start(s);let a=!1,u=!1;function c(){return B(o).some(h=>i[h]&&Th(i[h],o[h]))}const l=h=>{ba(i,h),c()&&f()},f=()=>{if(a||n)return;i={};const h={},d=function(m){r&&kt();const p=()=>Me(e,{subscr:m,trans:null}),g=D.trans?Rt(D.transless,p):p();return r&&g.then(Ce,Ce),g}(h);u||($e("storagemutated",l),u=!0),a=!0,Promise.resolve(d).then(m=>{a=!1,n||(c()?f():(i={},o=h,t.next&&t.next(m)))},m=>{["DatabaseClosedError","AbortError"].includes(m==null?void 0:m.name)||(a=!1,t.error&&t.error(m),s.unsubscribe())})};return f(),s})}let hi;try{hi={indexedDB:A.indexedDB||A.mozIndexedDB||A.webkitIndexedDB||A.msIndexedDB,IDBKeyRange:A.IDBKeyRange||A.webkitIDBKeyRange}}catch{hi={indexedDB:null,IDBKeyRange:null}}const qe=mt;function Rr(e){let t=ge;try{ge=!0,$e.storagemutated.fire(e)}finally{ge=t}}xt(qe,{...Or,delete:e=>new qe(e,{addons:[]}).delete(),exists:e=>new qe(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function({indexedDB:t,IDBKeyRange:r}){return Bi(t)?Promise.resolve(t.databases()).then(n=>n.map(i=>i.name).filter(i=>i!=="__dbnames")):Ki(t,r).toCollection().primaryKeys()}(qe.dependencies).then(e)}catch{return F(new k.MissingAPI)}},defineClass:()=>function(e){J(this,e)},ignoreTransaction:e=>D.trans?Rt(D.transless,e):e(),vip:ci,async:function(e){return function(){try{var t=li(e.apply(this,arguments));return t&&typeof t.then=="function"?t:x.resolve(t)}catch(r){return F(r)}}},spawn:function(e,t,r){try{var n=li(e.apply(r,t||[]));return n&&typeof n.then=="function"?n:x.resolve(n)}catch(i){return F(i)}},currentTransaction:{get:()=>D.trans||null},waitFor:function(e,t){const r=x.resolve(typeof e=="function"?qe.ignoreTransaction(e):e).timeout(t||6e4);return D.trans?D.trans.waitFor(r):r},Promise:x,debug:{get:()=>de,set:e=>{Xs(e,e==="dexie"?()=>!0:la)}},derive:ht,extend:J,props:xt,override:Qs,Events:Ft,on:$e,liveQuery:Kh,extendObservabilitySet:ba,getByKeyPath:_e,setByKeyPath:ue,delByKeyPath:function(e,t){typeof t=="string"?ue(e,t,void 0):"length"in t&&[].map.call(t,function(r){ue(e,r,void 0)})},shallowClone:Gs,deepClone:or,getObjectDiff:Li,cmp:G,asap:zs,minKey:-(1/0),addons:[],connections:Lt,errnames:Ai,dependencies:hi,semVer:"4.0.0-alpha.4",version:"4.0.0-alpha.4".split(".").map(e=>parseInt(e)).reduce((e,t,r)=>e+t/Math.pow(10,2*r))}),qe.maxKey=Xt(qe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($e("storagemutated",e=>{if(!ge){let t;Yr?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),ge=!0,dispatchEvent(t),ge=!1}}),addEventListener("x-storagemutated-1",({detail:e})=>{ge||Rr(e)}));let ge=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel("x-storagemutated-1");typeof e.unref=="function"&&e.unref(),$e("storagemutated",t=>{ge||e.postMessage(t)}),e.onmessage=t=>{t.data&&Rr(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){$e("storagemutated",t=>{try{ge||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:"x-storagemutated-1",changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key==="x-storagemutated-1"){const r=JSON.parse(t.newValue);r&&Rr(r.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function({data:t}){t&&t.type==="x-storagemutated-1"&&Rr(t.changedParts)})}x.rejectionMapper=function(e,t){if(!e||e instanceof dt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!bo[e.name])return e;var r=new bo[e.name](t||e.message,e);return"stack"in e&&we(r,"stack",{get:function(){return this.inner.stack}}),r},Xs(de,la);var Bh=Wf,Ro={UT1:"given name is no string or empty",UT2:`collection- and database-names must match the regex to be compatible with couchdb databases.
    See https://neighbourhood.ie/blog/2020/10/13/everything-you-need-to-know-about-couchdb-database-names/
    info: if your database-name specifies a folder, the name must contain the slash-char '/' or '\\'`,UT3:"replication-direction must either be push or pull or both. But not none",UT4:"given leveldown is no valid adapter",UT5:"keyCompression is set to true in the schema but no key-compression handler is used in the storage",UT6:"schema contains encrypted fields but no encryption handler is used in the storage",UT7:"attachments.compression is enabled but no attachment-compression plugin is used",PL1:"Given plugin is not RxDB plugin.",PL3:"A plugin with the same name was already added but it was not the exact same JavaScript object",P2:"bulkWrite() cannot be called with an empty array",QU1:"RxQuery._execOverDatabase(): op not known",QU4:"RxQuery.regex(): You cannot use .regex() on the primary field",QU5:"RxQuery.sort(): does not work because key is not defined in the schema",QU6:"RxQuery.limit(): cannot be called on .findOne()",QU9:"throwIfMissing can only be used in findOne queries",QU10:"result empty and throwIfMissing: true",QU11:"RxQuery: no valid query params given",QU12:"Given index is not in schema",QU13:"A top level field of the query is not included in the schema",QU14:"Running a count() query in slow mode is now allowed. Either run a count() query with a selector that fully matches an index or set allowSlowCount=true when calling the createRxDatabase",QU15:"For count queries it is not allowed to use skip or limit",MQ1:"path must be a string or object",MQ2:"Invalid argument",MQ3:"Invalid sort() argument. Must be a string, object, or array",MQ4:"Invalid argument. Expected instanceof mquery or plain object",MQ5:"method must be used after where() when called with these arguments",MQ6:"Can't mix sort syntaxes. Use either array or object | .sort([['field', 1], ['test', -1]]) | .sort({ field: 1, test: -1 })",MQ7:"Invalid sort value",MQ8:"Can't mix sort syntaxes. Use either array or object",DB1:"RxDocument.prepare(): another instance on this adapter has a different password",DB2:"RxDatabase.addCollections(): collection-names cannot start with underscore _",DB3:"RxDatabase.addCollections(): collection already exists. use myDatabase.[collectionName] to get it",DB4:"RxDatabase.addCollections(): schema is missing",DB5:"RxDatabase.addCollections(): collection-name not allowed",DB6:"RxDatabase.addCollections(): another instance created this collection with a different schema. Read this https://pubkey.github.io/rxdb/questions-answers.html#cant-change-the-schema",DB8:`RxDatabase.create(): A RxDatabase with the same name and adapter already exists.
Make sure to use this combination only once or set ignoreDuplicate to true if you do this intentional`,DB11:"createRxDatabase(): Invalid db-name, folder-paths must not have an ending slash",DB12:"RxDatabase.addCollections(): could not write to internal store",DB13:"createRxDatabase(): Invalid db-name or collection name, name contains the dollar sign",COL1:"RxDocument.insert() You cannot insert an existing document",COL2:"RxCollection.insert() fieldName ._id can only be used as primaryKey",COL3:"RxCollection.upsert() does not work without primary",COL4:"RxCollection.incrementalUpsert() does not work without primary",COL5:"RxCollection.find() if you want to search by _id, use .findOne(_id)",COL6:"RxCollection.findOne() needs a queryObject or string",COL7:"hook must be a function",COL8:"hooks-when not known",COL9:"RxCollection.addHook() hook-name not known",COL10:"RxCollection .postCreate-hooks cannot be async",COL11:"migrationStrategies must be an object",COL12:"A migrationStrategy is missing or too much",COL13:"migrationStrategy must be a function",COL14:"given static method-name is not a string",COL15:"static method-names cannot start with underscore _",COL16:"given static method is not a function",COL17:"RxCollection.ORM: statics-name not allowed",COL18:"collection-method not allowed because fieldname is in the schema",COL20:"Storage write error",CONFLICT:"Document update conflict. When changing a document you must work on the previous revision",DOC1:"RxDocument.get$ cannot get observable of in-array fields because order cannot be guessed",DOC2:"cannot observe primary path",DOC3:"final fields cannot be observed",DOC4:"RxDocument.get$ cannot observe a non-existed field",DOC5:"RxDocument.populate() cannot populate a non-existed field",DOC6:"RxDocument.populate() cannot populate because path has no ref",DOC7:"RxDocument.populate() ref-collection not in database",DOC8:"RxDocument.set(): primary-key cannot be modified",DOC9:"final fields cannot be modified",DOC10:"RxDocument.set(): cannot set childpath when rootPath not selected",DOC11:"RxDocument.save(): can't save deleted document",DOC13:"RxDocument.remove(): Document is already deleted",DOC14:"RxDocument.destroy() does not exist",DOC15:"query cannot be an array",DOC16:"Since version 8.0.0 RxDocument.set() can only be called on temporary RxDocuments",DOC17:"Since version 8.0.0 RxDocument.save() can only be called on non-temporary documents",DOC18:"Document property for composed primary key is missing",DOC19:"Value of primary key(s) cannot be changed",DOC20:"PrimaryKey missing",DOC21:"PrimaryKey must be equal to PrimaryKey.trim(). It cannot start or end with a whitespace",DOC22:"PrimaryKey must not contain a linebreak",DOC23:'PrimaryKey must not contain a double-quote ["]',DM1:"migrate() Migration has already run",DM2:"migration of document failed final document does not match final schema",DM3:"migration already running",AT1:"to use attachments, please define this in your schema",EN1:"password is not valid",EN2:"validatePassword: min-length of password not complied",EN3:"Schema contains encrypted properties but no password is given",EN4:"Password not valid",JD1:"You must create the collections before you can import their data",JD2:"RxCollection.importJSON(): the imported json relies on a different schema",JD3:"RxCollection.importJSON(): json.passwordHash does not match the own",LD1:"RxDocument.allAttachments$ can't use attachments on local documents",LD2:"RxDocument.get(): objPath must be a string",LD3:"RxDocument.get$ cannot get observable of in-array fields because order cannot be guessed",LD4:"cannot observe primary path",LD5:"RxDocument.set() id cannot be modified",LD6:"LocalDocument: Function is not usable on local documents",LD7:"Local document already exists",LD8:"localDocuments not activated. Set localDocuments=true on creation, when you want to store local documents on the RxDatabase or RxCollection.",RC1:"Replication: already added",RC2:"replicateCouchDB() query must be from the same RxCollection",RC4:"RxCouchDBReplicationState.awaitInitialReplication() cannot await initial replication when live: true",RC5:"RxCouchDBReplicationState.awaitInitialReplication() cannot await initial replication if multiInstance because the replication might run on another instance",RC6:"syncFirestore() serverTimestampField MUST NOT be part of the collections schema and MUST NOT be nested.",RC_PULL:"RxReplication pull handler threw an error - see .errors for more details",RC_STREAM:"RxReplication pull stream$ threw an error - see .errors for more details",RC_PUSH:"RxReplication push handler threw an error - see .errors for more details",RC_PUSH_NO_AR:"RxReplication push handler did not return an array with the conflicts",RC_P2P_PEER:"RxReplication P2P Peer has error",RC_COUCHDB_1:"replicateCouchDB() url must end with a slash like 'https://example.com/mydatabase/'",RC_COUCHDB_2:"replicateCouchDB() did not get valid result with rows.",SC1:"fieldnames do not match the regex",SC2:"SchemaCheck: name 'item' reserved for array-fields",SC3:"SchemaCheck: fieldname has a ref-array but items-type is not string",SC4:"SchemaCheck: fieldname has a ref but is not type string, [string,null] or array<string>",SC6:"SchemaCheck: primary can only be defined at top-level",SC7:"SchemaCheck: default-values can only be defined at top-level",SC8:"SchemaCheck: first level-fields cannot start with underscore _",SC10:"SchemaCheck: schema defines ._rev, this will be done automatically",SC11:"SchemaCheck: schema needs a number >=0 as version",SC13:"SchemaCheck: primary is always index, do not declare it as index",SC14:"SchemaCheck: primary is always unique, do not declare it as index",SC15:"SchemaCheck: primary cannot be encrypted",SC16:"SchemaCheck: primary must have type: string",SC17:"SchemaCheck: top-level fieldname is not allowed",SC18:"SchemaCheck: indexes must be an array",SC19:"SchemaCheck: indexes must contain strings or arrays of strings",SC20:"SchemaCheck: indexes.array must contain strings",SC21:"SchemaCheck: given index is not defined in schema",SC22:"SchemaCheck: given indexKey is not type:string",SC23:"SchemaCheck: fieldname is not allowed",SC24:"SchemaCheck: required fields must be set via array. See https://spacetelescope.github.io/understanding-json-schema/reference/object.html#required",SC25:"SchemaCheck: compoundIndexes needs to be specified in the indexes field",SC26:"SchemaCheck: indexes needs to be specified at collection schema level",SC27:"SchemaCheck: encrypted fields need to be specified at collection schema level",SC28:"SchemaCheck: encrypted fields is not defined in the schema",SC29:"SchemaCheck: missing object key 'properties'",SC30:"SchemaCheck: primaryKey is required",SC32:"SchemaCheck: primary field must have the type string/number/integer",SC33:"SchemaCheck: used primary key is not a property in the schema",SC34:"Fields of type string that are used in an index, must have set the maxLength attribute in the schema",SC35:"Fields of type number/integer that are used in an index, must have set the multipleOf attribute in the schema",SC36:"A field of this type cannot be used as index",SC37:"Fields of type number that are used in an index, must have set the minimum and maximum attribute in the schema",SC38:"Fields of type boolean that are used in an index, must be required in the schema",SC39:"The primary key must have the maxLength attribute set",VD1:"Sub-schema not found, does the schemaPath exists in your schema?",VD2:"object does not match schema",S1:"You cannot create collections after calling RxDatabase.server()",GQL1:"GraphQL replication: cannot find sub schema by key",GQL3:"GraphQL replication: pull returns more documents then batchSize",CRDT1:"CRDT operations cannot be used because the crdt options are not set in the schema.",CRDT2:"RxDocument.incrementalModify() cannot be used when CRDTs are activated.",CRDT3:"To use CRDTs you MUST NOT set a conflictHandler because the default CRDT conflict handler must be used",DXE1:"The dexie.js RxStorage does not support boolean indexes, see https://rxdb.info/rx-storage-dexie.html#boolean-index",SNH:"This should never happen"},gn;function Lh(){if(!gn){var e=new js,t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e));gn=[...t,...r]}return gn}var bn;function Fh(){if(!bn){var e=new qf("pseudoInstance","memory"),t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e));bn=[...t,...r],e.destroy()}return bn}var qh=ps(Qr),jh=new qh,wn;function wa(){if(!wn){var e=["deleted","synced"],t=Object.getOwnPropertyNames(jh),r=Object.getOwnPropertyNames(Qr);wn=[...t,...r,...e]}return wn}function Uh(e){if(e!=="_deleted"){if(["properties"].includes(e))throw _("SC23",{fieldName:e});var t="^[a-zA-Z](?:[[a-zA-Z0-9_]*]?[a-zA-Z0-9])?$",r=new RegExp(t);if(e!=="_id"&&!e.match(r))throw _("SC1",{regex:t,fieldName:e})}}function Hh(e){var t=Le(e.primaryKey);function r(i,o,s){if(typeof i=="string"&&typeof o=="object"&&!Array.isArray(o)&&Uh(i),o.hasOwnProperty("item")&&o.type!=="array")throw _("SC2",{fieldName:i});if(o.hasOwnProperty("required")&&typeof o.required=="boolean")throw _("SC24",{fieldName:i});if(o.hasOwnProperty("ref"))if(Array.isArray(o.type)){if(o.type.length>2||!o.type.includes("string")||!o.type.includes("null"))throw _("SC4",{fieldName:i})}else switch(o.type){case"string":break;case"array":if(!o.items||!o.items.type||o.items.type!=="string")throw _("SC3",{fieldName:i});break;default:throw _("SC4",{fieldName:i})}var a=s.split(".").length>=2;if(a){if(o.primary)throw _("SC6",{path:s,primary:o.primary});if(o.default)throw _("SC7",{path:s})}if(!a){if(i==="_id"&&t!=="_id")throw _("COL2",{fieldName:i});if(i.charAt(0)==="_"){if(i==="_id"||i==="_deleted")return;throw _("SC8",{fieldName:i})}}}function n(i,o){!i||typeof i!="object"||Object.keys(i).forEach(s=>{var a=i[s];!i.properties&&a&&typeof a=="object"&&!Array.isArray(i)&&r(s,a,o);var u=o;s!=="properties"&&(u=u+"."+s),n(a,u)})}return n(e,""),!0}function Wh(e){if(!e.primaryKey)throw _("SC30",{schema:e});function t(u){if(!u)throw _("SC33",{schema:e});var c=u.type;if(!c||!["string","number","integer"].includes(c))throw _("SC32",{schema:e,args:{schemaPart:u}})}if(typeof e.primaryKey=="string"){var r=e.primaryKey,n=e.properties[r];t(n)}else{var i=e.primaryKey,o=wt(e,i.key);t(o),i.fields.forEach(u=>{var c=wt(e,u);t(c)})}var s=Le(e.primaryKey),a=e.properties[s];if(!a.maxLength)throw _("SC39",{schema:e,args:{primaryPathSchemaPart:a}})}function Po(e){for(var t=e.split("."),r="",n=0;n<t.length;n+=1)t[n]!=="[]"?r=r.concat(".properties.".concat(t[n])):r=r.concat(".items");return Ut(r)}function Qh(e){if(!e.primaryKey)throw _("SC30",{schema:e});if(!e.hasOwnProperty("properties"))throw _("SC29",{schema:e});if(e.properties._rev)throw _("SC10",{schema:e});if(!e.hasOwnProperty("version")||typeof e.version!="number"||e.version<0)throw _("SC11",{version:e.version});if(Hh(e),Wh(e),Object.keys(e.properties).forEach(t=>{var r=e.properties[t];if(t===e.primaryKey){if(e.indexes&&e.indexes.includes(t))throw _("SC13",{value:r,schema:e});if(r.unique)throw _("SC14",{value:r,schema:e});if(e.encrypted&&e.encrypted.includes(t))throw _("SC15",{value:r,schema:e});if(r.type!=="string")throw _("SC16",{value:r,schema:e})}if(wa().includes(t))throw _("SC17",{key:t,schema:e})}),e.indexes){if(!ut(e.indexes))throw _("SC18",{indexes:e.indexes,schema:e});e.indexes.forEach(t=>{if(!(typeof t=="string"||Array.isArray(t)))throw _("SC19",{index:t,schema:e});if(Array.isArray(t)){for(var r=0;r<t.length;r+=1)if(typeof t[r]!="string")throw _("SC20",{index:t,schema:e})}var n=ut(t)?t:[t];n.forEach(i=>{var o=wt(e,i),s=o.type;switch(s){case"string":var a=o.maxLength;if(!a)throw _("SC34",{index:t,field:i,schema:e});break;case"number":case"integer":var u=o.multipleOf;if(!u)throw _("SC35",{index:t,field:i,schema:e});var c=o.maximum,l=o.minimum;if(typeof c>"u"||typeof l>"u")throw _("SC37",{index:t,field:i,schema:e});break;case"boolean":var f="",h=i;if(i.includes(".")){var d=i.split(".");h=d.pop(),f=d.join(".")}var m=f===""?e:wt(e,f);if(!m.required||!m.required.includes(h))throw _("SC38",{index:t,field:i,schema:e});break;default:throw _("SC36",{fieldName:i,type:o.type,schema:e})}})})}Object.keys(xn(e)).map(t=>{var r=t.split(".");return r.pop(),r.join(".")}).filter(t=>t!=="").filter((t,r,n)=>n.indexOf(t)===r).filter(t=>{var r=Pe(e,t);return r&&!!r.index}).forEach(t=>{throw t=t.replace("properties.",""),t=t.replace(/\.properties\./g,"."),_("SC26",{index:Ut(t),schema:e})}),(e.indexes||[]).reduce((t,r)=>(ut(r)?di(t,r):t.push(r),t),[]).filter((t,r,n)=>n.indexOf(t)===r).map(t=>{var r=Po(t),n=Pe(e,r);if(!n||typeof n!="object")throw _("SC21",{index:t,schema:e});return{indexPath:t,schemaObj:n}}).filter(t=>t.schemaObj.type!=="string"&&t.schemaObj.type!=="integer"&&t.schemaObj.type!=="number"&&t.schemaObj.type!=="boolean").forEach(t=>{throw _("SC22",{key:t.indexPath,type:t.schemaObj.type,schema:e})}),Object.keys(xn(e)).map(t=>{var r=t.split(".");return r.pop(),r.join(".")}).filter(t=>t!==""&&t!=="attachments").filter((t,r,n)=>n.indexOf(t)===r).filter(t=>{var r=Pe(e,t);return r&&!!r.encrypted}).forEach(t=>{throw t=t.replace("properties.",""),t=t.replace(/\.properties\./g,"."),_("SC27",{index:Ut(t),schema:e})}),e.encrypted&&e.encrypted.forEach(t=>{var r=Po(t),n=Pe(e,r);if(!n||typeof n!="object")throw _("SC28",{field:t,schema:e})})}function _n(e){e&&Object.entries(e).forEach(([t,r])=>{if(typeof t!="string")throw ae("COL14",{name:t});if(t.startsWith("_"))throw ae("COL15",{name:t});if(typeof r!="function")throw ae("COL16",{name:t,type:typeof t});if(Lh().includes(t)||wa().includes(t))throw _("COL17",{name:t})})}function zh(e,t){var r=Object.keys(e.properties);t&&Object.keys(t).filter(n=>r.includes(n)).forEach(n=>{throw _("COL18",{funName:n})})}function Vh(e,t){if(typeof t!="object"||Array.isArray(t))throw ae("COL11",{schema:e});var r=Gu(e);if(r.length!==Object.keys(t).length)throw _("COL12",{have:Object.keys(t),should:r});return r.map(n=>({v:n,s:t[n+1]})).filter(n=>typeof n.s!="function").forEach(n=>{throw ae("COL13",{version:n.v,type:typeof n,schema:e})}),!0}function Gh(e){if(Fh().includes(e.name))throw _("DB5",{name:e.name});Ea(e.name)}function Yh(e){if(Ea(e.name),e.name.includes("$"))throw _("DB13",{name:e.name});if(Mo(e.name)&&(e.name.endsWith("/")||e.name.endsWith("\\")))throw _("DB11",{name:e.name})}var _a="^[a-z][_$a-z0-9\\-]*$",Jh=new RegExp(_a);function Ea(e){if(typeof e!="string"||e.length===0)throw ae("UT1",{name:e});if(Mo(e))return!0;if(!e.match(Jh)&&e!==":memory:")throw _("UT2",{regex:_a,givenName:e});return!0}function Xh(e){var t=Object.prototype.toString.call(e.queryObj)==="[object Object]";if(!t)throw ae("QU11",{op:e.op,collection:e.collection.name,queryObj:e.queryObj});var r=["selector","limit","skip","sort","index"];if(Object.keys(e.queryObj).forEach(n=>{if(!r.includes(n))throw ae("QU11",{op:e.op,collection:e.collection.name,queryObj:e.queryObj,key:n,args:{validKeys:r}})}),e.op==="count"&&(e.queryObj.limit||e.queryObj.skip))throw _("QU15",{collection:e.collection.name,query:e.queryObj})}function Zh(e){var t=e.rxQuery.collection.schema.jsonSchema,r=e.mangoQuery.selector,n=Object.keys(t.properties);Object.keys(r).filter(a=>!a.startsWith("$")).filter(a=>!a.includes(".")).forEach(a=>{if(!n.includes(a))throw _("QU13",{schema:t,field:a,query:e.mangoQuery})});var i=t.indexes?t.indexes:[],o=e.mangoQuery.index;if(o){var s=i.find(a=>Ht(a,o));if(!s)throw _("QU12",{collection:e.rxQuery.collection.name,query:e.mangoQuery,schema:t})}if(e.rxQuery.op==="count"&&!ed(e.rxQuery.collection.schema.jsonSchema,e.mangoQuery)&&!e.rxQuery.collection.database.allowSlowCount)throw _("QU14",{collection:e.rxQuery.collection,query:e.mangoQuery});e.mangoQuery.sort&&e.mangoQuery.sort.map(a=>Object.keys(a)[0]).filter(a=>!a.includes(".")).forEach(a=>{if(!n.includes(a))throw _("QU13",{schema:t,field:a,query:e.mangoQuery})})}function ed(e,t){var r=Bh.prepareQuery(e,t);return r.queryPlan.selectorSatisfiedByIndex}function td(e,t){if(!e)throw _("DOC20",{primaryKey:e,document:t});if(e!==e.trim())throw _("DOC21",{primaryKey:e,document:t});if(e.includes("\r")||e.includes(`
`))throw _("DOC22",{primaryKey:e,document:t});if(e.includes('"'))throw _("DOC23",{primaryKey:e,document:t})}function rd(e){return!e||typeof e=="string"||typeof e=="number"?e:No(e)}var nd="dev-mode",id={name:nd,rxdb:!0,init:()=>{console.warn(["-------------- RxDB dev-mode warning -------------------------------","you are seeing this because you use the RxDB dev-mode plugin https://rxdb.info/dev-mode.html","This is great in development mode, because it will run many checks to ensure","that you use RxDB correct. If you see this in production mode,","you did something wrong because the dev-mode plugin will decrease the performance.","","🤗 Hint: To get the most out of RxDB, check out the Premium Plugins","to get access to faster storages and more professional features: https://rxdb.info/premium.html","","Also take part in the RxDB User Survey: https://rxdb.info/survey.html","---------------------------------------------------------------------"].join(`
`))},overwritable:{isDevMode(){return!0},deepFreezeWhenDevMode:rd,tunnelErrorMessage(e){if(!Ro[e])throw console.error("RxDB: Error-Code not known: "+e),new Error("Error-Code "+e+" not known, contact the maintainer");return Ro[e]}},hooks:{preCreateRxSchema:{after:Qh},preCreateRxDatabase:{after:function(e){Yh(e)}},preCreateRxCollection:{after:function(e){if(Gh(e),zh(e.schema,e.methods),e.name.charAt(0)==="_")throw _("DB2",{name:e.name});if(!e.schema)throw _("DB4",{name:e.name,args:e})}},createRxDocument:{before:function(e){td(e.primary,e.toJSON(!0))}},preCreateRxQuery:{after:function(e){Xh(e)}},prePrepareQuery:{after:e=>{Zh(e)}},createRxCollection:{after:e=>{_n(e.creator.statics),_n(e.creator.methods),_n(e.creator.attachments),e.creator.schema&&e.creator.migrationStrategies&&Vh(e.creator.schema,e.creator.migrationStrategies)}}}};export{nd as DEV_MODE_PLUGIN_NAME,id as RxDBDevModePlugin,ed as areSelectorsSatisfiedByIndex,Uh as checkFieldNameRegex,Zh as checkMangoQuery,Wh as checkPrimaryKey,Xh as checkQuery,Qh as checkSchema,rd as deepFreezeWhenDevMode,Gh as ensureCollectionNameValid,Yh as ensureDatabaseNameIsValid,Ea as validateDatabaseName,Hh as validateFieldsDeep};
