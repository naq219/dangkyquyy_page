<template>

  <el-button style="padding: 1em;" v-if="clickSubmited" @click="clickDangKyMoi"> ƒêƒÇNG K√ù M·ªöI</el-button>
  <p style="padding: 1em; color: #df1919;" v-if="clickSubmited"> Qu√Ω PT vui l√≤ng ch·ªù ƒë·ªÉ ƒëƒÉng k√Ω ·∫°! </p>
  <div v-if="!clickSubmited" class="wrap2">



    <svg id="radar-circle">

      <circle cx="50%" cy="30%" r="0" fill-opacity="0" stroke="#ffffff51" stroke-width="2px" stroke-opacity="1">
        <animate attributeName="r" from="300" to="915" dur="20s" repeatCount="indefinite" />
        <animate attributeName="stroke-opacity" from="1" to="0" dur="30s" repeatCount="indefinite"></animate>
      </circle>

      <circle cx="50%" cy="30%" r="0" fill-opacity="0" stroke="#ffffff51" stroke-width="2px" stroke-opacity="1">
        <animate attributeName="r" from="0" to="915" dur="13s" repeatCount="indefinite" begin="0.75s" />
        <animate attributeName="stroke-opacity" from="1" to="0" dur="33s" repeatCount="indefinite" begin="0.75s">
        </animate>
      </circle>

      <circle cx="50%" cy="45%" r="0" fill-opacity="0" stroke="#ffffff51" stroke-width="2px" stroke-opacity="1">
        <animate attributeName="r" from="0" to="915" dur="23s" repeatCount="indefinite" begin="1.5s" />
        <animate attributeName="stroke-opacity" from="1" to="0" dur="23s" repeatCount="indefinite" begin="1.5s">
        </animate>
      </circle>


    </svg>


    <p style="color:#ffffff; text-align: center; font-family: Verdana, Geneva, Tahoma, sans-serif; font-weight: bold ; margin: 2%; font-size: 2em;
            text-shadow: 1px 1px 2px black, 0 0 25px rgb(255, 255, 255), 0 0 5px darkblue;
            ">
      <strong>CH√ôA VI√äN QUANG</strong>
    </p>
    <div class="form_in1">
      <div class="form_wrapper">


        <div class="form_container">
          <div class="title_container">

            <h2
              style="color:#005c70; font-stretch: expanded; font-weight: 545  ; font-style: inherit; text-align: center;">
              ƒêƒÇNG K√ù QUY Y TAM B·∫¢O<br><br></h2>

            <div style="display: flex; justify-content: center; margin-top: 0.5em;">
              <el-button @click="toggleGhichu" style="text-align: center; margin: 0 auto;">
                {{ showGhichu ? 'R√∫t g·ªçn n·ªôi dung (DK nhanh)' : 'Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß' }}
              </el-button>
            </div>


          </div>
          <div class="row clearfix">
            <div class="parent d-flex justify-content-center">



              <el-form-item v-show="showGhichu">
                <p>Quy Y Tam B·∫£o l√† quay v·ªÅ n∆∞∆°ng t·ª±a 3 ng√¥i b√°u
                  Ph·∫≠t,
                  Ph√°p, TƒÉng. Khi ƒë√£ tr·ªü th√†nh ƒë·ªá t·ª≠ Ph·∫≠t, huynh ƒë·ªá
                  lu√¥n nh·∫≠n ƒë∆∞·ª£c s·ª± gia h·ªô c·ªßa ƒê·ª©c Ph·∫≠t, huynh ƒë·ªá c√≥ th√™m √Ω ch√≠ v∆∞·ª£t qua m·ªçi kh√≥ khƒÉn trong cu·ªôc
                  s·ªëng,
                  tinh t·∫•n tu t·∫≠p, si√™ng nƒÉng l√†m ph∆∞·ªõc v√† s·∫Ω g·∫∑p ƒë∆∞·ª£c nhi·ªÅu may m·∫Øn, ph√∫c l√†nh trong cu·ªôc s·ªëng.
                  <br>
                  "Quy Y Ph·∫≠t r·ªìi kh√¥ng ƒë·ªça ƒë·ªãa ng·ª•c <br>
                  Quy Y Ph√°p r·ªìi kh√¥ng ƒë·ªça ng·∫° qu·ª∑ <br>
                  Quy Y TƒÉng r·ªìi kh√¥ng ƒë·ªça b√†ng sinh" <br>
                </p>
              </el-form-item>

              <div v-show="false" class="group1 ep-bg-purple-dark">
                <p> D·∫° k√≠nh th∆∞a Qu√Ω Ph·∫≠t t·ª≠, ƒë·ªÉ nh·∫≠n Ph√°p Danh v√† L√° Ph√°i th√¨ Qu√Ω Ph·∫≠t t·ª≠ s·∫Ω c·∫ßn CH·∫ÆC CH·∫ÆN tham d·ª±
                  l·ªÖ
                  Quy Y ·∫°. K√≠nh mong Qu√Ω Ph·∫≠t t·ª≠ x√°c nh·∫≠n l·∫°i gi√∫p ch√∫ng con nh√© ·∫°.</p>
                <el-form-item>
                  <el-radio-group v-model="form.rdThamdu">
                    <el-radio name="dongythamgia" label="Ch·∫Øc ch·∫Øn tham gia">Ch·∫Øc ch·∫Øn tham gia</el-radio>
                    <el-radio name="dongythamgia" label="Kh√¥ng tham gia ƒë∆∞·ª£c">Kh√¥ng tham gia ƒë∆∞·ª£c</el-radio>
                  </el-radio-group>

                </el-form-item>

              </div>



              <el-form-item label="H·ªç v√† t√™n">
                <el-input name="hovaten" hin v-model="modelHovaten" placeholder="Vui l√≤ng vi·∫øt hoa ch·ªØ c√°i ƒë·∫ßu ti√™n" />
              </el-form-item>


              <el-form-item label="NƒÉm Sinh">
                <el-input type="number" name="namsinh" hin v-model="form.namsinh"
                  placeholder="Ch·ªâ nh·∫≠p nƒÉm sinh, v√≠ d·ª• 2020" />

              </el-form-item>

              <el-form-item label="Gi·ªõi t√≠nh">
                <el-radio-group v-model="form.gioitinh">
                  <el-radio name="gioitinh" label="Nam" />
                  <el-radio name="gioitinh" label="N·ªØ" />
                </el-radio-group>
              </el-form-item>

              <el-form-item label="S·ªë ƒëi·ªán tho·∫°i">
                <el-input name="sodienthoai" type="tel" hin v-model="form.sodienthoai" />
              </el-form-item>

              <div class="group1">
                <div style="display: flex;">
                  <p class="p_titlegroup">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫*</p>
                  <p style="margin-left: 0.4em;"> (Theo CCCD)</p>
                </div>
                <div class="quick-provinces"
                  style="margin: 4px 0 8px; display: flex; flex-wrap: wrap; align-items: center;">
                  <div class="test1">
                    <p @click="selectQuickProvince('T·ªânh Ngh·ªá An')">Ngh·ªá An</p>
                    <p @click="selectQuickProvince('T·ªânh H√† Tƒ©nh')">H√† Tƒ©nh</p>
                    <p @click="selectQuickProvince('T·ªânh Thanh H√≥a')">Thanh Ho√°</p>
                    <p @click="selectQuickProvince('Th√†nh ph·ªë ƒê√† N·∫µng')">ƒê√† N·∫µng</p>
                    <p @click="selectQuickProvince('T·ªânh Th·ª´a Thi√™n Hu·∫ø')">Hu·∫ø</p>

                  </div>
                </div>
                <el-form-item style="margin-top: 0.1em;">
                  <el-autocomplete placeholder="T·ªânh/TP" v-model="modelProvince" :fetch-suggestions="querySearchP"
                    fit-input-width clearable readonly class="inline-input auto1" @select="handleSelect"
                    @focus="handleFocusInput">
                  </el-autocomplete>
                </el-form-item>

                <el-form-item label="">
                  <el-autocomplete placeholder="Qu·∫≠n/Huy·ªán" v-model="modelDistrict" :fetch-suggestions="querySearchD"
                    fit-input-width clearable class="inline-input auto1" @select="handleSelectD"
                    @focus="handleFocusInput"> </el-autocomplete>
                </el-form-item>

                <el-form-item label="">
                  <el-autocomplete class="inline-input auto1" placeholder="Ph∆∞·ªùng/X√£/TT" v-model="modelWard"
                    :fetch-suggestions="querySearchW" fit-input-width clearable @select="handleSelectW"
                    @focus="handleFocusInput">
                  </el-autocomplete>
                </el-form-item>
                <el-text v-show="form.sonhatt.length > 0" class="ketqua">ƒëc ƒë·∫ßy ƒë·ªß:</el-text>
                <el-text v-show="form.sonhatt.length > 0"
                  v-text="form.sonhatt + ', ' + modelWard + ', ' + modelDistrict + ', ' + modelProvince"
                  class="ketqua"></el-text>
                <el-input @change="onChangeSonhaTT" hin v-model="form.sonhatt"
                  placeholder="Nh·∫≠p S·ªë nh√†, Ng√µ, t√™n ƒë∆∞·ªùng, th√¥n x√≥m..." />

              </div>
              <!-- @@dctt -->


              <div class="group1 ">
                <p class="p_titlegroup">N∆°i ·ªü hi·ªán t·∫°i*</p>

                <el-link @click="clickCopyDiaChi" style=" padding: 0.2em; border-radius: 0.1em; border-color: #0087a5; border-width: 0.1em;
                        border-style: solid;" class="mx-1" type="primary"> <el-icon>
                    <Download />
                  </el-icon> . L·∫•y t·ª´ ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫
                </el-link>

                <el-form-item>
                  <el-autocomplete placeholder="T·ªânh/Th√†nh Ph·ªë" v-model="modelProvince11"
                    :fetch-suggestions="querySearchP11" fit-input-width clearable class="inline-input auto1"
                    @select="handleSelect11" @focus="handleFocusInput">
                  </el-autocomplete>
                </el-form-item>

                <el-form-item>
                  <el-autocomplete placeholder="Qu·∫≠n / Huy·ªán" v-model="modelDistrict11"
                    :fetch-suggestions="querySearchD11" fit-input-width clearable class="inline-input w-50 auto1"
                    @select="handleSelectD11" @focus="handleFocusInput"> </el-autocomplete>
                </el-form-item>

                <el-form-item>
                  <el-autocomplete placeholder="Ph∆∞·ªùng/X√£/TT" v-model="modelWard11" :fetch-suggestions="querySearchW11"
                    fit-input-width clearable @select="handleSelectW11" class="inline-input w-50 auto1"
                    @focus="handleFocusInput"> </el-autocomplete>
                </el-form-item>
                <el-text v-show="form.sonhatt11.length > 0" class="ketqua">ƒëc ƒë·∫ßy ƒë·ªß:</el-text>
                <el-text v-show="form.sonhatt11.length > 0"
                  v-text="form.sonhatt11 + ', ' + modelWard11 + ', ' + modelDistrict11 + ', ' + modelProvince11"
                  class="ketqua"></el-text>
                <el-input hin v-model="form.sonhatt11" placeholder="Nh·∫≠p S·ªë nh√†, Ng√µ, t√™n ƒë∆∞·ªùng, th√¥n x√≥m..." />
              </div>

              <div class="group1 ">
                <p class="p_titlegroup">Qu√Ω Ph·∫≠t t·ª≠ ƒê√£ tham gia sinh ho·∫°t ƒê·∫°o Tr√†ng, Ch√∫ng Thanh Ni√™n ch∆∞a ·∫°?</p>
                <el-radio-group v-model="form._rdDathamGiaDaoTrang">
                  <el-radio label=0>Ch∆∞a Tham Gia</el-radio>
                  <el-radio label=1>ƒê√£ tham gia</el-radio>
                </el-radio-group>
                <el-input v-show="form._rdDathamGiaDaoTrang == 1" class="margintop1em" name="email" hin
                  v-model="form._tentochucdathamgia" placeholder="Nh·∫≠p t√™n ƒê·∫°o Tr√†ng, CTN ƒë√£ tham gia" />

                <div v-if="form._rdDathamGiaDaoTrang == 0">
                  <p class="p_titlegroup">Qu√Ω Ph·∫≠t t·ª≠ c√≥ mong mu·ªën tham gia sinh ho·∫°t ƒê·∫°o tr√†ng/CTN kh√¥ng ·∫°?</p>
                  <el-radio-group v-model="form._rdMongMuonThamGiaDT">
                    <el-radio label='C√≥ Mu·ªën tham gia'>C√≥ Mu·ªën tham gia</el-radio>
                    <el-radio label='Kh√¥ng mu·ªën tham gia'>Kh√¥ng mu·ªën tham gia</el-radio>
                  </el-radio-group>
                </div>



              </div>

              <div class="group1 ">
                <p class="p_titlegroup ">Ng∆∞·ªùi gi·ªõi thi·ªáu (n√™n c√≥ SƒêT)</p>
                <p v-if="!savedNguoiGioiThieu" class="ss">VD: H√≤a L√Ω Anh - 0338 699 484</p>

                <el-link @click="useSavedNguoiGioiThieu" style=" max-width: 100% ; display: inline-block; text-overflow: ellipsis; overflow: hidden;  white-space: nowrap; padding: 0.2em; border-radius: 0.1em; border-color: #0087a5; border-width: 0em;
                        border-style: solid;" class="mx-1" type="primary"> <el-icon>
                    <Download />
                  </el-icon> . {{ savedNguoiGioiThieu }}
                </el-link>


                <el-button plain type="primary"
                  style="max-width: 100% ; display: inline-block; text-overflow: ellipsis; overflow: hidden;  white-space: nowrap;  "
                  v-if="false" @click="useSavedNguoiGioiThieu">üëá{{ savedNguoiGioiThieu }} </el-button>

                  <el-text style="type" v-if="savedNguoiGioiThieu" class="ss">‚òùÔ∏èClick ph√≠a tr√™n ƒë·ªÉ d√πng l·∫°i</el-text>
                <el-input class="margintop1em" hin v-model="form.nguoigioithieu"
                  placeholder="H√£y nh·∫≠p ng∆∞·ªùi gi·ªõi thi·ªáu" />
              </div>

              <div v-show="showGhichu" class="group1 ">
                <p class="p_titlegroup">Th·∫Øc m·∫Øc, ghi ch√∫</p>
                <el-input class="margintop1em" hin v-model="form.ghichu" placeholder="" />
              </div>

              <div v-show="false" class="group1 ">
                <p class="p_titlegroup">Li√™n h·ªá nh·∫≠n L√° Ph√°i: <br>
                  Th∆∞ k√Ω ch√πa: 0383 668 927<br>
                </p>
              </div>

              <div v-show="showGhichu" class="group1 ">
                <p class="p_titlegroup">TR∆Ø·ªúNG H·ª¢P PH·∫¨T T·ª¨ KH√îNG THAM D·ª∞ ƒê∆Ø·ª¢C L·ªÑ:</p>
                <p class="">
                  Th∆∞·ªùng m·ªói th√°ng s·∫Ω c√≥ 1 bu·ªïi l·ªÖ Quy Y ·∫°, Qu√Ω Ph·∫≠t t·ª≠ vui l√≤ng hoan h·ª∑ ƒëƒÉng k√Ω v√†o l·ªÖ sau n·∫øu tham
                  d·ª± ƒë∆∞·ª£c nh√© ·∫°.<br>

                  Th√¥ng tin l·ªÖ Quy Y ƒë∆∞·ª£c ƒëƒÉng t·∫£i tr√™n trang: Ch√∫ng Thanh Ni√™n Ph·∫≠t T·ª≠ Ph·∫≠t Quang Ngh·ªá An<br>
                  <a href="https://www.facebook.com/ctnpqnghean">https://www.facebook.com/ctnpqnghean</a>
                  <br>

                  M·ªçi th·∫Øc m·∫Øc v·ªÅ L·ªÖ Quy Y xin vui l√≤ng li√™n h·ªá:<br>T√¢m Huy Ph√°p: 0383 668 927
                </p>

              </div>

              <div v-show="showGhichu" class="group1 ">
                <p class="p_titlegroup ">QUY TR√åNH T·ª™ L√öC ƒêƒÇNG K√ù QUY Y T·ªöI NH·∫¨N L√Å PH√ÅI:</p>
                <p class=" smalltext">
                  QUY TR√åNH T·ª™ L√öC ƒêƒÇNG K√ù QUY Y T·ªöI NH·∫¨N L√Å PH√ÅI<br>1. ƒêƒÉng k√Ω<br>- Qu√Ω Ph·∫≠t t·ª≠ ƒëƒÉng k√Ω Quy Y qua
                  link ho·∫∑c qua b√†n Th∆∞ K√Ω t·∫°i Ch√πa Vi√™n Quang v√†o h√¥m t·ªï ch·ª©c l·ªÖ.<br>

                  2. X√°c nh·∫≠n th√¥ng tin<br>Qu√Ω Ph·∫≠t t·ª≠ ƒë√£ ƒëƒÉng k√Ω tr√™n link tr∆∞·ªõc ƒë√≥ s·∫Ω ƒë∆∞·ª£c ban th∆∞ k√Ω g·ªçi ƒëi·ªán x√°c
                  nh·∫≠n l·∫°i th√¥ng tin v√† ph√°t s·ªë phi·∫øu nh·∫≠n l√° ph√°i khi v·ªÅ ch√πa ·∫°.<br>

                  3. Tham d·ª± l·ªÖ Quy Y<br>- Qu√Ω Ph·∫≠t t·ª≠ c·ªë g·∫Øng tham d·ª± l·ªÖ theo th·ªùi gian, ƒë·ªãa ƒëi·ªÉm ghi tr√™n b√†i
                  th√¥ng b√°o ·∫°.<br>

                  4. Nh·∫≠n L√° Ph√°i<br>- Sau khi h·∫øt L·ªÖ, Qu√Ω Ph·∫≠t t·ª≠ vui l√≤ng l·∫Øng nghe th√¥ng b√°o v√† n√°n l·∫°i n∆°i d·ª± l·ªÖ
                  ƒë·ªÉ nh·∫≠n l√° ph√°i quy y ·∫°<br>- Qu√Ω Ph·∫≠t t·ª≠ ki·ªÉm tra l·∫°i th√¥ng tin khi nh·∫≠n l√° ph√°i v√† b√°o l·∫°i ngay
                  cho th∆∞ k√Ω khi th√¥ng tin b·ªã sai ho·∫∑c thi·∫øu ·∫°.<br>

                  5. Sau L·ªÖ Quy Y<br>- Qu√Ω Ph·∫≠t t·ª≠ ƒëƒÉng k√Ω s√°t gi·ªù ho·∫∑c ƒëƒÉng k√Ω sau khi ƒë√£ d·ª± l·ªÖ m√† ch∆∞a k·ªãp c√≥ l√°
                  ph√°i tr∆∞·ªõc khi ra v·ªÅ s·∫Ω ƒë∆∞·ª£c ban th∆∞ k√Ω g·ªçi th√¥ng b√°o v·ªÅ vi·ªác nh·∫≠n l√° ph√°i.<br>- ƒê·ªëi v·ªõi nh·ªØng
                  tr∆∞·ªùng h·ª£p n√†y ban th∆∞ k√Ω s·∫Ω g·ª≠i l√° ph√°i v·ªÅ ph·ª• tr√°ch ƒêT, CTN ho·∫∑c g·ª≠i v·ªÅ nh√† n·∫øu Qu√Ω Ph·∫≠t t·ª≠ c√≥
                  y√™u c·∫ßu ·∫°.<br>

                  L∆∞u √Ω: Qu√Ω Ph·∫≠t t·ª≠ nh·ªõ ƒë·ªÉ √Ω ƒëi·ªán tho·∫°i khi c√≥ cu·ªôc g·ªçi nh·ª° ho·∫∑c tin nh·∫Øn xin x√°c nh·∫≠n th√¥ng tin
                  quy y c·ªßa ch√∫ng con nh√© ·∫°. Ngo√†i ra, Qu√Ω Ph·∫≠t t·ª≠ c·ªë g·∫Øng ki·ªÉm tra l·∫°i SƒêT khi ƒëƒÉng k√Ω, tr√°nh t√¨nh
                  tr·∫°ng SƒêT b·ªã sai, thi·∫øu/th·ª´a s·ªë nh√© ·∫°.


                </p>

              </div>

               
              

              <p v-if="false">223selectedP:{{ selectedP }} -- selectedD:{{ selectedD }} -- selectedW:{{
                selectedW }} -- </p>
              <p v-if="false">ss {{ form }}</p>
              <div class="margintop1em">
                <el-text v-if="false" style=" padding: 0.5em; border-radius: 0.1em; border-color: #0087a5; border-width: 0.1em;
                        border-style: solid;" class="mx-1" @click="clickDangKy" type="primary">ƒêƒÉng k√Ω</el-text>
                <button class="el-button" @click="clickDangKy">ƒêƒÉng K√Ω</button>
                <el-button>H·ªßy</el-button>

              </div>

              <p style="height: 20em;">.</p>




            </div>
          </div>
        </div>

      </div>
    </div>


    <p style="font-size: 0.7em; color: rgb(141, 175, 175); width: 100%; text-align: center; margin: 0.3em;">version {{
      form.webversion }} - contact 0983838619</p>
  </div>




  <el-dialog width="90%" v-model="dialogConfirmVisible" title="X√°c nh·∫≠n ƒëƒÉng k√Ω">
    <form method="POST" :action="urlScriptGoogle" :model="form" label-width="120px">

      <el-input id="abc1" name="ghichu" hin v-model="form.ghichu" />
      <el-input name="dongythamgia" hin v-show="false" v-model="form.rdThamdu" />
      <el-input name="nguoigioithieu" hin v-show="false" v-model="form.nguoigioithieu" />
      <el-input name="dasinhhoatdaotrang" hin v-show="false" v-model="form.dasinhhoatdaotrang" />
      <el-input name="dauthoigian" hin v-show="false" v-model="form.dauthoigian" />
      <el-input name="web_version" hin v-show="false" v-model="form.webversion" />



      <table>

        <tr valign="top">
          <td style="">H·ªç t√™n: <strong>{{ modelHovaten }}</strong>
            <el-input name="hovaten" hin v-show="false" v-model="modelHovaten" />

          </td>

        </tr>

        <tr>
          <td>SƒêT: {{ form.sodienthoai }}</td>
          <el-input name="sodienthoai" hin v-show="false" v-model="form.sodienthoai" />
        </tr>

        <tr>
          <td>NƒÉm Sinh: {{ form.namsinh }}</td>
          <el-input name="namsinh" hin v-show="false" v-model="form.namsinh" />
        </tr>

        <tr>
          <td>Gi·ªõi T√≠nh: {{ form.gioitinh }}</td>
          <el-input name="gioitinh" hin v-show="false" v-model="form.gioitinh" />
        </tr>

        <tr>
          <td>ƒêC Th∆∞·ªùng Tr√∫: {{ form.sonhatt + ', ' + modelWard + ', ' + modelDistrict + ', ' + modelProvince }}
            <el-input name="diachithuongtru" hin v-show="false" v-model="form_diachithuongtru"> </el-input>
          </td>
        </tr>

        <tr>
          <td>
            <el-input name="diachithuongtru_short" hin v-show="false" v-model="form_diachithuongtru_short"> </el-input>
          </td>
        </tr>



        <tr>
          <td>N∆°i ·ªü hi·ªán t·∫°i: {{ form.sonhatt11 + ', ' + modelWard11 + ', ' + modelDistrict11 + ', ' + modelProvince11
            }}
            <el-input name="diachitamtru" hin v-show="false" v-model="form_diachitamtru"> </el-input>
            <el-input name="tinhtamtru" hin v-show="false" v-model="modelProvince11"> </el-input>
          </td>
        </tr>

      </table>
      <!-- <el-button type="primary" style="margin-top: 1em;">X√°c nh·∫≠n</el-button> -->
      <div style="margin-top: 1em;">
        <button class="el-button el-button--primary" @click="submitDk()" type="submit">X√°c nh·∫≠n</button>

      </div>
    </form>
    <button style="margin-top: 1em;" class="el-button el-button--info"
      @click="dialogConfirmVisible = false">H·ªßy</button>

  </el-dialog>

  <el-drawer v-model="drawer" :with-header="false" title="I am the title"><span>{{ messageDrawer }}</span></el-drawer>
</template>
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////
<script lang="ts" setup>
import { onMounted, reactive, ref, watch } from 'vue'
import { exportedFile } from "../utils/exportedFile";
import { myUtils } from "../utils/myUtils";
import { axiosUtils } from "../utils/axiosUtils";
import type { FormInstance, FormRules } from 'element-plus';
import { useRoute } from "vue-router";
import { h } from 'vue'
import { ElMessage, ElMessageBox, ElLoading } from 'element-plus'
import type { Action } from 'element-plus'
import { randomInt } from 'crypto';
import axios from 'axios'

// import * as dayjs from 'dayjs'
// dayjs().format()
// import 'dayjs/locale/vi'
// dayjs.locale('vi') // use locale
// var now = dayjs()

///dev
var lastTimeSubmit = 0;
var isDevEnviroment = false;
if (window.location.href.indexOf('localhost') != -1)
  isDevEnviroment = true;
og('url=' + isDevEnviroment);

//cookie
import { useCookies } from "vue3-cookies";
import { delay } from 'rxjs';
let useCookie = useCookies();
//useCookie.cookies.set('last_submit','11');
const clickSubmited = ref(false);
const showGhichu = ref(false);
og('cookie= ' + useCookie.cookies.get('last_submit'))



const myUtils0 = new myUtils()
const validateLevel = ref(1)
const savedNguoiGioiThieu = ref('')
const savedNguoiGioiThieuShort= ref('')
if (useRoute().query.validate) validateLevel.value = useRoute().query.validate
og('validate=' + validateLevel.value)
///////////////////// dialog ////////////
let dialogConfirmVisible = ref(false)
// do not use same name with ref
const form = reactive({

  webversion: 'ver9.6',

  gioitinh: '',
  sodienthoai: '',
  sonhatt: '',
  _tentochucdathamgia: '',
  nguoigioithieu: '',
  ghichu: '',
  dauthoigian: '',

  sonhatt11: '',
  dasinhhoatdaotrang: '',
  _rdDathamGiaDaoTrang: -1,
  _rdMongMuonThamGiaDT: -1,


  rdThamdu: 'novalue',

  namsinh: '',
  diachithuongtru: ''
})
const modelHovaten = ref('')

// T·∫£i l·∫°i v√† ƒë·ªìng b·ªô tr·∫°ng th√°i t·ª´ cookie (tr√°nh submit li√™n ti·∫øp, nh·ªõ tr·∫°ng th√°i hi·ªÉn th·ªã ghi ch√∫)
function reloadCookie() {
  let cc1 = useCookie.cookies.get('last_submit')
  og('cookie last submit = ' + cc1)
  if (cc1 === '11') {
    og('reload thoi')
    useCookie.cookies.set('last_submit', '0')
    location.reload();
  }

  // Load ghichu visibility from cookie
  const ghichuCookie = useCookie.cookies.get('show_ghichu');
  if (ghichuCookie === 'true') {
    showGhichu.value = true;
  }

  // Load ng∆∞·ªùi gi·ªõi thi·ªáu ƒë√£ l∆∞u (n·∫øu c√≥)
  const gioiThieuCookie = useCookie.cookies.get('nguoigioithieu');
  if (gioiThieuCookie && typeof gioiThieuCookie === 'string') {
    savedNguoiGioiThieu.value = gioiThieuCookie;
    savedNguoiGioiThieuShort.value = gioiThieuCookie.substring(0, 30);
  }
}
reloadCookie()



const drawer = ref(false)
const messageDrawer = ref('')

const urlScriptGoogle = ref('')
// Hi·ªÉn th·ªã overlay loading trong v√†i gi√¢y sau khi submit ƒë·ªÉ b√°o ƒëang x·ª≠ l√Ω
const openFullScreen2 = () => {
  const loading = ElLoading.service({
    lock: true,
    text: 'Qu√Ω PT vui l√≤ng ch·ªù ƒë·ªÉ ƒëƒÉng k√Ω ·∫°!',
    background: 'rgba(0, 0, 0, 0.7)',
  })
  setTimeout(() => {
    loading.close()
    reloadCookie();
  }, 10000)
}

// G·ª≠i d·ªØ li·ªáu ƒëƒÉng k√Ω l√™n server v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i UI/cookie
function submitDk() {

  let url = "https://connecthtssl.vq.id.vn/sql/statement?sql=INSERT INTO `dangkyquyy`.`register` ( `dauthoigian`, `hovaten`, `namsinh`, `gioitinh`, `sodienthoai`, `diachithuongtru`, `diachithuongtru_short`, `diachitamtru`, `tinhtamtru`, `dasinhhoatdaotrang`, `nguoigioithieu`, `ghichu`, `web_version`) VALUES (  '" + form.dauthoigian + "','" + modelHovaten.value + "','" + form.namsinh + "','" + form.gioitinh + "','" + form.sodienthoai + "','" + form_diachithuongtru.value + "','" + form_diachithuongtru_short.value + "','" + form_diachitamtru.value + "','" + modelProvince11.value + "','" + form.dasinhhoatdaotrang + "','" + form.nguoigioithieu + "','" + form.ghichu + "','" + form.webversion + "');        "

  axios.get(url)




  clickSubmited.value = true
  useCookie.cookies.set('last_submit', '11')

  lastTimeSubmit = 11;
  dialogConfirmVisible.value = false
  openFullScreen2();


}



// Validate form, chu·∫©n h√≥a d·ªØ li·ªáu v√† m·ªü dialog x√°c nh·∫≠n tr∆∞·ªõc khi submit
function clickDangKy() {

  useCookie.cookies.set('show_ghichu', 'false');
  showGhichu.value = false;

  // L∆∞u ng∆∞·ªùi gi·ªõi thi·ªáu v√†o cookie (n·∫øu c√≥) khi b·∫•m ƒêƒÉng k√Ω
  if (form.nguoigioithieu && form.nguoigioithieu.trim().length > 0) {
    try {
      useCookie.cookies.set('nguoigioithieu', form.nguoigioithieu.trim());
      savedNguoiGioiThieu.value = form.nguoigioithieu.trim();
    } catch (e) { og(e) }
  }

  let msgErr = ''
  if (modelHovaten.value.indexOf(' ') == -1) msgErr += '* Vui l√≤ng nh·∫≠p ƒë·ªß h·ªç t√™n.<br>'
  if (form.sodienthoai.trim().length != 10) msgErr += '* S·ªë ƒëi·ªán tho·∫°i ph·∫£i ƒë·ªß 10 s·ªë.<br>'
  if (form.gioitinh.trim().length == 0) msgErr += '* Vui l√≤ng ch·ªçn gi·ªõi t√≠nh.<br>'
  if (form.namsinh.trim().length != 4) msgErr += '* NƒÉm sinh l√† 4 ch·ªØ s·ªë , v√≠ d·ª• 1998.<br>'
  if (form.sonhatt.trim().length == 0) msgErr += '* ƒêC Th∆∞·ªùng tr√∫: Ch∆∞a nh·∫≠p s·ªë nh√†, t√™n ƒë∆∞·ªùng ho·∫∑c th√¥n x√≥m.<br>'
  if (form.sonhatt11.trim().length == 0) msgErr += '* N∆°i ·ªü hi·ªán t·∫°i: Ch∆∞a nh·∫≠p s·ªë nh√†, t√™n ƒë∆∞·ªùng ho·∫∑c th√¥n x√≥m.<br>'

  if (msgErr.length > 0) {
    showError(msgErr)
    return;
  }

  modelHovaten.value = myUtils0.vietHoaHoTen(modelHovaten.value)

  urlScriptGoogle.value = 'https://script.google.com/macros/s/AKfycbxjTZIWY1jwUObSIqr3X8DIWhCLnLKUCZFMoMLw-fO9cElsFDuuPjLR8r2TlbiVBb0/exec?phone1=' + form.sodienthoai
  //form.dauthoigian= now.daysInMonth()+"/"+(now.month()+1)+"/"+now.year()+" "+now.hour()+":"+now.minute()+":"+now.second();
  // form_diachithuongtru.value = form.sonhatt + ', ' + modelWard.value + ', ' + modelDistrict.value + ', ' + modelProvince.value;
  const dateNow = new Date();
  form.dauthoigian = dateNow.getDate() + "/" + (dateNow.getMonth() + 1) + "/" + dateNow.getFullYear() + " " + dateNow.getHours() + ":" + dateNow.getMinutes() + ":" + dateNow.getSeconds();

  // if (form.rdThamdu == 1) form.dongythamgia = 'Ch·∫Øc ch·∫Øn tham gia'
  // else form.dongythamgia = 'Kh√¥ng tham gia ƒë∆∞·ª£c '



  form_diachithuongtru_short.value = modelWard.value + ', ' + modelDistrict.value + ', ' + modelProvince.value;
  form_diachithuongtru.value = form.sonhatt + ', ' + form_diachithuongtru_short.value

  form_diachitamtru.value = form.sonhatt11 + ', ' + modelWard11.value + ', ' + modelDistrict11.value + ', ' + modelProvince11.value;

  if (form._rdDathamGiaDaoTrang == 0) {
    form.dasinhhoatdaotrang = 'Ch∆∞a tham gia - ' + form._rdMongMuonThamGiaDT
  }
  else form.dasinhhoatdaotrang = form._tentochucdathamgia;

  dialogConfirmVisible.value = true
}

const form_diachithuongtru = ref('');
const form_diachithuongtru_short = ref('')
const form_diachitamtru = ref('');
//////////////////end dialog


interface provinceItem {
  value: string
  code?: number
  districts?: provinceItem[]
  wards?: provinceItem[]
}
const modelProvince = ref('')
const provincesSource = ref<provinceItem[]>([])

// G·ª£i √Ω t·ªânh/th√†nh theo t·ª´ kh√≥a cho autocomplete T·ªânh/TP (th∆∞·ªùng tr√∫)
const querySearchP = (queryString: string, cb: any) => {
  const results = queryString
    ? provincesSource.value.filter(createFilter(queryString))
    : provincesSource.value
  // call callback function to return suggestions
  cb(results)
}

// Ch·ªçn nhanh m·ªôt t·ªânh/th√†nh c·ªë ƒë·ªãnh v√† n·∫°p danh s√°ch qu·∫≠n/huy·ªán li√™n quan
async function selectQuickProvince(name: string) {
  const province = provincesSource.value.find(p => p.value === name)
  if (!province) return
  // set province

  selectedP.value = province.value
  modelProvince.value = province.value

  // load districts of selected province
  districts.value = province.districts || []
  // reset dependent selections
  modelDistrict.value = ''
  selectedD.value = ''
  wards.value = []
  modelWard.value = ''
  selectedW.value = ''
}


// function rdThamDuChange(value, number) {
//   if (form.rdThamdu == 1) form.dongythamgia = 'Ch·∫Øc ch·∫Øn tham gia'
//   else form.dongythamgia = 'Kh√¥ng tham gia ƒë∆∞·ª£c '
// }


const modelDistrict = ref('')
const districts = ref<provinceItem[]>([])
// G·ª£i √Ω qu·∫≠n/huy·ªán theo t·ª´ kh√≥a cho autocomplete Qu·∫≠n/Huy·ªán (th∆∞·ªùng tr√∫)
const querySearchD = (queryString: string, cb: any) => {
  const results = queryString
    ? districts.value.filter(createFilter(queryString))
    : districts.value
  // call callback function to return suggestions
  cb(results)
}



const modelWard = ref('')
const wards = ref<provinceItem[]>([])
// G·ª£i √Ω ph∆∞·ªùng/x√£ theo t·ª´ kh√≥a cho autocomplete Ph∆∞·ªùng/X√£ (th∆∞·ªùng tr√∫)
const querySearchW = (queryString: string, cb: any) => {
  const results = queryString
    ? wards.value.filter(createFilter(queryString))
    : wards.value
  // call callback function to return suggestions
  cb(results)
}


// T·∫°o h√†m l·ªçc kh√¥ng d·∫•u cho t√≠nh nƒÉng t√¨m ki·∫øm autocomplete
const createFilter = (queryString: string) => {
  return (province: provinceItem) => {
    return (
      myUtils0.removeVietnameseTones(province.value).includes(myUtils0.removeVietnameseTones(queryString))
    )
  }
}

const selectedP = ref('');
// Khi ch·ªçn t·ªânh t·ª´ autocomplete: l∆∞u t·ªânh ƒë√£ ch·ªçn v√† n·∫°p danh s√°ch qu·∫≠n/huy·ªán
const handleSelect = (item: provinceItem) => {
  selectedP.value = item.value
  districts.value = item.districts || []
  og(item)
}
const selectedD = ref('');
// Khi ch·ªçn qu·∫≠n/huy·ªán: l∆∞u huy·ªán ƒë√£ ch·ªçn v√† n·∫°p danh s√°ch ph∆∞·ªùng/x√£
const handleSelectD = (item: provinceItem) => {
  og(item.wards)
  selectedD.value = item.value
  wards.value = item.wards || []
}

const selectedW = ref('')
// Khi ch·ªçn ph∆∞·ªùng/x√£: l∆∞u x√£ ƒë√£ ch·ªçn
const handleSelectW = (item: provinceItem) => {
  //districts.value = item.districts
  selectedW.value = item.value
}



////////////////////////////// tinh tp thu 2////////////////

const modelProvince11 = ref('')
// G·ª£i √Ω t·ªânh/th√†nh cho autocomplete T·ªânh/TP (t·∫°m tr√∫)
const querySearchP11 = (queryString: string, cb: any) => {
  const results = queryString
    ? provincesSource.value.filter(createFilter(queryString))
    : provincesSource.value
  // call callback function to return suggestions
  cb(results)
}




const modelDistrict11 = ref('')
const districts11 = ref<provinceItem[]>([])
// G·ª£i √Ω qu·∫≠n/huy·ªán cho autocomplete Qu·∫≠n/Huy·ªán (t·∫°m tr√∫)
const querySearchD11 = (queryString: string, cb: any) => {
  const results = queryString
    ? districts11.value.filter(createFilter(queryString))
    : districts11.value
  // call callback function to return suggestions
  cb(results)
}


const modelWard11 = ref('')
const wards11 = ref<provinceItem[]>([])
// G·ª£i √Ω ph∆∞·ªùng/x√£ cho autocomplete Ph∆∞·ªùng/X√£ (t·∫°m tr√∫)
const querySearchW11 = (queryString: string, cb: any) => {
  const results = queryString
    ? wards11.value.filter(createFilter(queryString))
    : wards11.value
  // call callback function to return suggestions
  cb(results)
}


const selectedP11 = ref('');
// X·ª≠ l√Ω ch·ªçn t·ªânh (t·∫°m tr√∫)
const handleSelect11 = (item: provinceItem) => {
  selectedP11.value = item.value
  districts11.value = item.districts || []
  og(item)
}
const selectedD11 = ref('');
// X·ª≠ l√Ω ch·ªçn qu·∫≠n/huy·ªán (t·∫°m tr√∫)
const handleSelectD11 = (item: provinceItem) => {
  og(item.wards)
  selectedD11.value = item.value
  wards11.value = item.wards || []
}

const selectedW11 = ref('')
// X·ª≠ l√Ω ch·ªçn ph∆∞·ªùng/x√£ (t·∫°m tr√∫)
const handleSelectW11 = (item: provinceItem) => {
  //districts.value = item.districts
  selectedW11.value = item.value
}







// Log ti·ªán √≠ch ra console
function og(str: any) {
  console.log(str);
}

// Khi input ƒë∆∞·ª£c focus, cu·ªôn m·ª•c ti√™u v√†o gi·ªØa m√†n h√¨nh (m√¥ ph·ªèng UX mobile khi b√†n ph√≠m xu·∫•t hi·ªán)
function handleFocusInput(e: FocusEvent) {
  const target = e.target as HTMLElement | null
  if (!target) return
  // D√πng setTimeout ƒë·ªÉ ƒë·ª£i DOM/overlay c·ªßa b√†n ph√≠m (tr√™n mobile) ·ªïn ƒë·ªãnh tr∆∞·ªõc khi scroll
  setTimeout(() => {
    try {
      target.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' })
    } catch (err) {
      // fallback an to√†n
      window.scrollTo({ top: target.getBoundingClientRect().top + window.scrollY - 100, behavior: 'smooth' })
    }
  }, 300)
}

// ƒêi·ªÅn l·∫°i ng∆∞·ªùi gi·ªõi thi·ªáu t·ª´ cookie v√†o form khi b·∫•m v√†o nh·∫Øc nh·ªü
function useSavedNguoiGioiThieu() {
  if (savedNguoiGioiThieu.value) {
    form.nguoigioithieu = savedNguoiGioiThieu.value
  }
}

myUtils0.watchLocation(modelProvince, modelDistrict, modelWard, districts, wards, selectedP, selectedD11, selectedW11, selectedP11, selectedD, selectedW, modelProvince11, modelDistrict11, modelWard11, districts11, wards11);

// Sao ch√©p to√†n b·ªô ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫ sang ƒë·ªãa ch·ªâ t·∫°m tr√∫
function clickCopyDiaChi() {

  modelProvince11.value = modelProvince.value
  modelDistrict11.value = modelDistrict.value
  modelWard11.value = modelWard.value

  selectedP11.value = selectedP.value
  selectedD11.value = selectedD.value
  selectedW11.value = selectedW.value

  wards11.value = wards.value
  districts11.value = districts.value
  form.sonhatt11 = form.sonhatt

}


// S·ª± ki·ªán thay ƒë·ªïi s·ªë nh√† (ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫) - hi·ªán ch∆∞a s·ª≠ d·ª•ng
function onChangeSonhaTT(str) {

}

// Hi·ªÉn th·ªã th√¥ng b√°o l·ªói d·∫°ng HTML b·∫±ng ElMessageBox
function showError(str) {
  ElMessageBox.alert(str,
    {
      dangerouslyUseHTMLString: true,
    }
  )

  // ElMessage({
  //   message: h('p', null, [

  //     h('i', { style: 'color: teal' }, str),
  //   ]),
  // })
}


// Kh·ªüi t·∫°o d·ªØ li·ªáu t·ªânh/th√†nh khi component mount
onMounted(() => {
  provincesSource.value = new exportedFile().loadAllProvince()
})

// Theo d√µi thay ƒë·ªïi h·ªç t√™n ƒë·ªÉ reload cookie (tr√°nh k·∫πt tr·∫°ng th√°i)
watch(modelHovaten, async (newQuestion, oldQuestion) => {

  reloadCookie();

})



if (isDevEnviroment) {
  modelHovaten.value = 'Qu·∫£ng An test ' + Math.floor(Math.random() * 30000);
  form.gioitinh = 'Nam'
  form.sodienthoai = '0977310197'
  form.sonhatt = 'so nha 2'
  form.sonhatt11 = 'so nha 3'
  selectedP.value = 'T·ªânh B·∫Øc K·∫°n'
  selectedD.value = 'Huy·ªán Tam D∆∞∆°ng'
  selectedW.value = 'X√£ ƒê·ªìng Tƒ©nh'

  selectedP11.value = 'T·ªânh L√¢m ƒê·ªìng'
  selectedD11.value = 'Huy·ªán ƒêam R√¥ng'
  selectedW11.value = 'X√£ ƒê·∫° T√¥ng'


  form.namsinh = '2222'

}

// L√†m m·ªõi form ƒë·ªÉ ƒëƒÉng k√Ω m·ªõi
function clickDangKyMoi() {
  location.reload()
}

// B·∫≠t/t·∫Øt hi·ªÉn th·ªã ph·∫ßn ghi ch√∫ v√† l∆∞u tr·∫°ng th√°i v√†o cookie
const toggleGhichu = () => {
  showGhichu.value = !showGhichu.value;
  useCookie.cookies.set('show_ghichu', showGhichu.value.toString());
}


</script>

////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////

<style>
.parent {
  max-width: 600px;
  margin: auto;
}

.group1 {
  border-radius: 0.5em;
  min-height: 36px;
  border-style: solid;
  padding: 1em;
  margin-top: 1em;

  border-color: #25497e18;
}


svg {

  position: absolute;
  width: 100%;
  height: 100%;

  top: 1000;
  bottom: 0;
  left: 0;
  right: 0;
}

body {
  font-family: Verdana, Geneva, sans-serif;
  font-size: 14px;
  background-color: #25497e;
}

.wrap2 {
  background-image: linear-gradient(#25497e, #25497e);
  margin-left: 0.7em;
  margin-right: 0.7em;
}

.form_in1 {
  background-image: linear-gradient(#ffffff, #ffffff);
}

p {
  color: #222121;
}

.el-form-item {
  margin-top: 1em;
}

.p_titlegroup {
  color: #000000b3;
  font-size: 16px;
  font-weight: bold;

}

.margintop1em {
  margin-top: 1em;
}

.smalltext {
  font-size: 12px;
}

.auto1 {
  width: 100%;
}


.form_wrapper {


  max-width: 100%;
  box-sizing: border-box;
  padding: 25px;
  margin: 2% auto 0;
  position: relative;
  z-index: 1;
  border-top: 5px solid #f9004293;
}

td {
  padding: 8px;

  font-weight: bold;

}

.ketqua {
  font-style: italic;
  font-size: 0.8em;
  color: #161616;
  margin-left: 1em;
}

.dl_content {
  color: coral;
}




.test1 p {
  color: brown;
  display: inline-block;
  gap: 4px;
  padding: 0px 4px;
  margin: 1px 1px;
  flex-wrap: wrap;
  border: 1px solid #999;
  /* vi·ªÅn xung quanh */
  border-radius: 6px;
  /* bo g√≥c (t√πy ch·ªçn) */
  background-color: #fff;
  /* n·ªÅn tr·∫Øng (t√πy ch·ªçn) */
}
</style>